import { test } from 'tap';
import sinon from 'sinon';
import AndroidSafenetFormat from '../../../../src/attestation/format/androidSafetynet/androidSafetynet';
import crypto from 'crypto';
import str2ab from 'str2ab';
import parseCoseKey from 'parse-cosekey';
import cbor from 'cbor';
import dayjs from 'dayjs';
import { FslAndroidSafetynetFormatVerifyResultOthers } from '../../../../src/type';

const parse = async (attestationObject: string, clientDataJSON: string) => {
  const cBuf: Buffer = str2ab.arraybuffer2buffer(str2ab.base64url2arraybuffer(clientDataJSON));
  const clientDataJSONHash: Buffer = crypto.createHash('sha256').update(cBuf).digest();

  const decodedAO = cbor.decodeAllSync(str2ab.arraybuffer2buffer(str2ab.base64url2arraybuffer(attestationObject)));
  const attStmt = decodedAO[0]['attStmt'];
  const authData = decodedAO[0]['authData'];
  const attestedCredentialData: Buffer = authData.slice(32 + 1 + 4);
  const credentialIdLength: Buffer = attestedCredentialData.slice(16, 16 + 2);
  const credentialIdLengthNumber: number = credentialIdLength.readUInt16BE();
  const credentialId: Buffer = attestedCredentialData.slice(16 + 2, 16 + 2 + credentialIdLengthNumber);
  const credentialPublicKey: Buffer = attestedCredentialData.slice(16 + 2 + credentialIdLengthNumber);
  const decodedCredentialPublicKey: any[] = cbor.decodeAllSync(credentialPublicKey);
  const coseCredentialPublicKey = decodedCredentialPublicKey[0];
  const jwkResult = parseCoseKey.KeyParser.cose2jwk(coseCredentialPublicKey);
  const alg = Number(coseCredentialPublicKey.get(3));
  const pem: string = await parseCoseKey.KeyParser.cose2pem(coseCredentialPublicKey);

  const rpIdHash: Buffer = authData.slice(0, 32);

  return {
    attStmt,
    result: {
      attestationObject: decodedAO[0],
      fmt: decodedAO[0]['fmt'],
      authData,
      clientDataJSONHash,
      pem,
      jwk: jwkResult,
      credentialId: {
        buffer: credentialId,
        base64url: str2ab.buffer2base64url(credentialId),
      },
      alg,
      rpIdHash,
      coseCredentialPublicKey,
    },
  };
};

test('# AndroidSafetynetFormat', (t) => {
  t.test('## getName', (t) => {
    t.test('### android-safetynet', (t) => {
      const name = AndroidSafenetFormat.getName();

      t.equal(name, 'android-safetynet');
      t.end();
    });

    t.end();
  });

  t.test('## config', (t) => {
    t.test('### config', (t) => {
      const none = new AndroidSafenetFormat();
      none.config(
        {
          attStmt: 'value',
        } as any,
        {
          result: 'value',
        } as any,
        {
          expectation: 'value',
        } as any,
        {
          configure: 'value',
        } as any
      );

      t.same(none.attStmt, { attStmt: 'value' });
      t.same(none.result, { result: 'value' });
      t.same(none.expectation, { expectation: 'value' });
      t.same(none.configure, { configure: 'value' });
      t.end();
    });
    t.end();
  });

  t.test('## verify', (t) => {
    t.test('### valid', async (t) => {
      const clock = sinon.useFakeTimers({
        now: dayjs('2022-08-07T00:29:50.000Z').valueOf(),
      });

      const attestationObject =
        'o2NmbXRxYW5kcm9pZC1zYWZldHluZXRnYXR0U3RtdKJjdmVyaDEyNjg1MDIzaHJlc3BvbnNlWRX1ZXlKaGJHY2lPaUpTVXpJMU5pSXNJbmcxWXlJNld5Sk5TVWxHVm1wRFEwSkVObWRCZDBsQ1FXZEpVRUpHTlVaMU0zSlhXamhJTUdGT2JYaEJXVzU0VFVFd1IwTlRjVWRUU1dJelJGRkZRa04zVlVGTlJ6UjRRM3BCU2tKblRsWkNRVmxVUVd4V1ZFMVRjM2RMVVZsRVZsRlJTMFJEU2tkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUmxKNVpGaE9NRWxHVG14amJscHdXVEpXZWsxVVNYZE5RVmxFVmxGUlJFUkRiRWRUVlZKUVNVVkdjMkpIYkdoaWJVNXNZM2xDUjFGVmRFWkpSV3gxWkVkV2VXSnRWakJKUlVZeFpFZG9kbU50YkRCbFUwSkhUVlJCWlVaM01IbE5WRUUwVFVSamQwMUVTVFZOYW1oaFJuY3dlVTE2UVRSTlJHTjNUVVJKTlUxcWFHRk5TRVY0UTNwQlNrSm5UbFpDUVZsVVFXeFdWRTFSYzNkRFVWbEVWbEZSU1VSQlNrNVhWRVZUVFVKQlIwRXhWVVZDZDNkS1ZqSkdjbHBYV25CYVYzaHJUVkpaZDBaQldVUldVVkZMUkVFeFIxTlZVbEJKUlVaellrZHNhR0p0VG14TlVYZDNRMmRaUkZaUlVVeEVRVTVFVmpCamVFZDZRVnBDWjA1V1FrRk5UVVZ0UmpCa1IxWjZaRU0xYUdKdFVubGlNbXhyVEcxT2RtSlVRME5CVTBsM1JGRlpTa3R2V2tsb2RtTk9RVkZGUWtKUlFVUm5aMFZRUVVSRFEwRlJiME5uWjBWQ1FVeGFPVFJRZUVFeVdVNU9aVGxuZDA5VFNTdEtSRmhZTm5Bd2F6RjViRGg0U1haa1IyaFdZa280YlVWaE4yVlBjR1JaVm1wT2FtdFlPR3c1UWxwYVdqUkpTV2xuYkdzMmNTc3dUM3BQTTBwNlNrODVaM1JpV1RSMVZXMWxkVTlyYW1aV1pqaFlhVTgyVTNZNWNHZERiME5IY0ZJeGNGaG5TbVVyZHpjNU5rMHlTVXRoZFVWaWVXTm9hRVJXU1RaUlYxQndlRWR4VEhweVdscEZiak5NYlRkamQzZEhOR0poVkVWbVNEVTJOVk0zYUc1amFVZHFlRlIwUTJabk1IZ3JUbFZyVjNSU2VUaFhhSGxMWkhFek4wcHVNRlkzVTI1NmNVcFlXRmRMZERWUE1uTlFSbWN5Y2xWS1ZFNDRObXBzTWxkSlNUSmhRV05EVEhSTFFqazVaRFkwTkZKcVJEVlhla3hTY1hCbmFVbGhhV1oxVFVkWmJ6WnJWMHh4Y25BMVptVlJSVVIxSzNSd1VGVTRNMWRzVlVkTllpczJkU3Q1YVN0Tk5VbG1MelF4TlVOdU5XMVBWbTVSWVU5NVpXNUhjWFJ6T0RFelkwTkJkMFZCUVdGUFEwRmxkM2RuWjBodlRVTkZSMEV4VldSSlFWRmhUVUpuZDBSQldVdExkMWxDUWtGSVYyVlJTVVpCZWtGSlFtZGFibWRSZDBKQlowbDNSWGRaUkZaU01HeENRWGQzUTJkWlNVdDNXVUpDVVZWSVFYZEZkMFJCV1VSV1VqQlVRVkZJTDBKQlNYZEJSRUZrUW1kT1ZraFJORVZHWjFGVk1rVnBWSEUxVURoWk5XMW1aMVJIYmtWTmJ6WlRUVFpZZDNKQmQwaDNXVVJXVWpCcVFrSm5kMFp2UVZWUVUxZHllRU4zUmxCVVFrSnBVVlp3VkRKWksyaHlUVzFsWTBWM1dFRlpSRlpTTUdaQ1JsVjNWWHBDVW05RksyZFVXVnBNWVVoU01HTklUVFpNZVRsM1lUSnJkVmt5Vm5sa1IyeDFXbTVLYUV4dFduQmFSemxvWWtkNGNGbFhOV3BhVXpWMlkyMWpkbU15Um0xYVdGSTFZbTFXTUV3eVRubGlRemxvWkVoU2JHTXpVWFZaVnpWclkyMDVjRnBETldwaU1qQjFXVE5LYzAxSlNVSkJRVmxKUzNkWlFrSlJWVWhCVVVWRloyWk5kMmRtUVhka1FWbEpTM2RaUWtKUlZVaE5RVXRIWVVkb01HUklRbnBQYVRoMlkwZDBjRXh0VG14amJsSndZbTFhZVZsVE5XMWhWMUoyV1ZkNGMyRlhSblZaTWxWMVlqTktia3d6VG1oYWJWWXdaVmMxYkdSRE9VZFRWVkpRU2xSSmQxSnRSbkphVTFWNVRVWktkbUl6VVd4TmFrSkVXbGhLTUdGWFduQlpNa1l3V2xOVmVVMUZSakZrUjJoMlkyMXNNR1ZUVlhsTlJFbDNUVlJuZFZrelNqQk5TR2RIUTBOelIwRlJWVVpDZWtGQ2FHMTRiMlJJVW5kamVtOTJURE5DY21GVE5XcGFXRW93WVZjMWJXTnRSWFZhYld4cllqSkdjMkpIYkdoaWJVNXNURzA1ZVZwNU9YcFpWMXBzWkVoc2RWcFlVWFpaTTBwelREQmFTbEpGT0d4TmFrSkhXVmQwYkVwVVNYZFZiVGwyWkVOVmVVMUZUbXhqYmxKd1dtMXNhbGxZVW14S1ZFbDNVVmhXTUdGSE9YbGhXRkkxU2xSSmQwMXFRWGhQUXpWcVkyMTNkMFJSV1VwTGIxcEphSFpqVGtGUlJVeENVVUZFWjJkRlFrRkVWblJrTlhkTWF6UjVNVUpNVG1NeWNtRnJRa2Q1WldabGNVVnBlWFl3YmxoNFNGZFdhVlpPT1hFMGNuVnBkM0F5T1dORVlrb3pRMDVPUjNBdmIxVTBPVUZxZG1OblJERmhWVFJIZWt0alkyTnpLemsxV2xaV1RYQnRSRmhGTVd0clVIUmhZVnBEZG04M2JtZHJjVWQ1Y2xGS04ybFpkV1pvTDJ4VVF6VXZaV0ZDZFVWbVRuZHFNVmhtV1ZaUGFWSkNRbTFWYkVwQk9UWTJVbEJXVGpSalZIaDVNa0ZpYlc4NE1HZHJVVzh4YVdkbk0wNVJhV1JKVERkMFNVdGlabE14VDFWeFNsTndXSGhGU0c4NGRHWnBORzFyYTB4SE1rZE9ObFl6WmxKdEswUkZlV1ZCSzBwM05rWlVhVlo1UkUxcFoxZGxlbkV3YUhwdGVreHZRMWcxT0hSeloyb3JXRXB4ZEdOMmFYWTNlRVJGTWpaUFEwdzBVakJZT1dWSWNtOUlaVU5wTkV0dFpEZFVjazFPYTBFMGRUUmFhV0YyUjNCcmJscERaMHRtYzNBdk9IQkZPRTVwWWpkcVkxaEpUbFUxWm1aUWJGazlJaXdpVFVsSlJrdFVRME5DUWtkblFYZEpRa0ZuU1ZCQ1EySTFhVXRxV0RCV1NXMXFZM1Z6TkhkNU5VMUJNRWREVTNGSFUwbGlNMFJSUlVKRGQxVkJUVVpCZUVONlFVcENaMDVXUWtGWlZFRnNWbFJOVWxsM1JrRlpSRlpSVVV0RVFURkhVMVZTVUVsRlJuTmlSMnhvWW0xT2JFMVRhM2RLZDFsRVZsRlJSRVJEUWtkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUmtwMllqTlJaMUV3UldkTVUwSlVUVlJCWlVaM01IaE9la0Y1VFVSRmQwMUVRWGROUkVKaFJuY3dlazVVUVhoTmVrVjVUWHBWTlU1VWJHRk5SelI0UTNwQlNrSm5UbFpDUVZsVVFXeFdWRTFUYzNkTFVWbEVWbEZSUzBSRFNrZFRWVkpRU1VWR2MySkhiR2hpYlU1c1kzbENSMUZWZEVaSlJsSjVaRmhPTUVsR1RteGpibHB3V1RKV2VrMVVTWGROUVZsRVZsRlJSRVJEYkVkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUld4MVpFZFdlV0p0VmpCSlJVWXhaRWRvZG1OdGJEQmxVMEpIVFZSRFEwRlRTWGRFVVZsS1MyOWFTV2gyWTA1QlVVVkNRbEZCUkdkblJWQkJSRU5EUVZGdlEyZG5SVUpCVFVWSWJVWm1ZazU1Y0ZCMWNUazBheXRUVTBOcFZYWllVM1Z0YjJ4WmNFaFpTR2xyVUdGV01tcFJZbUpZZGtkMVNpdDNPSGw0ZWtoSFZWSkdXbEZNWmtOR1ZuSlVXakkyT1dWaWRsa3ljRTVzYUZWVGNFNUtZemRUY0dodmJGTnlPWFJEYW5WSVpFZE1NM1YyUW1Sd2VHRmFhblowWkZaRk5ubHVOVnAyUTNoNWVDOW9RV2QxUldSclpGQjFWa1Z0WkZaRWNqWTBZelk0WkRJNGIya3ZNMWx6Um01SlluRk5iblZZZGpod2NYWkdZWE5IYW1SVVYwWkRNMkYxU2tka2RUSjJOalZ6UWxVMGRsZGpja1ZHWkZscU1FMW5kMDlFTUd4dldVaGlLekI2UzBzNWQzaG1hVnBRVlZZNFNFVmFZa3QzUkZkbU5XcHZkV0ZqU21WWFdqTXlORmRHTVV4SVQycFhjbmhJWjI5RVVVSnBlbk15Y1ZWR1NuWkRUbWx1YzJGRFUwMDFTbE40VVhWc1RVZGtZa1JWVlZOMldUTnVhV3Q2Ym5KNVRuSk9ObVl2VDFKdVptc3lLMHRKZW5SamRESnJUMGxqUTBGM1JVRkJZVTlEUVdWQmQyZG5TR05OUVhOSFFURlZaRVIzVVVWQmQwbENhR3BDVlVKblRsWklVMEZGVkZSQ1RFMUZhMGRDYldWQ1JFRkZRMEZxUVM5TlJEQkhRME56UjBGUlZVWkNkMGxDUm1wR2IyUklVbmRqZW05MlRETkNjbUZUTldwYVdFb3dZVmMxYldOdFJYVmFiV3hyWWpKR2MySkhiR2hpYlU1c1RHMDVlVnA1T1hwWlYxcHNaRWhzZFZwWVVYWk5RakJIUVRGVlpFcFJVVmROUWxGSFEwTnpSMEZSVlVaQ2QwMUNRbWRuY2tKblJVWkNVV05FUVdwQlUwSm5UbFpJVWsxQ1FXWTRSVU5FUVVkQlVVZ3ZRV2RGUVUxQ01FZEJNVlZrUkdkUlYwSkNVVGxLWVhaRlRFRlZPVTFGUjBwQ1YyeFFXbW8yUjNONVdqVjNWRUZtUW1kT1ZraFRUVVZIUkVGWFowSlNZMWMxUXpSRWJqWkNOVFl6YW01Vk1tNURWSEZVV1hCMVprdEVRamxDWjA1V1NGSTRSV1JxUWpCTlNFdG5ZMHRDZFdodGVHOWtTRkozWTNwdmRrd3pRbkpoVXpWcVdsaEtNR0ZYTlcxamJVVjFXbTFzYTJJeVJuTmlSMnhvWW0xT2JFeHRPWGxhZVRsNldWZGFiR1JJYkhWYVdGRjJXVE5LYzB3d1drcFNSVGhzVFdwQ1IxbFhkR3hLVkVsM1ZXMDVkbVJEVlhsTlJVNXNZMjVTY0ZwdGJHcFpXRkpzU2xSSmQxRllWakJoUnpsNVlWaFNOVXBVU1hkTmFrRjRUME0xYW1OdGQzZG5XVkZIUTBOelIwRlJWVVpDZDBWQ1FraG5kMlJxUWpCQ1oyZHlRbWRGUmtKUlkzZEJXVnB2WVVoU01HTklUVFpNZVRsM1lUSnJkVmt5Vm5sa1IyeDFXbTVLYUV4dFduQmFSemxvWWtkNGNGbFhOV3BhVXpWMlkyMWpkbU15Um0xYVdGSTFZbTFXTUV3d1drcFNSVGhzVFdwQ1IxbFhkR3hLVkVsM1ZXMDVkbVJEVlhsTlJVNXNZMjVTY0ZwdGJHcFpXRkpzU2xSSmQxRllWakJoUnpsNVlWaFNOVXBVU1hkTmFrRjRUME0xYW1OdVVYZEVVVmxLUzI5YVNXaDJZMDVCVVVWTVFsRkJSR2RuUlVKQlEwb3JMMWxCVDBaaVpFZG9jMFZXWXpsS2VqTkVZVlpxZUZSeVVsQm9TM05NWTNsT01qTkxXWG9yVHpJNGJtRkhSR3RYTkc5cVIwRXZPSEpvY25RNU56aGtUelY0VDFaUlZEWkJhVEJQYm5oUVMzUlBZMUpwVURSMlJIZ3pSMFJrVEZSSE9XbEZNVXhQYkZWWVNHTnNabWRWWkhJNWVVNDNhSFp4VWtOMU1tOUNSbGRTVlVkWFRVNTRNR2R6WjJ4TFkyVnVTbTlEUkdSNVduaDNVWGhVTTBaM1IxQlRhbTFNTnpWRFZrbGxSVk0zVFM5U2RsWXJUVlZGUzNkNGJtMVBMMlIxY1ZCb2RYaElha0ZGY21SeE0xWnpTMGwyWXpVclFtY3JOazUyWkRKek5ERjZVMmgyUTBnMWVEa3phVTlyWmpWVFpUQTBaMlpNTlZveFMwbGtUMGRSUWtSRWVIcEdRbnBVWVVZNFRVNTJVbk5OZDNkcmN6bGtRVVpCV1Rod1JFZHNORXN5TkhOaWRtNTNkWFEzVFVWSWVsSlBha29yUjFGeWVqRmtiRFExVms1aFQyNHZhRm80UTBGek0wRTRkM2cwWW1GSlBTSmRmUS5leUp1YjI1alpTSTZJa05GV25aUVpqZDVRMUZzYUVoRlNtOUhhblZqVTJrNWVqRmpla2RSVEhkSGFGQnlibVJzWlRVM1V6QTlJaXdpZEdsdFpYTjBZVzF3VFhNaU9qRTJOVGs0TXpJeE5qZ3hPRGdzSW1Gd2ExQmhZMnRoWjJWT1lXMWxJam9pWTI5dExtRnVaSEp2YVdRdWEyVjVjM1J2Y21VdVlXNWtjbTlwWkd0bGVYTjBiM0psWkdWdGJ5SXNJbUZ3YTBScFoyVnpkRk5vWVRJMU5pSTZJbVJOTDB4VlNGTkpPVk5yVVdoYVNFaHdVVmRTYm5wS00wMTJka0l5UVU1VFlYVnhXVUZCWWxNeVNtYzlJaXdpWVhCclEyVnlkR2xtYVdOaGRHVkVhV2RsYzNSVGFHRXlOVFlpT2xzaVluTmlOQzlYVVdSaFlVOVhXVU5rTDJvNVQwcHBVWEJuTjJJd2FYZEdaMEZqTDNwNlFURjBRMlozUlQwaVhTd2lZM1J6VUhKdlptbHNaVTFoZEdOb0lqcDBjblZsTENKaVlYTnBZMGx1ZEdWbmNtbDBlU0k2ZEhKMVpYMC5YNFpYMXBtS005OXJocThyNXhUTFlfM0g2MjRCYTZHNXJCazR5R3dsNGtVUnhNRDZEQXcwaEZaVFZpLXc1QmdGV0xWYjVNb2VUMmxUZUw1Tk9vVDY5b01qek4tN3dDcVdGa0w5Xy1ONFpwQXk2aWIxdWs3eG5iN3ZHcnlsb0o0Q3p3bDB5cC12d1BsMDgwdzhVVXU2TjFsTzBJS19BbjFnODFJSVZZZk1qQ0JQejRPZEZxeFh1SHRWMEpXRzk0andFUUJrOXRmeUNMR25wdVhzR3RFUkxzV2U3N2MzYUJzcWY1LVkyNlpfYTBINzJYNUVaRU5fa2FiODJHV2p3Q0dmZVpaT2NzQVVIOENpSDYwMkl5U2ZadHo1Uy1iV09IRTNRZlAtXzZpelpTTG43MTZNZV9VdFZpSlpzckZFZUJDUTVodjctMEhmbUJPUTQ0RzFDS29ZUHdoYXV0aERhdGFZAWeIR20dSr50NYH9fr2gLeUAShXskXlzq1Q6gy8s2HtuGUEAAABxyHzdl1bBSbieJMs2NlTzUAAgd7XmNKs0tMlpq4BQWqji5yuOYO9jafKPRGEhHuUMAD2kAQMDOQEAIFkBAKD0elziSAkrmikjxbDCUkXN20TUZ38cFepjsgG395tU2Yhb06ATz8yBZFSQv4ulX0oGQw4TY1c_X9fr-QV6miJwdl3IB1H-7D8xJrQpKerspNNHuJ6ZHziOoN1OF2l4rc1qnmblblAoYCqycjUMpyuPgZqR7gGkv_r5GexVsx02p3VVqSZhhDkrGKKAuHgiVGuBe7uvoE7NN-Voo3doathG3Fxg-O0KVQXu0glk-EkZszUxDZj6zM03L3gzQBTzQ256fUdHZ3EJw4wvM3yH7OAE5ZThkVMbs9FngGXo6q9zIpFZAVNX6tMxFjGP1oy_NccNtmuGGLeabyE7s01ANIchQwEAAQ';
      const clientDataJSON =
        'eyJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY2hhbGxlbmdlIjoiNmFRMk5Id28weUR0OGZHeExTc05FOXEwcUtNbVhBYk92VXBua0pPLUJCeWRTWThiUmNJRnpDaENfSzN6RTZ5R0ZVQkZ5dS1tem51VDJPUlFRWmVfOGciLCJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIn0';
      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const as = new AndroidSafenetFormat();
      as.config(attStmt, result as any, {} as any, {});

      const verified = await as.verify();

      clock.restore();
      t.ok(verified.isValid);
      t.same(verified.attestationType, ['Basic']);
      t.ok(Array.isArray(verified.attestationTrustPath));
      t.notSame(verified.attestationStatementAlg, null);
      t.notSame(verified.attestationStatementX5c, null);
      t.ok(verified.isValidCertificateChain);
      const others = verified.others as FslAndroidSafetynetFormatVerifyResultOthers;
      if (others != null) {
        t.equal(others.attestationFormat, 'android-safetynet');
        t.notSame(others.response, null);
        t.notSame(others.ver, null);
        t.notSame(others.headerJSON, null);
        t.notSame(others.payloadJSON, null);
        t.notSame(others.signature, null);
        t.notSame(others.timestampMs, null);
        t.notSame(others.nonce, null);
        t.notSame(others.apkPackageName, null);
        t.notSame(others.apkCertificateDigestSha256, null);
        t.notSame(others.ctsProfileMatch, null);
        t.notSame(others.basicIntegrity, null);
      } else {
        t.fail();
      }

      t.end();
    });

    t.test('### ver or response is not contained in attStmt', async (t) => {
      const attestationObject =
        'o2NmbXRxYW5kcm9pZC1zYWZldHluZXRnYXR0U3RtdKJjdmVyYGhyZXNwb25zZVkV9WV5SmhiR2NpT2lKU1V6STFOaUlzSW5nMVl5STZXeUpOU1VsR1ZtcERRMEpFTm1kQmQwbENRV2RKVUVKUVRHUnpjRTQ0V1V0aFdITXpUREZJVVdoTVRVRXdSME5UY1VkVFNXSXpSRkZGUWtOM1ZVRk5SelI0UTNwQlNrSm5UbFpDUVZsVVFXeFdWRTFUYzNkTFVWbEVWbEZSUzBSRFNrZFRWVkpRU1VWR2MySkhiR2hpYlU1c1kzbENSMUZWZEVaSlJsSjVaRmhPTUVsR1RteGpibHB3V1RKV2VrMVVTWGROUVZsRVZsRlJSRVJEYkVkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUld4MVpFZFdlV0p0VmpCSlJVWXhaRWRvZG1OdGJEQmxVMEpIVFZSQlpVWjNNSGxOVkVFMFRWUlJlRTVVUVROTlJFSmhSbmN3ZVUxNlFUUk5WRkY0VGxSQk0wMUVRbUZOU0VWNFEzcEJTa0puVGxaQ1FWbFVRV3hXVkUxUmMzZERVVmxFVmxGUlNVUkJTazVYVkVWVFRVSkJSMEV4VlVWQ2QzZEtWakpHY2xwWFduQmFWM2hyVFZKWmQwWkJXVVJXVVZGTFJFRXhSMU5WVWxCSlJVWnpZa2RzYUdKdFRteE5VWGQzUTJkWlJGWlJVVXhFUVU1RVZqQmplRWQ2UVZwQ1owNVdRa0ZOVFVWdFJqQmtSMVo2WkVNMWFHSnRVbmxpTW14clRHMU9kbUpVUTBOQlUwbDNSRkZaU2t0dldrbG9kbU5PUVZGRlFrSlJRVVJuWjBWUVFVUkRRMEZSYjBOblowVkNRVXQxV0d0RFlUTlBMMGxWVEhoQ01GTmFUbFY1UVdKclVWRjFlbkJFWlRGUlYzWjFUR1Y1V21KeldYZHFhVVozWms1dWJ5OVllbGRNU21wWGRIZzFVRk5NTDJ0RVZubHBRemcwY2xCVlFqa3lTalpPYkRKblpqaGhPRnBDWW5GSGVrOU9kbkoxV2xkNFV6bHNabEV4VXpVM2VXcEhaRVJKVFhOclNsVjZWMmd4WkdwV1VsUXlValZ0UVdWYVNXbFdVa1ZyTUVOamVtSnlNeXRzYlRoeFdtOVlUR1ZRTkRoVk1FZHdSbEZVTVhsM2FVcEZjR3RUU21odU5sSlRTSFZpV0haNVNFcDVOMWxFVURKMFQycEhSVE5MTnpFMlZVRkZhbEozYm5neVRrdGpUVVpUVGxGRVN6ZGxZazFFU0c5VmVWUTJlakpVZDAxbGNuaEhMMjFKZW1NM1RXRlNhbXczVlZVM1JIazJiaTlyYkRKWVZXVXlielkxV0RJNVlWazJiVkJMTUZwWWNXRlNhMUI0Y0VkR1ZrVkxaRUZuVVd0SFJqaEtValppVVZRd1N6UjJjVlJhU0dacFRYSmlZVEZUV25CbFltMDFUVU5CZDBWQlFXRlBRMEZsZDNkblowaHZUVU5GUjBFeFZXUkpRVkZoVFVKbmQwUkJXVXRMZDFsQ1FrRklWMlZSU1VaQmVrRkpRbWRhYm1kUmQwSkJaMGwzUlhkWlJGWlNNR3hDUVhkM1EyZFpTVXQzV1VKQ1VWVklRWGRGZDBSQldVUldVakJVUVZGSUwwSkJTWGRCUkVGa1FtZE9Wa2hSTkVWR1oxRlZkbkpqZGpsWlRscE5kRk4zYkZreFYyWlpPRGt3ZW1sck1tWnZkMGgzV1VSV1VqQnFRa0puZDBadlFWVlFVMWR5ZUVOM1JsQlVRa0pwVVZad1ZESlpLMmh5VFcxbFkwVjNXRUZaUkZaU01HWkNSbFYzVlhwQ1VtOUZLMmRVV1ZwTVlVaFNNR05JVFRaTWVUbDNZVEpyZFZreVZubGtSMngxV201S2FFeHRXbkJhUnpsb1lrZDRjRmxYTldwYVV6VjJZMjFqZG1NeVJtMWFXRkkxWW0xV01Fd3lUbmxpUXpsb1pFaFNiR016VVhWWlZ6VnJZMjA1Y0ZwRE5XcGlNakIxV1ROS2MwMUpTVUpCUVZsSlMzZFpRa0pSVlVoQlVVVkZaMlpOZDJkbVFYZGtRVmxKUzNkWlFrSlJWVWhOUVV0SFlVZG9NR1JJUW5wUGFUaDJZMGQwY0V4dFRteGpibEp3WW0xYWVWbFROVzFoVjFKMldWZDRjMkZYUm5WWk1sVjFZak5LYmt3elRtaGFiVll3WlZjMWJHUkRPVWRUVlZKUVNsUkpkMUp0Um5KYVUxVjVUVVpLZG1JelVXeE5ha0pFV2xoS01HRlhXbkJaTWtZd1dsTlZlVTFGUmpGa1IyaDJZMjFzTUdWVFZYbE5SRWwzVFZSbmRWa3pTakJOU0dkSFEwTnpSMEZSVlVaQ2VrRkNhRzE0YjJSSVVuZGplbTkyVEROQ2NtRlROV3BhV0Vvd1lWYzFiV050UlhWYWJXeHJZakpHYzJKSGJHaGliVTVzVEcwNWVWcDVPWHBaVjFwc1pFaHNkVnBZVVhaWk0wcHpUREJhU2xKRk9HeE5ha0pIV1ZkMGJFcFVTWGRWYlRsMlpFTlZlVTFGVG14amJsSndXbTFzYWxsWVVteEtWRWwzVVZoV01HRkhPWGxoV0ZJMVNsUkpkMDFxUVhoUFF6VnFZMjEzZDBSUldVcExiMXBKYUhaalRrRlJSVXhDVVVGRVoyZEZRa0ZDV2s1bk0yY3phVE5hZHpObVJYWkVUM1ZIYlVkYU5UVkNaMVZIYVUwNE0zVmpOQzl3U3pBNFoxcHRlVzE0WlRsWGNXYzVkekp3ZW0xRU1XeFBUbEEzZGs4elpURktja1ZpYTFKblJHTkhNbVZHS3pKWFdHeERUVEI1YW5sWlZpOTVNV1ZWWjNaTlRWVjRVSFpCY0RFM1lsVnFSM1J3ZGtSclRrNWFLM2s1Y21jemExbHhhRVJVVlU1eVUzb3hTR2R5YmpCck1sSTBNakpDUWxkT2MzWnJhVTF1YjFaRGVFRktabVZ0YVZKNVRtaFVVU3RNYjNCRFREUlBTbW9yVVdwbGJIQnZNekppTlZCUU9UbEdPREJLUVVwRVR6SmFXSFZ2YURsSFdYZHJXRWhITWk4NFJGcHNSV0pOYTBaTk16a3dWRWhRTTNKQ1drOUNXblJsV1RCUGFVcFpRalVyTTFwc1pFVXdabXREU2tkT1drWlhhamt2ZVdvNFMyTkphR2M1Y0ZGU1dsVlZSblJMWWxVMmF6aHVaRWRZZUdzeGRqUktTRGc1VWxVelpVcGhLMGhYUmxoMFdEUlFhREo1WlRsdlJuVlpRbWM5SWl3aVRVbEpSa3RVUTBOQ1FrZG5RWGRKUWtGblNWQkNRMkkxYVV0cVdEQldTVzFxWTNWek5IZDVOVTFCTUVkRFUzRkhVMGxpTTBSUlJVSkRkMVZCVFVaQmVFTjZRVXBDWjA1V1FrRlpWRUZzVmxSTlVsbDNSa0ZaUkZaUlVVdEVRVEZIVTFWU1VFbEZSbk5pUjJ4b1ltMU9iRTFUYTNkS2QxbEVWbEZSUkVSRFFrZFRWVkpRU1VWR2MySkhiR2hpYlU1c1kzbENSMUZWZEVaSlJrcDJZak5SWjFFd1JXZE1VMEpVVFZSQlpVWjNNSGhPZWtGNVRVUkZkMDFFUVhkTlJFSmhSbmN3ZWs1VVFYaE5la1Y1VFhwVk5VNVViR0ZOUnpSNFEzcEJTa0puVGxaQ1FWbFVRV3hXVkUxVGMzZExVVmxFVmxGUlMwUkRTa2RUVlZKUVNVVkdjMkpIYkdoaWJVNXNZM2xDUjFGVmRFWkpSbEo1WkZoT01FbEdUbXhqYmxwd1dUSldlazFVU1hkTlFWbEVWbEZSUkVSRGJFZFRWVkpRU1VWR2MySkhiR2hpYlU1c1kzbENSMUZWZEVaSlJXeDFaRWRXZVdKdFZqQkpSVVl4WkVkb2RtTnRiREJsVTBKSFRWUkRRMEZUU1hkRVVWbEtTMjlhU1doMlkwNUJVVVZDUWxGQlJHZG5SVkJCUkVORFFWRnZRMmRuUlVKQlRVVkliVVptWWs1NWNGQjFjVGswYXl0VFUwTnBWWFpZVTNWdGIyeFpjRWhaU0dsclVHRldNbXBSWW1KWWRrZDFTaXQzT0hsNGVraEhWVkpHV2xGTVprTkdWbkpVV2pJMk9XVmlkbGt5Y0U1c2FGVlRjRTVLWXpkVGNHaHZiRk55T1hSRGFuVklaRWRNTTNWMlFtUndlR0ZhYW5aMFpGWkZObmx1TlZwMlEzaDVlQzlvUVdkMVJXUnJaRkIxVmtWdFpGWkVjalkwWXpZNFpESTRiMmt2TTFselJtNUpZbkZOYm5WWWRqaHdjWFpHWVhOSGFtUlVWMFpETTJGMVNrZGtkVEoyTmpWelFsVTBkbGRqY2tWR1pGbHFNRTFuZDA5RU1HeHZXVWhpS3pCNlMwczVkM2htYVZwUVZWWTRTRVZhWWt0M1JGZG1OV3B2ZFdGalNtVlhXak15TkZkR01VeElUMnBYY25oSVoyOUVVVUpwZW5NeWNWVkdTblpEVG1sdWMyRkRVMDAxU2xONFVYVnNUVWRrWWtSVlZWTjJXVE51YVd0NmJuSjVUbkpPTm1ZdlQxSnVabXN5SzB0SmVuUmpkREpyVDBsalEwRjNSVUZCWVU5RFFXVkJkMmRuU0dOTlFYTkhRVEZWWkVSM1VVVkJkMGxDYUdwQ1ZVSm5UbFpJVTBGRlZGUkNURTFGYTBkQ2JXVkNSRUZGUTBGcVFTOU5SREJIUTBOelIwRlJWVVpDZDBsQ1JtcEdiMlJJVW5kamVtOTJURE5DY21GVE5XcGFXRW93WVZjMWJXTnRSWFZhYld4cllqSkdjMkpIYkdoaWJVNXNURzA1ZVZwNU9YcFpWMXBzWkVoc2RWcFlVWFpOUWpCSFFURlZaRXBSVVZkTlFsRkhRME56UjBGUlZVWkNkMDFDUW1kbmNrSm5SVVpDVVdORVFXcEJVMEpuVGxaSVVrMUNRV1k0UlVORVFVZEJVVWd2UVdkRlFVMUNNRWRCTVZWa1JHZFJWMEpDVVRsS1lYWkZURUZWT1UxRlIwcENWMnhRV21vMlIzTjVXalYzVkVGbVFtZE9Wa2hUVFVWSFJFRlhaMEpTWTFjMVF6UkVialpDTlRZemFtNVZNbTVEVkhGVVdYQjFaa3RFUWpsQ1owNVdTRkk0UldScVFqQk5TRXRuWTB0Q2RXaHRlRzlrU0ZKM1kzcHZka3d6UW5KaFV6VnFXbGhLTUdGWE5XMWpiVVYxV20xc2EySXlSbk5pUjJ4b1ltMU9iRXh0T1hsYWVUbDZXVmRhYkdSSWJIVmFXRkYyV1ROS2Mwd3dXa3BTUlRoc1RXcENSMWxYZEd4S1ZFbDNWVzA1ZG1SRFZYbE5SVTVzWTI1U2NGcHRiR3BaV0ZKc1NsUkpkMUZZVmpCaFJ6bDVZVmhTTlVwVVNYZE5ha0Y0VDBNMWFtTnRkM2RuV1ZGSFEwTnpSMEZSVlVaQ2QwVkNRa2huZDJScVFqQkNaMmR5UW1kRlJrSlJZM2RCV1ZwdllVaFNNR05JVFRaTWVUbDNZVEpyZFZreVZubGtSMngxV201S2FFeHRXbkJhUnpsb1lrZDRjRmxYTldwYVV6VjJZMjFqZG1NeVJtMWFXRkkxWW0xV01Fd3dXa3BTUlRoc1RXcENSMWxYZEd4S1ZFbDNWVzA1ZG1SRFZYbE5SVTVzWTI1U2NGcHRiR3BaV0ZKc1NsUkpkMUZZVmpCaFJ6bDVZVmhTTlVwVVNYZE5ha0Y0VDBNMWFtTnVVWGRFVVZsS1MyOWFTV2gyWTA1QlVVVk1RbEZCUkdkblJVSkJRMG9yTDFsQlQwWmlaRWRvYzBWV1l6bEtlak5FWVZacWVGUnlVbEJvUzNOTVkzbE9Nak5MV1hvclR6STRibUZIUkd0WE5HOXFSMEV2T0hKb2NuUTVOemhrVHpWNFQxWlJWRFpCYVRCUGJuaFFTM1JQWTFKcFVEUjJSSGd6UjBSa1RGUkhPV2xGTVV4UGJGVllTR05zWm1kVlpISTVlVTQzYUhaeFVrTjFNbTlDUmxkU1ZVZFhUVTU0TUdkeloyeExZMlZ1U205RFJHUjVXbmgzVVhoVU0wWjNSMUJUYW0xTU56VkRWa2xsUlZNM1RTOVNkbFlyVFZWRlMzZDRibTFQTDJSMWNWQm9kWGhJYWtGRmNtUnhNMVp6UzBsMll6VXJRbWNyTms1MlpESnpOREY2VTJoMlEwZzFlRGt6YVU5clpqVlRaVEEwWjJaTU5Wb3hTMGxrVDBkUlFrUkVlSHBHUW5wVVlVWTRUVTUyVW5OTmQzZHJjemxrUVVaQldUaHdSRWRzTkVzeU5ITmlkbTUzZFhRM1RVVkllbEpQYWtvclIxRnllakZrYkRRMVZrNWhUMjR2YUZvNFEwRnpNMEU0ZDNnMFltRkpQU0pkZlEuZXlKdWIyNWpaU0k2SW1GdVlqbGhibTVJVXpndmFUaGpjbGhQWTFWUlYwZHZiVXhDVjJKM1lXVnVaVXhXZW5aelQweHJUM2M5SWl3aWRHbHRaWE4wWVcxd1RYTWlPakUyTmpBME9EazJNakF6TlRNc0ltRndhMUJoWTJ0aFoyVk9ZVzFsSWpvaVkyOXRMbUZ1WkhKdmFXUXVhMlY1YzNSdmNtVXVZVzVrY205cFpHdGxlWE4wYjNKbFpHVnRieUlzSW1Gd2EwUnBaMlZ6ZEZOb1lUSTFOaUk2SW1STkwweFZTRk5KT1ZOclVXaGFTRWh3VVZkU2JucEtNMDEyZGtJeVFVNVRZWFZ4V1VGQllsTXlTbWM5SWl3aVlYQnJRMlZ5ZEdsbWFXTmhkR1ZFYVdkbGMzUlRhR0V5TlRZaU9sc2lZbk5pTkM5WFVXUmhZVTlYV1VOa0wybzVUMHBwVVhCbk4ySXdhWGRHWjBGakwzcDZRVEYwUTJaM1JUMGlYU3dpWTNSelVISnZabWxzWlUxaGRHTm9JanAwY25WbExDSmlZWE5wWTBsdWRHVm5jbWwwZVNJNmRISjFaWDAuSkJycDZSNGttUVczSW1ySDRwUzZoaFRob08zMUo1WHNHdWJOY0QtZlNWdmhHS2pxRU9DSjNaSVZpcExSVkh0N0xkWW9DUGx5dEptWHRLSnI1d3ZmQ3l3SGdyRi00R1JLVUJlYUlkdlpvN0k4VHRSWXZDa3l6M2JJLUpNU0I1a2xmMGg2WFJNQjJFLXhXUVNSN0xDZWZBaVAxRFlFaE9SemtleXNiZV9QY01TeEV4LWYyRVNBemlwVWNkQjdJb1EyeDlUV25rODNGdlllNjVyVnlMQXBjNWhCekc4bGpiejE1aF9wYnc3UXhJY01JbHpnVUtxTnJLWTk4NnRpcVFOQ3VoRFNYWERNWF9zdnVTV0hfX1h0dU04Q0wwU0dVcnZzejRBVUxRMVBrbDV1QlkzTUdHdWxvVEtZNk40alRuaHBUenBSUnNYTEw2NzRYenNYZFR2QnJRaGF1dGhEYXRhWQFniEdtHUq-dDWB_X69oC3lAEoV7JF5c6tUOoMvLNh7bhlBAAAAf8h83ZdWwUm4niTLNjZU81AAINdYocIdNUpU5d_HK21zw7zs7cqI2RxpvjD_BRVm0D9KpAEDAzkBACBZAQCP_LA8tP_NKjjiEEpAjwNqGR-RF6toUPWcDdZgLuhD9uTgfkOF5ouxZqMrzlkLx0ZzJcJQdYFcMuzorBngZVIMHUFOXghPXTp6Z03PMAf6BytzPvTPOBrVpXAH-C5kwT5yeLRoi5-oVmIjip7ATJ5V6yhcACrjiZ8rgKwkaAVHQ3PzIq2PGHB8g9vGIs8TV1eR35D1EBJbftm9e3FMhA4SFg9Ar6k4P3hUA4e_yRJ0ekBRAXtYmc9HbMaUOIKheEux3h76ZNYrURz4LnLUE0MneHZA3ggGL4pSlyeEdX4zcNbnUE1mZfo4I706DmiGKDARGSI-P-1yO_wh0CInXI2JIUMBAAE';
      const clientDataJSON =
        'eyJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY2hhbGxlbmdlIjoiRkpYc21vY3ROQ2Rmb1VISzU4Sko5bW4zUGVwY1BZb3QtdVN2MW8zTGdCQm5VQ1lWRFB0alg2eVdjTlZFNUhxVGc2cVduT05KZkVjajFCbmNXaWJZZ2ciLCJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIn0';
      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const as = new AndroidSafenetFormat();
      as.config(attStmt, result as any, {} as any, {});

      try {
        const verified = await as.verify();
        t.fail('not come here');
      } catch (err) {
        t.match(err.message, /android-safetynet:ver and response must be contained in attStmt*/);
      }

      t.end();
    });

    t.test('### JWS is malformat', async (t) => {
      const attestationObject =
        'o2NmbXRxYW5kcm9pZC1zYWZldHluZXRnYXR0U3RtdKJjdmVyaDEyNjg1MDIzaHJlc3BvbnNlYGhhdXRoRGF0YVkBZ4hHbR1KvnQ1gf1-vaAt5QBKFeyReXOrVDqDLyzYe24ZQQAAAIDIfN2XVsFJuJ4kyzY2VPNQACCzVm4aaVhbAz7bvsnhqa1Tvj-kVkS9eWGUt2yWLVMD6aQBAwM5AQAgWQEAsqhH9UdyhbQXTJCO1plKTP4ZH5Zr48SAr0sqkHyau4VNfHavZn-5KaWe_MzpJ2j9Jgmz-Vefdf6tFz1Z6bjX6XvSIUjoPIHCB-MddJpMzRt72Z3bHV6SqJnmdC4BADDxl6YbsX5JLOHxO9KnMTb1OoM4ourSBKQthtwAHmNPLjaoAyOUlck0nyCbek984eyQzjEHba4_IFtvFDJccDuSQ05hFqD50DbQJkniG8LPkwapyIPG-nveClraPWvHTLXuJ22QtG8BHkzUXjcbEEu1vfMsWEYcVQOpb-FvaGfySh3ty-r4jsouVKbiHZN8pLojX8q2YRDyJHbgqXk_oXQ2JyFDAQAB';
      const clientDataJSON =
        'eyJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY2hhbGxlbmdlIjoiaDRUNkc3NlpkRm0ya0V0Ql9BdFpKenhFYTlnWElVeThSVVlMREszUUZBZkdsdXg1aHNveC1pQktBMTRyT1JGeDFLVDFIRi03ekpZcEd2OTFPOGdtcVEiLCJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIn0';
      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const as = new AndroidSafenetFormat();
      as.config(attStmt, result as any, {} as any, {});

      try {
        const verified = await as.verify();
        t.fail('not come here');
      } catch (err) {
        t.match(err.message, /android-safetynet:JWS is malformat\.*/);
      }

      t.end();
    });

    t.test('### timestampMs is after now', async (t) => {
      const clock = sinon.useFakeTimers({
        now: dayjs('2022-08-07T01:29:30.156Z').valueOf(),
      });

      const attestationObject =
        'o2NmbXRxYW5kcm9pZC1zYWZldHluZXRnYXR0U3RtdKJjdmVyaDEyNjg1MDIzaHJlc3BvbnNlWRX1ZXlKaGJHY2lPaUpTVXpJMU5pSXNJbmcxWXlJNld5Sk5TVWxHVm1wRFEwSkVObWRCZDBsQ1FXZEpVRUpLYTI5eVRXVjJjRzh3Y1cxQlN6RlFkbXhpVFVFd1IwTlRjVWRUU1dJelJGRkZRa04zVlVGTlJ6UjRRM3BCU2tKblRsWkNRVmxVUVd4V1ZFMVRjM2RMVVZsRVZsRlJTMFJEU2tkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUmxKNVpGaE9NRWxHVG14amJscHdXVEpXZWsxVVNYZE5RVmxFVmxGUlJFUkRiRWRUVlZKUVNVVkdjMkpIYkdoaWJVNXNZM2xDUjFGVmRFWkpSV3gxWkVkV2VXSnRWakJKUlVZeFpFZG9kbU50YkRCbFUwSkhUVlJCWlVaM01IbE5WRUUwVFZSUmVFNVVRVE5OUkVaaFJuY3dlVTE2UVRSTlZGRjRUbFJCTTAxRVJtRk5TRVY0UTNwQlNrSm5UbFpDUVZsVVFXeFdWRTFSYzNkRFVWbEVWbEZSU1VSQlNrNVhWRVZUVFVKQlIwRXhWVVZDZDNkS1ZqSkdjbHBYV25CYVYzaHJUVkpaZDBaQldVUldVVkZMUkVFeFIxTlZVbEJKUlVaellrZHNhR0p0VG14TlVYZDNRMmRaUkZaUlVVeEVRVTVFVmpCamVFZDZRVnBDWjA1V1FrRk5UVVZ0UmpCa1IxWjZaRU0xYUdKdFVubGlNbXhyVEcxT2RtSlVRME5CVTBsM1JGRlpTa3R2V2tsb2RtTk9RVkZGUWtKUlFVUm5aMFZRUVVSRFEwRlJiME5uWjBWQ1FVMXhWMjVRUm1wUFZrUjBOVUZrUzA4elNHRlFVMWR0ZWpWblQyRnlaMFJNVUUwMGEwRkliMlprTTJrMFEySkRLelZUVEV4cU5GTlJkR1JLYVZaT01FcE9XaTkxVTJWNlVtcEhjakV3TWpSU01tRm9lV0ZXTkRBNE5IVkhSbWMyT0ZrNVlrTk5aa2tyYVd0YVZEaDZhVEVyY25CblZUSjBXbkExWlZOQ1NVZHZVeTlsTHpobFVYRmthRFZEUWtoNFlUZG5TMVpZUVhsbVUwUlpiVk5UUld4NFZWRXlkbUZGTW00eldtMTFWa1pPWldVMFlWZHpRbTlSYTJoUFpuTTNNMXB0YkVOYU1rNXBiMFpGU1ZGSU1tNW5SMUV2V2tVdlZUSnBiMkpaZUVkeWMyTlJkakJ5ZDI1alZFTndNSEJTZFVsRGFYcE9PVUV5TVZkdlprSjNRVEYyU0c5WU1XZEJaVzlQVjI4d2NUVmxabWh2WXk5T05HaHlPVXhzY1RBdmNqa3hOMGM0UkRaUU1HOWFTVkp4UTNGeFlWTnRXWG94ZG1WR1pWUjBTRGRWWkc5NGVIUk9NR1JtVkZkVWNqSlFWVkpqVW1GSWEwTkJkMFZCUVdGUFEwRmxkM2RuWjBodlRVTkZSMEV4VldSSlFWRmhUVUpuZDBSQldVdExkMWxDUWtGSVYyVlJTVVpCZWtGSlFtZGFibWRSZDBKQlowbDNSWGRaUkZaU01HeENRWGQzUTJkWlNVdDNXVUpDVVZWSVFYZEZkMFJCV1VSV1VqQlVRVkZJTDBKQlNYZEJSRUZrUW1kT1ZraFJORVZHWjFGVmRqQnNjVXM0VmpBNU5FWkVNbkZ3UkN0Q1JuVTJWVmhyVEVNMGQwaDNXVVJXVWpCcVFrSm5kMFp2UVZWUVUxZHllRU4zUmxCVVFrSnBVVlp3VkRKWksyaHlUVzFsWTBWM1dFRlpSRlpTTUdaQ1JsVjNWWHBDVW05RksyZFVXVnBNWVVoU01HTklUVFpNZVRsM1lUSnJkVmt5Vm5sa1IyeDFXbTVLYUV4dFduQmFSemxvWWtkNGNGbFhOV3BhVXpWMlkyMWpkbU15Um0xYVdGSTFZbTFXTUV3eVRubGlRemxvWkVoU2JHTXpVWFZaVnpWclkyMDVjRnBETldwaU1qQjFXVE5LYzAxSlNVSkJRVmxKUzNkWlFrSlJWVWhCVVVWRloyWk5kMmRtUVhka1FWbEpTM2RaUWtKUlZVaE5RVXRIWVVkb01HUklRbnBQYVRoMlkwZDBjRXh0VG14amJsSndZbTFhZVZsVE5XMWhWMUoyV1ZkNGMyRlhSblZaTWxWMVlqTktia3d6VG1oYWJWWXdaVmMxYkdSRE9VZFRWVkpRU2xSSmQxSnRSbkphVTFWNVRVWktkbUl6VVd4TmFrSkVXbGhLTUdGWFduQlpNa1l3V2xOVmVVMUZSakZrUjJoMlkyMXNNR1ZUVlhsTlJFbDNUVlJuZFZrelNqQk5TR2RIUTBOelIwRlJWVVpDZWtGQ2FHMTRiMlJJVW5kamVtOTJURE5DY21GVE5XcGFXRW93WVZjMWJXTnRSWFZhYld4cllqSkdjMkpIYkdoaWJVNXNURzA1ZVZwNU9YcFpWMXBzWkVoc2RWcFlVWFpaTTBwelREQmFTbEpGT0d4TmFrSkhXVmQwYkVwVVNYZFZiVGwyWkVOVmVVMUZUbXhqYmxKd1dtMXNhbGxZVW14S1ZFbDNVVmhXTUdGSE9YbGhXRkkxU2xSSmQwMXFRWGhQUXpWcVkyMTNkMFJSV1VwTGIxcEphSFpqVGtGUlJVeENVVUZFWjJkRlFrRktWMnhwZVhCNVVFTkdXVE5WVmtOQmQydFhXbkpJTVRNMFVFRnlVSGg2VEdWWmJHdGhRMU5SVlVSWU16YzNiSEpzY21kcFUyZHpkMEl4WjNKT1ZFbEhlWGhZWkhWaFVYbHFSMlV5UlN0MUt6VnBVbU12V0hST1dFRjVja052U2poamVURnVXSE12T1RWMk5sZGlXbGRCTXpSTU5uTjRRM2xpZEVKamFWbEliblZKYUd0SlZURnhiVGg2WVhaeFRFVk1MMFpYTlVFeGVYWndjbVpCVW1sc1JDdDRaVWhNYURKMVdFWmpWR3gwVG5wcFRFb3liemhQZEVGSmFGZFphMFpSUkdReWVFdFJValpaYVV0VlVGRXhVVmczZW1JMlpXNXdiRlV5V1V0d1ZsWkxjRTByVUdwMGIybHVXamc1ZGt4dGVERjJTblJ2VWs0M04zQnBPRU5HUkVNeWFuVjFhMlYwZERkRVFWUTRNRWxxVWpWRFZHRmxTREpNYzFWM2FYZDBkRTgxTDNsdU1HbHNUWGxxY214NVNUVjNWRGRsY3paS1pXZ3pUVFpvWjB0NU4wOWxVVlp6VkU5WmIzUnhjV3RFTVVrd2EzYzlJaXdpVFVsSlJrdFVRME5DUWtkblFYZEpRa0ZuU1ZCQ1EySTFhVXRxV0RCV1NXMXFZM1Z6TkhkNU5VMUJNRWREVTNGSFUwbGlNMFJSUlVKRGQxVkJUVVpCZUVONlFVcENaMDVXUWtGWlZFRnNWbFJOVWxsM1JrRlpSRlpSVVV0RVFURkhVMVZTVUVsRlJuTmlSMnhvWW0xT2JFMVRhM2RLZDFsRVZsRlJSRVJEUWtkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUmtwMllqTlJaMUV3UldkTVUwSlVUVlJCWlVaM01IaE9la0Y1VFVSRmQwMUVRWGROUkVKaFJuY3dlazVVUVhoTmVrVjVUWHBWTlU1VWJHRk5SelI0UTNwQlNrSm5UbFpDUVZsVVFXeFdWRTFUYzNkTFVWbEVWbEZSUzBSRFNrZFRWVkpRU1VWR2MySkhiR2hpYlU1c1kzbENSMUZWZEVaSlJsSjVaRmhPTUVsR1RteGpibHB3V1RKV2VrMVVTWGROUVZsRVZsRlJSRVJEYkVkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUld4MVpFZFdlV0p0VmpCSlJVWXhaRWRvZG1OdGJEQmxVMEpIVFZSRFEwRlRTWGRFVVZsS1MyOWFTV2gyWTA1QlVVVkNRbEZCUkdkblJWQkJSRU5EUVZGdlEyZG5SVUpCVFVWSWJVWm1ZazU1Y0ZCMWNUazBheXRUVTBOcFZYWllVM1Z0YjJ4WmNFaFpTR2xyVUdGV01tcFJZbUpZZGtkMVNpdDNPSGw0ZWtoSFZWSkdXbEZNWmtOR1ZuSlVXakkyT1dWaWRsa3ljRTVzYUZWVGNFNUtZemRUY0dodmJGTnlPWFJEYW5WSVpFZE1NM1YyUW1Sd2VHRmFhblowWkZaRk5ubHVOVnAyUTNoNWVDOW9RV2QxUldSclpGQjFWa1Z0WkZaRWNqWTBZelk0WkRJNGIya3ZNMWx6Um01SlluRk5iblZZZGpod2NYWkdZWE5IYW1SVVYwWkRNMkYxU2tka2RUSjJOalZ6UWxVMGRsZGpja1ZHWkZscU1FMW5kMDlFTUd4dldVaGlLekI2UzBzNWQzaG1hVnBRVlZZNFNFVmFZa3QzUkZkbU5XcHZkV0ZqU21WWFdqTXlORmRHTVV4SVQycFhjbmhJWjI5RVVVSnBlbk15Y1ZWR1NuWkRUbWx1YzJGRFUwMDFTbE40VVhWc1RVZGtZa1JWVlZOMldUTnVhV3Q2Ym5KNVRuSk9ObVl2VDFKdVptc3lLMHRKZW5SamRESnJUMGxqUTBGM1JVRkJZVTlEUVdWQmQyZG5TR05OUVhOSFFURlZaRVIzVVVWQmQwbENhR3BDVlVKblRsWklVMEZGVkZSQ1RFMUZhMGRDYldWQ1JFRkZRMEZxUVM5TlJEQkhRME56UjBGUlZVWkNkMGxDUm1wR2IyUklVbmRqZW05MlRETkNjbUZUTldwYVdFb3dZVmMxYldOdFJYVmFiV3hyWWpKR2MySkhiR2hpYlU1c1RHMDVlVnA1T1hwWlYxcHNaRWhzZFZwWVVYWk5RakJIUVRGVlpFcFJVVmROUWxGSFEwTnpSMEZSVlVaQ2QwMUNRbWRuY2tKblJVWkNVV05FUVdwQlUwSm5UbFpJVWsxQ1FXWTRSVU5FUVVkQlVVZ3ZRV2RGUVUxQ01FZEJNVlZrUkdkUlYwSkNVVGxLWVhaRlRFRlZPVTFGUjBwQ1YyeFFXbW8yUjNONVdqVjNWRUZtUW1kT1ZraFRUVVZIUkVGWFowSlNZMWMxUXpSRWJqWkNOVFl6YW01Vk1tNURWSEZVV1hCMVprdEVRamxDWjA1V1NGSTRSV1JxUWpCTlNFdG5ZMHRDZFdodGVHOWtTRkozWTNwdmRrd3pRbkpoVXpWcVdsaEtNR0ZYTlcxamJVVjFXbTFzYTJJeVJuTmlSMnhvWW0xT2JFeHRPWGxhZVRsNldWZGFiR1JJYkhWYVdGRjJXVE5LYzB3d1drcFNSVGhzVFdwQ1IxbFhkR3hLVkVsM1ZXMDVkbVJEVlhsTlJVNXNZMjVTY0ZwdGJHcFpXRkpzU2xSSmQxRllWakJoUnpsNVlWaFNOVXBVU1hkTmFrRjRUME0xYW1OdGQzZG5XVkZIUTBOelIwRlJWVVpDZDBWQ1FraG5kMlJxUWpCQ1oyZHlRbWRGUmtKUlkzZEJXVnB2WVVoU01HTklUVFpNZVRsM1lUSnJkVmt5Vm5sa1IyeDFXbTVLYUV4dFduQmFSemxvWWtkNGNGbFhOV3BhVXpWMlkyMWpkbU15Um0xYVdGSTFZbTFXTUV3d1drcFNSVGhzVFdwQ1IxbFhkR3hLVkVsM1ZXMDVkbVJEVlhsTlJVNXNZMjVTY0ZwdGJHcFpXRkpzU2xSSmQxRllWakJoUnpsNVlWaFNOVXBVU1hkTmFrRjRUME0xYW1OdVVYZEVVVmxLUzI5YVNXaDJZMDVCVVVWTVFsRkJSR2RuUlVKQlEwb3JMMWxCVDBaaVpFZG9jMFZXWXpsS2VqTkVZVlpxZUZSeVVsQm9TM05NWTNsT01qTkxXWG9yVHpJNGJtRkhSR3RYTkc5cVIwRXZPSEpvY25RNU56aGtUelY0VDFaUlZEWkJhVEJQYm5oUVMzUlBZMUpwVURSMlJIZ3pSMFJrVEZSSE9XbEZNVXhQYkZWWVNHTnNabWRWWkhJNWVVNDNhSFp4VWtOMU1tOUNSbGRTVlVkWFRVNTRNR2R6WjJ4TFkyVnVTbTlEUkdSNVduaDNVWGhVTTBaM1IxQlRhbTFNTnpWRFZrbGxSVk0zVFM5U2RsWXJUVlZGUzNkNGJtMVBMMlIxY1ZCb2RYaElha0ZGY21SeE0xWnpTMGwyWXpVclFtY3JOazUyWkRKek5ERjZVMmgyUTBnMWVEa3phVTlyWmpWVFpUQTBaMlpNTlZveFMwbGtUMGRSUWtSRWVIcEdRbnBVWVVZNFRVNTJVbk5OZDNkcmN6bGtRVVpCV1Rod1JFZHNORXN5TkhOaWRtNTNkWFEzVFVWSWVsSlBha29yUjFGeWVqRmtiRFExVms1aFQyNHZhRm80UTBGek0wRTRkM2cwWW1GSlBTSmRmUS5leUp1YjI1alpTSTZJamRUVkVzMk4wUTNVa2hsV1dkelFtRnhWaXN5VnpGMlRVOVRlR2xUYVUxc1UzSlVhMmRaY20xcVNVazlJaXdpZEdsdFpYTjBZVzF3VFhNaU9qRTJOakEwT1RNeU1qRTFPRFFzSW1Gd2ExQmhZMnRoWjJWT1lXMWxJam9pWTI5dExtRnVaSEp2YVdRdWEyVjVjM1J2Y21VdVlXNWtjbTlwWkd0bGVYTjBiM0psWkdWdGJ5SXNJbUZ3YTBScFoyVnpkRk5vWVRJMU5pSTZJbVJOTDB4VlNGTkpPVk5yVVdoYVNFaHdVVmRTYm5wS00wMTJka0l5UVU1VFlYVnhXVUZCWWxNeVNtYzlJaXdpWVhCclEyVnlkR2xtYVdOaGRHVkVhV2RsYzNSVGFHRXlOVFlpT2xzaVluTmlOQzlYVVdSaFlVOVhXVU5rTDJvNVQwcHBVWEJuTjJJd2FYZEdaMEZqTDNwNlFURjBRMlozUlQwaVhTd2lZM1J6VUhKdlptbHNaVTFoZEdOb0lqcDBjblZsTENKaVlYTnBZMGx1ZEdWbmNtbDBlU0k2ZEhKMVpYMC51V1FlNWNKcmJGWVpPM3dLS3oxSDdNOWFySWcxdThMWFRLb3dyMHhDQlB4bGtnbE9jN1FOd1h1MkFncHZ1b1I2YXUxNXYxTENOamE1aHdCT2lacFhaN2FsMEtTbHQ1N3NCUS10ejJHNEF5WDVKYjNOenpPRTBUdnpvcUQwZTlEX3c1cktpMXRVZUZtU2wyZUkybjhUQnl3clc2VnBBalFIUG5nOG1WUXNSdjhJSGFQNFpXNGdaUXRMMzByenZXYXFnRy1TaHYtV0FQUTZOdV9odWdrY3JheGNlMFdiM2xfU1AzVDQ5S2h4eWxWTk9IS3BlQ2R1RjRMSjUzZEZOT2RXOU9kdDFEeXRBSjRlajlmSFpyUU5IV1R1STM1dnR1RE9qdEs4dENVVjJGQmNSTmxsalhsUzhXQ18wMVAxQklyZ1V5SUZHTHlFSXRjTjZHS3JwaV9KQVFoYXV0aERhdGFZAWeIR20dSr50NYH9fr2gLeUAShXskXlzq1Q6gy8s2HtuGUEAAACEyHzdl1bBSbieJMs2NlTzUAAgHm-JQIQHRzcBY28-A7hSFo6l_9XbS7D_fcRBO64HxIykAQMDOQEAIFkBAJc7YKTaJ1DtD8IS98cLuddRZz5oshzqE0se5AEp_8bMJorKRRxJ95-VdHJLToRqj7e2iV-E1kboMK3H8MOlje_VjjnHx-NmIOey_hb2KV-foYb-TRjEVjsV32JMhn0jyDfP93BuQRtjrzCSbtR2yLJ66lPV2JyXUAboCmcgeXo2LS_Rp3Pcs2QvYVU1Fr-B32jLHQ0q3Nwy25FfShGnutshsprQMJml7hRbUPPCIeUw0elvYwTIJIVy3UVo1rlGSPjKQbLg7J5RnU08xGEJwpKF1J5-3h56dZjkkyU_JQ_JGecLaVrdYynLXLgq6H4mj6tRGvBMke8yJVEzAmcihrkhQwEAAQ';
      const clientDataJSON =
        'eyJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY2hhbGxlbmdlIjoiU1JRUE9ZMzkxTGZNQWtVc1NvakZqOVNza0pvaUk3ZFRNWEJYZ2ltdzRPLVJtRmZfMDZ3eFQwYl9BTkpRNTFnR0ZuUUViQkhDYkw3QU1MVTRLQmZ4VkEiLCJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIn0';
      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const as = new AndroidSafenetFormat();
      as.config(attStmt, result as any, {} as any, {});

      try {
        const verified = await as.verify();
        t.fail('not come here');
      } catch (err) {
        t.match(err.message, /android-safetynet:timestampMs\([0-9]+\) is invalid to now\([0-9]+\)\.*/);
      } finally {
        clock.restore();
      }

      t.end();
    });

    t.test('### timestampMs is before more than 1 minute', async (t) => {
      const clock = sinon.useFakeTimers({
        now: dayjs('2022-08-07T01:28:30.154Z').valueOf(),
      });

      const attestationObject =
        'o2NmbXRxYW5kcm9pZC1zYWZldHluZXRnYXR0U3RtdKJjdmVyaDEyNjg1MDIzaHJlc3BvbnNlWRX1ZXlKaGJHY2lPaUpTVXpJMU5pSXNJbmcxWXlJNld5Sk5TVWxHVm1wRFEwSkVObWRCZDBsQ1FXZEpVRUpLYTI5eVRXVjJjRzh3Y1cxQlN6RlFkbXhpVFVFd1IwTlRjVWRUU1dJelJGRkZRa04zVlVGTlJ6UjRRM3BCU2tKblRsWkNRVmxVUVd4V1ZFMVRjM2RMVVZsRVZsRlJTMFJEU2tkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUmxKNVpGaE9NRWxHVG14amJscHdXVEpXZWsxVVNYZE5RVmxFVmxGUlJFUkRiRWRUVlZKUVNVVkdjMkpIYkdoaWJVNXNZM2xDUjFGVmRFWkpSV3gxWkVkV2VXSnRWakJKUlVZeFpFZG9kbU50YkRCbFUwSkhUVlJCWlVaM01IbE5WRUUwVFZSUmVFNVVRVE5OUkVaaFJuY3dlVTE2UVRSTlZGRjRUbFJCTTAxRVJtRk5TRVY0UTNwQlNrSm5UbFpDUVZsVVFXeFdWRTFSYzNkRFVWbEVWbEZSU1VSQlNrNVhWRVZUVFVKQlIwRXhWVVZDZDNkS1ZqSkdjbHBYV25CYVYzaHJUVkpaZDBaQldVUldVVkZMUkVFeFIxTlZVbEJKUlVaellrZHNhR0p0VG14TlVYZDNRMmRaUkZaUlVVeEVRVTVFVmpCamVFZDZRVnBDWjA1V1FrRk5UVVZ0UmpCa1IxWjZaRU0xYUdKdFVubGlNbXhyVEcxT2RtSlVRME5CVTBsM1JGRlpTa3R2V2tsb2RtTk9RVkZGUWtKUlFVUm5aMFZRUVVSRFEwRlJiME5uWjBWQ1FVMXhWMjVRUm1wUFZrUjBOVUZrUzA4elNHRlFVMWR0ZWpWblQyRnlaMFJNVUUwMGEwRkliMlprTTJrMFEySkRLelZUVEV4cU5GTlJkR1JLYVZaT01FcE9XaTkxVTJWNlVtcEhjakV3TWpSU01tRm9lV0ZXTkRBNE5IVkhSbWMyT0ZrNVlrTk5aa2tyYVd0YVZEaDZhVEVyY25CblZUSjBXbkExWlZOQ1NVZHZVeTlsTHpobFVYRmthRFZEUWtoNFlUZG5TMVpZUVhsbVUwUlpiVk5UUld4NFZWRXlkbUZGTW00eldtMTFWa1pPWldVMFlWZHpRbTlSYTJoUFpuTTNNMXB0YkVOYU1rNXBiMFpGU1ZGSU1tNW5SMUV2V2tVdlZUSnBiMkpaZUVkeWMyTlJkakJ5ZDI1alZFTndNSEJTZFVsRGFYcE9PVUV5TVZkdlprSjNRVEYyU0c5WU1XZEJaVzlQVjI4d2NUVmxabWh2WXk5T05HaHlPVXhzY1RBdmNqa3hOMGM0UkRaUU1HOWFTVkp4UTNGeFlWTnRXWG94ZG1WR1pWUjBTRGRWWkc5NGVIUk9NR1JtVkZkVWNqSlFWVkpqVW1GSWEwTkJkMFZCUVdGUFEwRmxkM2RuWjBodlRVTkZSMEV4VldSSlFWRmhUVUpuZDBSQldVdExkMWxDUWtGSVYyVlJTVVpCZWtGSlFtZGFibWRSZDBKQlowbDNSWGRaUkZaU01HeENRWGQzUTJkWlNVdDNXVUpDVVZWSVFYZEZkMFJCV1VSV1VqQlVRVkZJTDBKQlNYZEJSRUZrUW1kT1ZraFJORVZHWjFGVmRqQnNjVXM0VmpBNU5FWkVNbkZ3UkN0Q1JuVTJWVmhyVEVNMGQwaDNXVVJXVWpCcVFrSm5kMFp2UVZWUVUxZHllRU4zUmxCVVFrSnBVVlp3VkRKWksyaHlUVzFsWTBWM1dFRlpSRlpTTUdaQ1JsVjNWWHBDVW05RksyZFVXVnBNWVVoU01HTklUVFpNZVRsM1lUSnJkVmt5Vm5sa1IyeDFXbTVLYUV4dFduQmFSemxvWWtkNGNGbFhOV3BhVXpWMlkyMWpkbU15Um0xYVdGSTFZbTFXTUV3eVRubGlRemxvWkVoU2JHTXpVWFZaVnpWclkyMDVjRnBETldwaU1qQjFXVE5LYzAxSlNVSkJRVmxKUzNkWlFrSlJWVWhCVVVWRloyWk5kMmRtUVhka1FWbEpTM2RaUWtKUlZVaE5RVXRIWVVkb01HUklRbnBQYVRoMlkwZDBjRXh0VG14amJsSndZbTFhZVZsVE5XMWhWMUoyV1ZkNGMyRlhSblZaTWxWMVlqTktia3d6VG1oYWJWWXdaVmMxYkdSRE9VZFRWVkpRU2xSSmQxSnRSbkphVTFWNVRVWktkbUl6VVd4TmFrSkVXbGhLTUdGWFduQlpNa1l3V2xOVmVVMUZSakZrUjJoMlkyMXNNR1ZUVlhsTlJFbDNUVlJuZFZrelNqQk5TR2RIUTBOelIwRlJWVVpDZWtGQ2FHMTRiMlJJVW5kamVtOTJURE5DY21GVE5XcGFXRW93WVZjMWJXTnRSWFZhYld4cllqSkdjMkpIYkdoaWJVNXNURzA1ZVZwNU9YcFpWMXBzWkVoc2RWcFlVWFpaTTBwelREQmFTbEpGT0d4TmFrSkhXVmQwYkVwVVNYZFZiVGwyWkVOVmVVMUZUbXhqYmxKd1dtMXNhbGxZVW14S1ZFbDNVVmhXTUdGSE9YbGhXRkkxU2xSSmQwMXFRWGhQUXpWcVkyMTNkMFJSV1VwTGIxcEphSFpqVGtGUlJVeENVVUZFWjJkRlFrRktWMnhwZVhCNVVFTkdXVE5WVmtOQmQydFhXbkpJTVRNMFVFRnlVSGg2VEdWWmJHdGhRMU5SVlVSWU16YzNiSEpzY21kcFUyZHpkMEl4WjNKT1ZFbEhlWGhZWkhWaFVYbHFSMlV5UlN0MUt6VnBVbU12V0hST1dFRjVja052U2poamVURnVXSE12T1RWMk5sZGlXbGRCTXpSTU5uTjRRM2xpZEVKamFWbEliblZKYUd0SlZURnhiVGg2WVhaeFRFVk1MMFpYTlVFeGVYWndjbVpCVW1sc1JDdDRaVWhNYURKMVdFWmpWR3gwVG5wcFRFb3liemhQZEVGSmFGZFphMFpSUkdReWVFdFJValpaYVV0VlVGRXhVVmczZW1JMlpXNXdiRlV5V1V0d1ZsWkxjRTByVUdwMGIybHVXamc1ZGt4dGVERjJTblJ2VWs0M04zQnBPRU5HUkVNeWFuVjFhMlYwZERkRVFWUTRNRWxxVWpWRFZHRmxTREpNYzFWM2FYZDBkRTgxTDNsdU1HbHNUWGxxY214NVNUVjNWRGRsY3paS1pXZ3pUVFpvWjB0NU4wOWxVVlp6VkU5WmIzUnhjV3RFTVVrd2EzYzlJaXdpVFVsSlJrdFVRME5DUWtkblFYZEpRa0ZuU1ZCQ1EySTFhVXRxV0RCV1NXMXFZM1Z6TkhkNU5VMUJNRWREVTNGSFUwbGlNMFJSUlVKRGQxVkJUVVpCZUVONlFVcENaMDVXUWtGWlZFRnNWbFJOVWxsM1JrRlpSRlpSVVV0RVFURkhVMVZTVUVsRlJuTmlSMnhvWW0xT2JFMVRhM2RLZDFsRVZsRlJSRVJEUWtkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUmtwMllqTlJaMUV3UldkTVUwSlVUVlJCWlVaM01IaE9la0Y1VFVSRmQwMUVRWGROUkVKaFJuY3dlazVVUVhoTmVrVjVUWHBWTlU1VWJHRk5SelI0UTNwQlNrSm5UbFpDUVZsVVFXeFdWRTFUYzNkTFVWbEVWbEZSUzBSRFNrZFRWVkpRU1VWR2MySkhiR2hpYlU1c1kzbENSMUZWZEVaSlJsSjVaRmhPTUVsR1RteGpibHB3V1RKV2VrMVVTWGROUVZsRVZsRlJSRVJEYkVkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUld4MVpFZFdlV0p0VmpCSlJVWXhaRWRvZG1OdGJEQmxVMEpIVFZSRFEwRlRTWGRFVVZsS1MyOWFTV2gyWTA1QlVVVkNRbEZCUkdkblJWQkJSRU5EUVZGdlEyZG5SVUpCVFVWSWJVWm1ZazU1Y0ZCMWNUazBheXRUVTBOcFZYWllVM1Z0YjJ4WmNFaFpTR2xyVUdGV01tcFJZbUpZZGtkMVNpdDNPSGw0ZWtoSFZWSkdXbEZNWmtOR1ZuSlVXakkyT1dWaWRsa3ljRTVzYUZWVGNFNUtZemRUY0dodmJGTnlPWFJEYW5WSVpFZE1NM1YyUW1Sd2VHRmFhblowWkZaRk5ubHVOVnAyUTNoNWVDOW9RV2QxUldSclpGQjFWa1Z0WkZaRWNqWTBZelk0WkRJNGIya3ZNMWx6Um01SlluRk5iblZZZGpod2NYWkdZWE5IYW1SVVYwWkRNMkYxU2tka2RUSjJOalZ6UWxVMGRsZGpja1ZHWkZscU1FMW5kMDlFTUd4dldVaGlLekI2UzBzNWQzaG1hVnBRVlZZNFNFVmFZa3QzUkZkbU5XcHZkV0ZqU21WWFdqTXlORmRHTVV4SVQycFhjbmhJWjI5RVVVSnBlbk15Y1ZWR1NuWkRUbWx1YzJGRFUwMDFTbE40VVhWc1RVZGtZa1JWVlZOMldUTnVhV3Q2Ym5KNVRuSk9ObVl2VDFKdVptc3lLMHRKZW5SamRESnJUMGxqUTBGM1JVRkJZVTlEUVdWQmQyZG5TR05OUVhOSFFURlZaRVIzVVVWQmQwbENhR3BDVlVKblRsWklVMEZGVkZSQ1RFMUZhMGRDYldWQ1JFRkZRMEZxUVM5TlJEQkhRME56UjBGUlZVWkNkMGxDUm1wR2IyUklVbmRqZW05MlRETkNjbUZUTldwYVdFb3dZVmMxYldOdFJYVmFiV3hyWWpKR2MySkhiR2hpYlU1c1RHMDVlVnA1T1hwWlYxcHNaRWhzZFZwWVVYWk5RakJIUVRGVlpFcFJVVmROUWxGSFEwTnpSMEZSVlVaQ2QwMUNRbWRuY2tKblJVWkNVV05FUVdwQlUwSm5UbFpJVWsxQ1FXWTRSVU5FUVVkQlVVZ3ZRV2RGUVUxQ01FZEJNVlZrUkdkUlYwSkNVVGxLWVhaRlRFRlZPVTFGUjBwQ1YyeFFXbW8yUjNONVdqVjNWRUZtUW1kT1ZraFRUVVZIUkVGWFowSlNZMWMxUXpSRWJqWkNOVFl6YW01Vk1tNURWSEZVV1hCMVprdEVRamxDWjA1V1NGSTRSV1JxUWpCTlNFdG5ZMHRDZFdodGVHOWtTRkozWTNwdmRrd3pRbkpoVXpWcVdsaEtNR0ZYTlcxamJVVjFXbTFzYTJJeVJuTmlSMnhvWW0xT2JFeHRPWGxhZVRsNldWZGFiR1JJYkhWYVdGRjJXVE5LYzB3d1drcFNSVGhzVFdwQ1IxbFhkR3hLVkVsM1ZXMDVkbVJEVlhsTlJVNXNZMjVTY0ZwdGJHcFpXRkpzU2xSSmQxRllWakJoUnpsNVlWaFNOVXBVU1hkTmFrRjRUME0xYW1OdGQzZG5XVkZIUTBOelIwRlJWVVpDZDBWQ1FraG5kMlJxUWpCQ1oyZHlRbWRGUmtKUlkzZEJXVnB2WVVoU01HTklUVFpNZVRsM1lUSnJkVmt5Vm5sa1IyeDFXbTVLYUV4dFduQmFSemxvWWtkNGNGbFhOV3BhVXpWMlkyMWpkbU15Um0xYVdGSTFZbTFXTUV3d1drcFNSVGhzVFdwQ1IxbFhkR3hLVkVsM1ZXMDVkbVJEVlhsTlJVNXNZMjVTY0ZwdGJHcFpXRkpzU2xSSmQxRllWakJoUnpsNVlWaFNOVXBVU1hkTmFrRjRUME0xYW1OdVVYZEVVVmxLUzI5YVNXaDJZMDVCVVVWTVFsRkJSR2RuUlVKQlEwb3JMMWxCVDBaaVpFZG9jMFZXWXpsS2VqTkVZVlpxZUZSeVVsQm9TM05NWTNsT01qTkxXWG9yVHpJNGJtRkhSR3RYTkc5cVIwRXZPSEpvY25RNU56aGtUelY0VDFaUlZEWkJhVEJQYm5oUVMzUlBZMUpwVURSMlJIZ3pSMFJrVEZSSE9XbEZNVXhQYkZWWVNHTnNabWRWWkhJNWVVNDNhSFp4VWtOMU1tOUNSbGRTVlVkWFRVNTRNR2R6WjJ4TFkyVnVTbTlEUkdSNVduaDNVWGhVTTBaM1IxQlRhbTFNTnpWRFZrbGxSVk0zVFM5U2RsWXJUVlZGUzNkNGJtMVBMMlIxY1ZCb2RYaElha0ZGY21SeE0xWnpTMGwyWXpVclFtY3JOazUyWkRKek5ERjZVMmgyUTBnMWVEa3phVTlyWmpWVFpUQTBaMlpNTlZveFMwbGtUMGRSUWtSRWVIcEdRbnBVWVVZNFRVNTJVbk5OZDNkcmN6bGtRVVpCV1Rod1JFZHNORXN5TkhOaWRtNTNkWFEzVFVWSWVsSlBha29yUjFGeWVqRmtiRFExVms1aFQyNHZhRm80UTBGek0wRTRkM2cwWW1GSlBTSmRmUS5leUp1YjI1alpTSTZJamRUVkVzMk4wUTNVa2hsV1dkelFtRnhWaXN5VnpGMlRVOVRlR2xUYVUxc1UzSlVhMmRaY20xcVNVazlJaXdpZEdsdFpYTjBZVzF3VFhNaU9qRTJOakEwT1RNeU1qRTFPRFFzSW1Gd2ExQmhZMnRoWjJWT1lXMWxJam9pWTI5dExtRnVaSEp2YVdRdWEyVjVjM1J2Y21VdVlXNWtjbTlwWkd0bGVYTjBiM0psWkdWdGJ5SXNJbUZ3YTBScFoyVnpkRk5vWVRJMU5pSTZJbVJOTDB4VlNGTkpPVk5yVVdoYVNFaHdVVmRTYm5wS00wMTJka0l5UVU1VFlYVnhXVUZCWWxNeVNtYzlJaXdpWVhCclEyVnlkR2xtYVdOaGRHVkVhV2RsYzNSVGFHRXlOVFlpT2xzaVluTmlOQzlYVVdSaFlVOVhXVU5rTDJvNVQwcHBVWEJuTjJJd2FYZEdaMEZqTDNwNlFURjBRMlozUlQwaVhTd2lZM1J6VUhKdlptbHNaVTFoZEdOb0lqcDBjblZsTENKaVlYTnBZMGx1ZEdWbmNtbDBlU0k2ZEhKMVpYMC51V1FlNWNKcmJGWVpPM3dLS3oxSDdNOWFySWcxdThMWFRLb3dyMHhDQlB4bGtnbE9jN1FOd1h1MkFncHZ1b1I2YXUxNXYxTENOamE1aHdCT2lacFhaN2FsMEtTbHQ1N3NCUS10ejJHNEF5WDVKYjNOenpPRTBUdnpvcUQwZTlEX3c1cktpMXRVZUZtU2wyZUkybjhUQnl3clc2VnBBalFIUG5nOG1WUXNSdjhJSGFQNFpXNGdaUXRMMzByenZXYXFnRy1TaHYtV0FQUTZOdV9odWdrY3JheGNlMFdiM2xfU1AzVDQ5S2h4eWxWTk9IS3BlQ2R1RjRMSjUzZEZOT2RXOU9kdDFEeXRBSjRlajlmSFpyUU5IV1R1STM1dnR1RE9qdEs4dENVVjJGQmNSTmxsalhsUzhXQ18wMVAxQklyZ1V5SUZHTHlFSXRjTjZHS3JwaV9KQVFoYXV0aERhdGFZAWeIR20dSr50NYH9fr2gLeUAShXskXlzq1Q6gy8s2HtuGUEAAACEyHzdl1bBSbieJMs2NlTzUAAgHm-JQIQHRzcBY28-A7hSFo6l_9XbS7D_fcRBO64HxIykAQMDOQEAIFkBAJc7YKTaJ1DtD8IS98cLuddRZz5oshzqE0se5AEp_8bMJorKRRxJ95-VdHJLToRqj7e2iV-E1kboMK3H8MOlje_VjjnHx-NmIOey_hb2KV-foYb-TRjEVjsV32JMhn0jyDfP93BuQRtjrzCSbtR2yLJ66lPV2JyXUAboCmcgeXo2LS_Rp3Pcs2QvYVU1Fr-B32jLHQ0q3Nwy25FfShGnutshsprQMJml7hRbUPPCIeUw0elvYwTIJIVy3UVo1rlGSPjKQbLg7J5RnU08xGEJwpKF1J5-3h56dZjkkyU_JQ_JGecLaVrdYynLXLgq6H4mj6tRGvBMke8yJVEzAmcihrkhQwEAAQ';
      const clientDataJSON =
        'eyJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY2hhbGxlbmdlIjoiU1JRUE9ZMzkxTGZNQWtVc1NvakZqOVNza0pvaUk3ZFRNWEJYZ2ltdzRPLVJtRmZfMDZ3eFQwYl9BTkpRNTFnR0ZuUUViQkhDYkw3QU1MVTRLQmZ4VkEiLCJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIn0';
      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const as = new AndroidSafenetFormat();
      as.config(attStmt, result as any, {} as any, {});

      try {
        const verified = await as.verify();
        t.fail('not come here');
      } catch (err) {
        t.match(err.message, /android-safetynet:timestampMs\([0-9]+\) is invalid to now\([0-9]+\)\.*/);
      } finally {
        clock.restore();
      }

      t.end();
    });

    t.test('### ctsProfileMatch is false', async (t) => {
      const clock = sinon.useFakeTimers({
        now: dayjs('2022-08-14T15:07:01.278Z').valueOf(),
      });

      const attestationObject =
        'o2NmbXRxYW5kcm9pZC1zYWZldHluZXRnYXR0U3RtdKJjdmVyaDEyNjg1MDIzaHJlc3BvbnNlWRX2ZXlKaGJHY2lPaUpTVXpJMU5pSXNJbmcxWXlJNld5Sk5TVWxHVm1wRFEwSkVObWRCZDBsQ1FXZEpVRUpDWjNodlNGbG5WbkZTUm01V1dXSnpWVmxGVFVFd1IwTlRjVWRUU1dJelJGRkZRa04zVlVGTlJ6UjRRM3BCU2tKblRsWkNRVmxVUVd4V1ZFMVRjM2RMVVZsRVZsRlJTMFJEU2tkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUmxKNVpGaE9NRWxHVG14amJscHdXVEpXZWsxVVNYZE5RVmxFVmxGUlJFUkRiRWRUVlZKUVNVVkdjMkpIYkdoaWJVNXNZM2xDUjFGVmRFWkpSV3gxWkVkV2VXSnRWakJKUlVZeFpFZG9kbU50YkRCbFUwSkhUVlJCWlVaM01IbE5WRUUwVFZSUmVFNVVRVE5OUkVaaFJuY3dlVTE2UVRSTlZGRjRUbFJCTTAxRVJtRk5TRVY0UTNwQlNrSm5UbFpDUVZsVVFXeFdWRTFSYzNkRFVWbEVWbEZSU1VSQlNrNVhWRVZUVFVKQlIwRXhWVVZDZDNkS1ZqSkdjbHBYV25CYVYzaHJUVkpaZDBaQldVUldVVkZMUkVFeFIxTlZVbEJKUlVaellrZHNhR0p0VG14TlVYZDNRMmRaUkZaUlVVeEVRVTVFVmpCamVFZDZRVnBDWjA1V1FrRk5UVVZ0UmpCa1IxWjZaRU0xYUdKdFVubGlNbXhyVEcxT2RtSlVRME5CVTBsM1JGRlpTa3R2V2tsb2RtTk9RVkZGUWtKUlFVUm5aMFZRUVVSRFEwRlJiME5uWjBWQ1FVdzFXRUlyVFUxNVNtOWFjRTkyVUhGQ04xZHNRbEp1ZFc5V2EzRkJkRzlyU0VZclRVVkJjRFpyY2xwMEx6VnFXREF3YzFkc1JWa3hZelkzVlRONFJ6ZERXVkp2YlUxRWF5OWtOek5sVVdWT1lWTm9WbGxpV0hwUFEwVkplSEV2ZUZjM2VtOW9hRlZFWVVkNFkxSnJNRUl4TmpCeFEzZ3dSSFUzVGxSWlp5dFVUemR2UTFwRk5rcEVjalpMVGt0cUswSktibWxFZEZkeFVqZGhUVWd3UWpkT1NHbHlOMDlzYVdSVE1YTk9jbFZ5WlN0T1pWUllaVGh2T1d4WVIxaGhiWHBpWW1oaE9UbExiRFJ5VVVveFFsRmxNbll2SzB3MFJtYzNRMEZ0VXpOQlR6VlllSFU0ZDNsbVVYWkZaMEo1YzNwTlZVMUdVVVpIU1hoVEwydE9OR2hVVW5WNWIwbEpaMmgwTVVkemRqTTFjbEZIY25CaFNtTlNZVzUzZDBGemVtNWhORUkwWVhNNGIzaFlkSE0wU25GVlV6bFpXVVl6ZFZkR05FWnRlSFJoTVVsNmMwbHVRelY0Um00eVpraFZUMjR6WlRRdlkwTkJkMFZCUVdGUFEwRmxkM2RuWjBodlRVTkZSMEV4VldSSlFWRmhUVUpuZDBSQldVdExkMWxDUWtGSVYyVlJTVVpCZWtGSlFtZGFibWRSZDBKQlowbDNSWGRaUkZaU01HeENRWGQzUTJkWlNVdDNXVUpDVVZWSVFYZEZkMFJCV1VSV1VqQlVRVkZJTDBKQlNYZEJSRUZrUW1kT1ZraFJORVZHWjFGVlJXcE9UV1ZRZDNSblEyWkdTakl2WnpKTFVqTXZNbFpIZEhCVmQwaDNXVVJXVWpCcVFrSm5kMFp2UVZWUVUxZHllRU4zUmxCVVFrSnBVVlp3VkRKWksyaHlUVzFsWTBWM1dFRlpSRlpTTUdaQ1JsVjNWWHBDVW05RksyZFVXVnBNWVVoU01HTklUVFpNZVRsM1lUSnJkVmt5Vm5sa1IyeDFXbTVLYUV4dFduQmFSemxvWWtkNGNGbFhOV3BhVXpWMlkyMWpkbU15Um0xYVdGSTFZbTFXTUV3eVRubGlRemxvWkVoU2JHTXpVWFZaVnpWclkyMDVjRnBETldwaU1qQjFXVE5LYzAxSlNVSkJRVmxKUzNkWlFrSlJWVWhCVVVWRloyWk5kMmRtUVhka1FWbEpTM2RaUWtKUlZVaE5RVXRIWVVkb01HUklRbnBQYVRoMlkwZDBjRXh0VG14amJsSndZbTFhZVZsVE5XMWhWMUoyV1ZkNGMyRlhSblZaTWxWMVlqTktia3d6VG1oYWJWWXdaVmMxYkdSRE9VZFRWVkpRU2xSSmQxSnRSbkphVTFWNVRVWktkbUl6VVd4TmFrSkVXbGhLTUdGWFduQlpNa1l3V2xOVmVVMUZSakZrUjJoMlkyMXNNR1ZUVlhsTlJFbDNUVlJuZFZrelNqQk5TR2RIUTBOelIwRlJWVVpDZWtGQ2FHMTRiMlJJVW5kamVtOTJURE5DY21GVE5XcGFXRW93WVZjMWJXTnRSWFZhYld4cllqSkdjMkpIYkdoaWJVNXNURzA1ZVZwNU9YcFpWMXBzWkVoc2RWcFlVWFpaTTBwelREQmFTbEpGT0d4TmFrSkhXVmQwYkVwVVNYZFZiVGwyWkVOVmVVMUZUbXhqYmxKd1dtMXNhbGxZVW14S1ZFbDNVVmhXTUdGSE9YbGhXRkkxU2xSSmQwMXFRWGhQUXpWcVkyMTNkMFJSV1VwTGIxcEphSFpqVGtGUlJVeENVVUZFWjJkRlFrRkhVVTR3UVdwRGFXZ3libVYwY0ZrM1oyVlJUVWxVVW1GT1pVZ3ZOMlpPVlVOdmR5OXNOR2RPVGxGaGFXVXdPQzlCWWtKTVUzbDFaVlJYVWpaU2RrRmhOVXhvZUV3NU9VWlBUbXBWTWxOcGFFWkVjVTFvZVU5MEwyNXpha0o1WW01NU1ucHBSMlpwZWtrd1lqTjRVQ3N6ZUVvNVJGbHhaSEZtYVRaMlFrSkpWMFJzZGtGMU1qRjJUU3QzVHpKNlJHVnhVa2xIUzFFcldHZG1NRVUwWm5OU2JXTXZTR1Z3YkZJMmJUZFNUR1ZpYURVMGNXRnZSM2hGZVZCQmVVMUpiRmxoWlV4Mk9IRmtkWFpUUTFkeFVubEdNR2wzVDBVdldrTkVaVmxQZEZOTE5IVndUR1JFSzNSYWFXTnJRVTVyUmtKaGRXSjFTRU0wU1hSNWRGRlZVMHR1VkhGUlQwUlRlblZKZFdKbGFVWTRiMVJEVGpodlpTOVRTRnBVWVc1TmRIQllORFpMVmtoM1ZFTTFlbkZ5TVVabmJYWm9hR0pyTkRKTVVrUktkelF5YjBSYWNFNTRiRGczUTBwcGVGaExkemhrWkdab1JWazlJaXdpVFVsSlJrdFVRME5DUWtkblFYZEpRa0ZuU1ZCQ1EySTFhVXRxV0RCV1NXMXFZM1Z6TkhkNU5VMUJNRWREVTNGSFUwbGlNMFJSUlVKRGQxVkJUVVpCZUVONlFVcENaMDVXUWtGWlZFRnNWbFJOVWxsM1JrRlpSRlpSVVV0RVFURkhVMVZTVUVsRlJuTmlSMnhvWW0xT2JFMVRhM2RLZDFsRVZsRlJSRVJEUWtkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUmtwMllqTlJaMUV3UldkTVUwSlVUVlJCWlVaM01IaE9la0Y1VFVSRmQwMUVRWGROUkVKaFJuY3dlazVVUVhoTmVrVjVUWHBWTlU1VWJHRk5SelI0UTNwQlNrSm5UbFpDUVZsVVFXeFdWRTFUYzNkTFVWbEVWbEZSUzBSRFNrZFRWVkpRU1VWR2MySkhiR2hpYlU1c1kzbENSMUZWZEVaSlJsSjVaRmhPTUVsR1RteGpibHB3V1RKV2VrMVVTWGROUVZsRVZsRlJSRVJEYkVkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUld4MVpFZFdlV0p0VmpCSlJVWXhaRWRvZG1OdGJEQmxVMEpIVFZSRFEwRlRTWGRFVVZsS1MyOWFTV2gyWTA1QlVVVkNRbEZCUkdkblJWQkJSRU5EUVZGdlEyZG5SVUpCVFVWSWJVWm1ZazU1Y0ZCMWNUazBheXRUVTBOcFZYWllVM1Z0YjJ4WmNFaFpTR2xyVUdGV01tcFJZbUpZZGtkMVNpdDNPSGw0ZWtoSFZWSkdXbEZNWmtOR1ZuSlVXakkyT1dWaWRsa3ljRTVzYUZWVGNFNUtZemRUY0dodmJGTnlPWFJEYW5WSVpFZE1NM1YyUW1Sd2VHRmFhblowWkZaRk5ubHVOVnAyUTNoNWVDOW9RV2QxUldSclpGQjFWa1Z0WkZaRWNqWTBZelk0WkRJNGIya3ZNMWx6Um01SlluRk5iblZZZGpod2NYWkdZWE5IYW1SVVYwWkRNMkYxU2tka2RUSjJOalZ6UWxVMGRsZGpja1ZHWkZscU1FMW5kMDlFTUd4dldVaGlLekI2UzBzNWQzaG1hVnBRVlZZNFNFVmFZa3QzUkZkbU5XcHZkV0ZqU21WWFdqTXlORmRHTVV4SVQycFhjbmhJWjI5RVVVSnBlbk15Y1ZWR1NuWkRUbWx1YzJGRFUwMDFTbE40VVhWc1RVZGtZa1JWVlZOMldUTnVhV3Q2Ym5KNVRuSk9ObVl2VDFKdVptc3lLMHRKZW5SamRESnJUMGxqUTBGM1JVRkJZVTlEUVdWQmQyZG5TR05OUVhOSFFURlZaRVIzVVVWQmQwbENhR3BDVlVKblRsWklVMEZGVkZSQ1RFMUZhMGRDYldWQ1JFRkZRMEZxUVM5TlJEQkhRME56UjBGUlZVWkNkMGxDUm1wR2IyUklVbmRqZW05MlRETkNjbUZUTldwYVdFb3dZVmMxYldOdFJYVmFiV3hyWWpKR2MySkhiR2hpYlU1c1RHMDVlVnA1T1hwWlYxcHNaRWhzZFZwWVVYWk5RakJIUVRGVlpFcFJVVmROUWxGSFEwTnpSMEZSVlVaQ2QwMUNRbWRuY2tKblJVWkNVV05FUVdwQlUwSm5UbFpJVWsxQ1FXWTRSVU5FUVVkQlVVZ3ZRV2RGUVUxQ01FZEJNVlZrUkdkUlYwSkNVVGxLWVhaRlRFRlZPVTFGUjBwQ1YyeFFXbW8yUjNONVdqVjNWRUZtUW1kT1ZraFRUVVZIUkVGWFowSlNZMWMxUXpSRWJqWkNOVFl6YW01Vk1tNURWSEZVV1hCMVprdEVRamxDWjA1V1NGSTRSV1JxUWpCTlNFdG5ZMHRDZFdodGVHOWtTRkozWTNwdmRrd3pRbkpoVXpWcVdsaEtNR0ZYTlcxamJVVjFXbTFzYTJJeVJuTmlSMnhvWW0xT2JFeHRPWGxhZVRsNldWZGFiR1JJYkhWYVdGRjJXVE5LYzB3d1drcFNSVGhzVFdwQ1IxbFhkR3hLVkVsM1ZXMDVkbVJEVlhsTlJVNXNZMjVTY0ZwdGJHcFpXRkpzU2xSSmQxRllWakJoUnpsNVlWaFNOVXBVU1hkTmFrRjRUME0xYW1OdGQzZG5XVkZIUTBOelIwRlJWVVpDZDBWQ1FraG5kMlJxUWpCQ1oyZHlRbWRGUmtKUlkzZEJXVnB2WVVoU01HTklUVFpNZVRsM1lUSnJkVmt5Vm5sa1IyeDFXbTVLYUV4dFduQmFSemxvWWtkNGNGbFhOV3BhVXpWMlkyMWpkbU15Um0xYVdGSTFZbTFXTUV3d1drcFNSVGhzVFdwQ1IxbFhkR3hLVkVsM1ZXMDVkbVJEVlhsTlJVNXNZMjVTY0ZwdGJHcFpXRkpzU2xSSmQxRllWakJoUnpsNVlWaFNOVXBVU1hkTmFrRjRUME0xYW1OdVVYZEVVVmxLUzI5YVNXaDJZMDVCVVVWTVFsRkJSR2RuUlVKQlEwb3JMMWxCVDBaaVpFZG9jMFZXWXpsS2VqTkVZVlpxZUZSeVVsQm9TM05NWTNsT01qTkxXWG9yVHpJNGJtRkhSR3RYTkc5cVIwRXZPSEpvY25RNU56aGtUelY0VDFaUlZEWkJhVEJQYm5oUVMzUlBZMUpwVURSMlJIZ3pSMFJrVEZSSE9XbEZNVXhQYkZWWVNHTnNabWRWWkhJNWVVNDNhSFp4VWtOMU1tOUNSbGRTVlVkWFRVNTRNR2R6WjJ4TFkyVnVTbTlEUkdSNVduaDNVWGhVTTBaM1IxQlRhbTFNTnpWRFZrbGxSVk0zVFM5U2RsWXJUVlZGUzNkNGJtMVBMMlIxY1ZCb2RYaElha0ZGY21SeE0xWnpTMGwyWXpVclFtY3JOazUyWkRKek5ERjZVMmgyUTBnMWVEa3phVTlyWmpWVFpUQTBaMlpNTlZveFMwbGtUMGRSUWtSRWVIcEdRbnBVWVVZNFRVNTJVbk5OZDNkcmN6bGtRVVpCV1Rod1JFZHNORXN5TkhOaWRtNTNkWFEzVFVWSWVsSlBha29yUjFGeWVqRmtiRFExVms1aFQyNHZhRm80UTBGek0wRTRkM2cwWW1GSlBTSmRmUS5leUp1YjI1alpTSTZJak5ZU21kcVZtSkNhMEpITlc1SllXd3lNVWRtZDIxS1NsbGFhVEkyWkRKc2JYTkRLME5uWjA1dFIyYzlJaXdpZEdsdFpYTjBZVzF3VFhNaU9qRTJOakEwT0RrMk1qRXlOemdzSW1Gd2ExQmhZMnRoWjJWT1lXMWxJam9pWTI5dExtRnVaSEp2YVdRdWEyVjVjM1J2Y21VdVlXNWtjbTlwWkd0bGVYTjBiM0psWkdWdGJ5SXNJbUZ3YTBScFoyVnpkRk5vWVRJMU5pSTZJbVJOTDB4VlNGTkpPVk5yVVdoYVNFaHdVVmRTYm5wS00wMTJka0l5UVU1VFlYVnhXVUZCWWxNeVNtYzlJaXdpWVhCclEyVnlkR2xtYVdOaGRHVkVhV2RsYzNSVGFHRXlOVFlpT2xzaVluTmlOQzlYVVdSaFlVOVhXVU5rTDJvNVQwcHBVWEJuTjJJd2FYZEdaMEZqTDNwNlFURjBRMlozUlQwaVhTd2lZM1J6VUhKdlptbHNaVTFoZEdOb0lqcG1ZV3h6WlN3aVltRnphV05KYm5SbFozSnBkSGtpT25SeWRXVjkuT3p2b2RJak5aZUpwTTNnWVYwYWJBTEFaTjFlSGpqbWhacENIZU9WeEEwSzJpVC12eFItbDhHY2cyLTJCYXZ0Y2NpLU5QSGMwR1ptZW9za2hUZTdBTi1qN1ZVRUo5WERkemlqbi1TcC16Q1FSNDcwNkFBVkgzOFI5LTZLTU1US1NMOW15N04tZG9GTEFBSDV6VXlqQXFFWWdFN1EtY2pJdDZGcHhHYzRKSm5SaW1kSE00ZEE2Y2RrWi1CU1NRQnd4NU5laklPUGdKZWtjWFk4cWkzbm5aYmd6bmd0Ymo2ZnpZOG91RlY0MTZmTFdfVlBBWEY5SGUxU0Y4dlBZYXRaVHp2RUNvM21BSW82V1ZVcGZfcHNDek50cVpxWmtSc1l1S0N0dTBuenlRakdVOGxscHNQMDQzczFESVY2WHA2MUFwVFlHNWFyYWhfVVpBUXB2R2ViTlh3aGF1dGhEYXRhWQFniEdtHUq-dDWB_X69oC3lAEoV7JF5c6tUOoMvLNh7bhlBAAAAg8h83ZdWwUm4niTLNjZU81AAIPDQBBpFAoMtqbB8vnIGNpTkC5pt8EaGq9G920Tnw0lqpAEDAzkBACBZAQC7_koxZ3PJ6uIHRuvfPIuer4fDMvOGUEz8JgKErTjsGRCtpexmdPULWrk4oBqecjW8d2gB-UYr0VrY9PCQKjF1Ihc8miZ5mAbb2wfvANRLyOJfSBzC9ufPRxOHWTeq4tE8E2RpvyNgruffMaKisqpGca6Ya_8KcDRUYeXlCdIyhGZoOqaov2h5h3Mtg17_PDSrTMjhJds_MFviJg0vyqY88asKHC9-P4SEzhFkweR8RNdoR3lF-NEpbE4r9K7mDj5nRyCPNW_BLDaLZkDsWuvVFLq9GgsgVahfgEib9OZ3B1G2f1ZwpJf3cyjILibrTlJXl3Ir6fhQASyQzjhg9hhfIUMBAAE';
      const clientDataJSON =
        'eyJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY2hhbGxlbmdlIjoibktKNkVPU2d4WU9Sa2w4VU41MTdwa2t0LVhPbF85NmpEa0I3VXJJdWo4bFFxUnlseTNzUjdBa1ZfNFdJdzZoQmZ4Z1FsYXRkYXNaZzlXYTFyZS15ZGciLCJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIn0';
      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const as = new AndroidSafenetFormat();
      as.config(attStmt, result as any, {} as any, {});

      try {
        const verified = await as.verify();
        t.fail('not come here');
      } catch (err) {
        t.match(err.message, /android-safetynet:ctsProfileMatch is false*/);
      } finally {
        clock.restore();
      }

      t.end();
    });

    t.test('### basicIntegrity is false', async (t) => {
      const clock = sinon.useFakeTimers({
        now: dayjs('2022-08-07T00:29:50.000Z').valueOf(),
      });

      const attestationObject =
        'o2NmbXRxYW5kcm9pZC1zYWZldHluZXRnYXR0U3RtdKJjdmVyaDEyNjg1MDIzaHJlc3BvbnNlWRX1ZXlKaGJHY2lPaUpTVXpJMU5pSXNJbmcxWXlJNld5Sk5TVWxHVm1wRFEwSkVObWRCZDBsQ1FXZEpVRUpHTlVaMU0zSlhXamhJTUdGT2JYaEJXVzU0VFVFd1IwTlRjVWRUU1dJelJGRkZRa04zVlVGTlJ6UjRRM3BCU2tKblRsWkNRVmxVUVd4V1ZFMVRjM2RMVVZsRVZsRlJTMFJEU2tkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUmxKNVpGaE9NRWxHVG14amJscHdXVEpXZWsxVVNYZE5RVmxFVmxGUlJFUkRiRWRUVlZKUVNVVkdjMkpIYkdoaWJVNXNZM2xDUjFGVmRFWkpSV3gxWkVkV2VXSnRWakJKUlVZeFpFZG9kbU50YkRCbFUwSkhUVlJCWlVaM01IbE5WRUUwVFVSamQwMUVTVFZOYW1oaFJuY3dlVTE2UVRSTlJHTjNUVVJKTlUxcWFHRk5TRVY0UTNwQlNrSm5UbFpDUVZsVVFXeFdWRTFSYzNkRFVWbEVWbEZSU1VSQlNrNVhWRVZUVFVKQlIwRXhWVVZDZDNkS1ZqSkdjbHBYV25CYVYzaHJUVkpaZDBaQldVUldVVkZMUkVFeFIxTlZVbEJKUlVaellrZHNhR0p0VG14TlVYZDNRMmRaUkZaUlVVeEVRVTVFVmpCamVFZDZRVnBDWjA1V1FrRk5UVVZ0UmpCa1IxWjZaRU0xYUdKdFVubGlNbXhyVEcxT2RtSlVRME5CVTBsM1JGRlpTa3R2V2tsb2RtTk9RVkZGUWtKUlFVUm5aMFZRUVVSRFEwRlJiME5uWjBWQ1FVeGFPVFJRZUVFeVdVNU9aVGxuZDA5VFNTdEtSRmhZTm5Bd2F6RjViRGg0U1haa1IyaFdZa280YlVWaE4yVlBjR1JaVm1wT2FtdFlPR3c1UWxwYVdqUkpTV2xuYkdzMmNTc3dUM3BQTTBwNlNrODVaM1JpV1RSMVZXMWxkVTlyYW1aV1pqaFlhVTgyVTNZNWNHZERiME5IY0ZJeGNGaG5TbVVyZHpjNU5rMHlTVXRoZFVWaWVXTm9hRVJXU1RaUlYxQndlRWR4VEhweVdscEZiak5NYlRkamQzZEhOR0poVkVWbVNEVTJOVk0zYUc1amFVZHFlRlIwUTJabk1IZ3JUbFZyVjNSU2VUaFhhSGxMWkhFek4wcHVNRlkzVTI1NmNVcFlXRmRMZERWUE1uTlFSbWN5Y2xWS1ZFNDRObXBzTWxkSlNUSmhRV05EVEhSTFFqazVaRFkwTkZKcVJEVlhla3hTY1hCbmFVbGhhV1oxVFVkWmJ6WnJWMHh4Y25BMVptVlJSVVIxSzNSd1VGVTRNMWRzVlVkTllpczJkU3Q1YVN0Tk5VbG1MelF4TlVOdU5XMVBWbTVSWVU5NVpXNUhjWFJ6T0RFelkwTkJkMFZCUVdGUFEwRmxkM2RuWjBodlRVTkZSMEV4VldSSlFWRmhUVUpuZDBSQldVdExkMWxDUWtGSVYyVlJTVVpCZWtGSlFtZGFibWRSZDBKQlowbDNSWGRaUkZaU01HeENRWGQzUTJkWlNVdDNXVUpDVVZWSVFYZEZkMFJCV1VSV1VqQlVRVkZJTDBKQlNYZEJSRUZrUW1kT1ZraFJORVZHWjFGVk1rVnBWSEUxVURoWk5XMW1aMVJIYmtWTmJ6WlRUVFpZZDNKQmQwaDNXVVJXVWpCcVFrSm5kMFp2UVZWUVUxZHllRU4zUmxCVVFrSnBVVlp3VkRKWksyaHlUVzFsWTBWM1dFRlpSRlpTTUdaQ1JsVjNWWHBDVW05RksyZFVXVnBNWVVoU01HTklUVFpNZVRsM1lUSnJkVmt5Vm5sa1IyeDFXbTVLYUV4dFduQmFSemxvWWtkNGNGbFhOV3BhVXpWMlkyMWpkbU15Um0xYVdGSTFZbTFXTUV3eVRubGlRemxvWkVoU2JHTXpVWFZaVnpWclkyMDVjRnBETldwaU1qQjFXVE5LYzAxSlNVSkJRVmxKUzNkWlFrSlJWVWhCVVVWRloyWk5kMmRtUVhka1FWbEpTM2RaUWtKUlZVaE5RVXRIWVVkb01HUklRbnBQYVRoMlkwZDBjRXh0VG14amJsSndZbTFhZVZsVE5XMWhWMUoyV1ZkNGMyRlhSblZaTWxWMVlqTktia3d6VG1oYWJWWXdaVmMxYkdSRE9VZFRWVkpRU2xSSmQxSnRSbkphVTFWNVRVWktkbUl6VVd4TmFrSkVXbGhLTUdGWFduQlpNa1l3V2xOVmVVMUZSakZrUjJoMlkyMXNNR1ZUVlhsTlJFbDNUVlJuZFZrelNqQk5TR2RIUTBOelIwRlJWVVpDZWtGQ2FHMTRiMlJJVW5kamVtOTJURE5DY21GVE5XcGFXRW93WVZjMWJXTnRSWFZhYld4cllqSkdjMkpIYkdoaWJVNXNURzA1ZVZwNU9YcFpWMXBzWkVoc2RWcFlVWFpaTTBwelREQmFTbEpGT0d4TmFrSkhXVmQwYkVwVVNYZFZiVGwyWkVOVmVVMUZUbXhqYmxKd1dtMXNhbGxZVW14S1ZFbDNVVmhXTUdGSE9YbGhXRkkxU2xSSmQwMXFRWGhQUXpWcVkyMTNkMFJSV1VwTGIxcEphSFpqVGtGUlJVeENVVUZFWjJkRlFrRkVWblJrTlhkTWF6UjVNVUpNVG1NeWNtRnJRa2Q1WldabGNVVnBlWFl3YmxoNFNGZFdhVlpPT1hFMGNuVnBkM0F5T1dORVlrb3pRMDVPUjNBdmIxVTBPVUZxZG1OblJERmhWVFJIZWt0alkyTnpLemsxV2xaV1RYQnRSRmhGTVd0clVIUmhZVnBEZG04M2JtZHJjVWQ1Y2xGS04ybFpkV1pvTDJ4VVF6VXZaV0ZDZFVWbVRuZHFNVmhtV1ZaUGFWSkNRbTFWYkVwQk9UWTJVbEJXVGpSalZIaDVNa0ZpYlc4NE1HZHJVVzh4YVdkbk0wNVJhV1JKVERkMFNVdGlabE14VDFWeFNsTndXSGhGU0c4NGRHWnBORzFyYTB4SE1rZE9ObFl6WmxKdEswUkZlV1ZCSzBwM05rWlVhVlo1UkUxcFoxZGxlbkV3YUhwdGVreHZRMWcxT0hSeloyb3JXRXB4ZEdOMmFYWTNlRVJGTWpaUFEwdzBVakJZT1dWSWNtOUlaVU5wTkV0dFpEZFVjazFPYTBFMGRUUmFhV0YyUjNCcmJscERaMHRtYzNBdk9IQkZPRTVwWWpkcVkxaEpUbFUxWm1aUWJGazlJaXdpVFVsSlJrdFVRME5DUWtkblFYZEpRa0ZuU1ZCQ1EySTFhVXRxV0RCV1NXMXFZM1Z6TkhkNU5VMUJNRWREVTNGSFUwbGlNMFJSUlVKRGQxVkJUVVpCZUVONlFVcENaMDVXUWtGWlZFRnNWbFJOVWxsM1JrRlpSRlpSVVV0RVFURkhVMVZTVUVsRlJuTmlSMnhvWW0xT2JFMVRhM2RLZDFsRVZsRlJSRVJEUWtkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUmtwMllqTlJaMUV3UldkTVUwSlVUVlJCWlVaM01IaE9la0Y1VFVSRmQwMUVRWGROUkVKaFJuY3dlazVVUVhoTmVrVjVUWHBWTlU1VWJHRk5SelI0UTNwQlNrSm5UbFpDUVZsVVFXeFdWRTFUYzNkTFVWbEVWbEZSUzBSRFNrZFRWVkpRU1VWR2MySkhiR2hpYlU1c1kzbENSMUZWZEVaSlJsSjVaRmhPTUVsR1RteGpibHB3V1RKV2VrMVVTWGROUVZsRVZsRlJSRVJEYkVkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUld4MVpFZFdlV0p0VmpCSlJVWXhaRWRvZG1OdGJEQmxVMEpIVFZSRFEwRlRTWGRFVVZsS1MyOWFTV2gyWTA1QlVVVkNRbEZCUkdkblJWQkJSRU5EUVZGdlEyZG5SVUpCVFVWSWJVWm1ZazU1Y0ZCMWNUazBheXRUVTBOcFZYWllVM1Z0YjJ4WmNFaFpTR2xyVUdGV01tcFJZbUpZZGtkMVNpdDNPSGw0ZWtoSFZWSkdXbEZNWmtOR1ZuSlVXakkyT1dWaWRsa3ljRTVzYUZWVGNFNUtZemRUY0dodmJGTnlPWFJEYW5WSVpFZE1NM1YyUW1Sd2VHRmFhblowWkZaRk5ubHVOVnAyUTNoNWVDOW9RV2QxUldSclpGQjFWa1Z0WkZaRWNqWTBZelk0WkRJNGIya3ZNMWx6Um01SlluRk5iblZZZGpod2NYWkdZWE5IYW1SVVYwWkRNMkYxU2tka2RUSjJOalZ6UWxVMGRsZGpja1ZHWkZscU1FMW5kMDlFTUd4dldVaGlLekI2UzBzNWQzaG1hVnBRVlZZNFNFVmFZa3QzUkZkbU5XcHZkV0ZqU21WWFdqTXlORmRHTVV4SVQycFhjbmhJWjI5RVVVSnBlbk15Y1ZWR1NuWkRUbWx1YzJGRFUwMDFTbE40VVhWc1RVZGtZa1JWVlZOMldUTnVhV3Q2Ym5KNVRuSk9ObVl2VDFKdVptc3lLMHRKZW5SamRESnJUMGxqUTBGM1JVRkJZVTlEUVdWQmQyZG5TR05OUVhOSFFURlZaRVIzVVVWQmQwbENhR3BDVlVKblRsWklVMEZGVkZSQ1RFMUZhMGRDYldWQ1JFRkZRMEZxUVM5TlJEQkhRME56UjBGUlZVWkNkMGxDUm1wR2IyUklVbmRqZW05MlRETkNjbUZUTldwYVdFb3dZVmMxYldOdFJYVmFiV3hyWWpKR2MySkhiR2hpYlU1c1RHMDVlVnA1T1hwWlYxcHNaRWhzZFZwWVVYWk5RakJIUVRGVlpFcFJVVmROUWxGSFEwTnpSMEZSVlVaQ2QwMUNRbWRuY2tKblJVWkNVV05FUVdwQlUwSm5UbFpJVWsxQ1FXWTRSVU5FUVVkQlVVZ3ZRV2RGUVUxQ01FZEJNVlZrUkdkUlYwSkNVVGxLWVhaRlRFRlZPVTFGUjBwQ1YyeFFXbW8yUjNONVdqVjNWRUZtUW1kT1ZraFRUVVZIUkVGWFowSlNZMWMxUXpSRWJqWkNOVFl6YW01Vk1tNURWSEZVV1hCMVprdEVRamxDWjA1V1NGSTRSV1JxUWpCTlNFdG5ZMHRDZFdodGVHOWtTRkozWTNwdmRrd3pRbkpoVXpWcVdsaEtNR0ZYTlcxamJVVjFXbTFzYTJJeVJuTmlSMnhvWW0xT2JFeHRPWGxhZVRsNldWZGFiR1JJYkhWYVdGRjJXVE5LYzB3d1drcFNSVGhzVFdwQ1IxbFhkR3hLVkVsM1ZXMDVkbVJEVlhsTlJVNXNZMjVTY0ZwdGJHcFpXRkpzU2xSSmQxRllWakJoUnpsNVlWaFNOVXBVU1hkTmFrRjRUME0xYW1OdGQzZG5XVkZIUTBOelIwRlJWVVpDZDBWQ1FraG5kMlJxUWpCQ1oyZHlRbWRGUmtKUlkzZEJXVnB2WVVoU01HTklUVFpNZVRsM1lUSnJkVmt5Vm5sa1IyeDFXbTVLYUV4dFduQmFSemxvWWtkNGNGbFhOV3BhVXpWMlkyMWpkbU15Um0xYVdGSTFZbTFXTUV3d1drcFNSVGhzVFdwQ1IxbFhkR3hLVkVsM1ZXMDVkbVJEVlhsTlJVNXNZMjVTY0ZwdGJHcFpXRkpzU2xSSmQxRllWakJoUnpsNVlWaFNOVXBVU1hkTmFrRjRUME0xYW1OdVVYZEVVVmxLUzI5YVNXaDJZMDVCVVVWTVFsRkJSR2RuUlVKQlEwb3JMMWxCVDBaaVpFZG9jMFZXWXpsS2VqTkVZVlpxZUZSeVVsQm9TM05NWTNsT01qTkxXWG9yVHpJNGJtRkhSR3RYTkc5cVIwRXZPSEpvY25RNU56aGtUelY0VDFaUlZEWkJhVEJQYm5oUVMzUlBZMUpwVURSMlJIZ3pSMFJrVEZSSE9XbEZNVXhQYkZWWVNHTnNabWRWWkhJNWVVNDNhSFp4VWtOMU1tOUNSbGRTVlVkWFRVNTRNR2R6WjJ4TFkyVnVTbTlEUkdSNVduaDNVWGhVTTBaM1IxQlRhbTFNTnpWRFZrbGxSVk0zVFM5U2RsWXJUVlZGUzNkNGJtMVBMMlIxY1ZCb2RYaElha0ZGY21SeE0xWnpTMGwyWXpVclFtY3JOazUyWkRKek5ERjZVMmgyUTBnMWVEa3phVTlyWmpWVFpUQTBaMlpNTlZveFMwbGtUMGRSUWtSRWVIcEdRbnBVWVVZNFRVNTJVbk5OZDNkcmN6bGtRVVpCV1Rod1JFZHNORXN5TkhOaWRtNTNkWFEzVFVWSWVsSlBha29yUjFGeWVqRmtiRFExVms1aFQyNHZhRm80UTBGek0wRTRkM2cwWW1GSlBTSmRmUS5leUp1YjI1alpTSTZJa05GV25aUVpqZDVRMUZzYUVoRlNtOUhhblZqVTJrNWVqRmpla2RSVEhkSGFGQnlibVJzWlRVM1V6QTlJaXdpZEdsdFpYTjBZVzF3VFhNaU9qRTJOVGs0TXpJeE5qZ3hPRGdzSW1Gd2ExQmhZMnRoWjJWT1lXMWxJam9pWTI5dExtRnVaSEp2YVdRdWEyVjVjM1J2Y21VdVlXNWtjbTlwWkd0bGVYTjBiM0psWkdWdGJ5SXNJbUZ3YTBScFoyVnpkRk5vWVRJMU5pSTZJbVJOTDB4VlNGTkpPVk5yVVdoYVNFaHdVVmRTYm5wS00wMTJka0l5UVU1VFlYVnhXVUZCWWxNeVNtYzlJaXdpWVhCclEyVnlkR2xtYVdOaGRHVkVhV2RsYzNSVGFHRXlOVFlpT2xzaVluTmlOQzlYVVdSaFlVOVhXVU5rTDJvNVQwcHBVWEJuTjJJd2FYZEdaMEZqTDNwNlFURjBRMlozUlQwaVhTd2lZM1J6VUhKdlptbHNaVTFoZEdOb0lqcDBjblZsTENKaVlYTnBZMGx1ZEdWbmNtbDBlU0k2ZEhKMVpYMC5YNFpYMXBtS005OXJocThyNXhUTFlfM0g2MjRCYTZHNXJCazR5R3dsNGtVUnhNRDZEQXcwaEZaVFZpLXc1QmdGV0xWYjVNb2VUMmxUZUw1Tk9vVDY5b01qek4tN3dDcVdGa0w5Xy1ONFpwQXk2aWIxdWs3eG5iN3ZHcnlsb0o0Q3p3bDB5cC12d1BsMDgwdzhVVXU2TjFsTzBJS19BbjFnODFJSVZZZk1qQ0JQejRPZEZxeFh1SHRWMEpXRzk0andFUUJrOXRmeUNMR25wdVhzR3RFUkxzV2U3N2MzYUJzcWY1LVkyNlpfYTBINzJYNUVaRU5fa2FiODJHV2p3Q0dmZVpaT2NzQVVIOENpSDYwMkl5U2ZadHo1Uy1iV09IRTNRZlAtXzZpelpTTG43MTZNZV9VdFZpSlpzckZFZUJDUTVodjctMEhmbUJPUTQ0RzFDS29ZUHdoYXV0aERhdGFZAWeIR20dSr50NYH9fr2gLeUAShXskXlzq1Q6gy8s2HtuGUEAAABxyHzdl1bBSbieJMs2NlTzUAAgd7XmNKs0tMlpq4BQWqji5yuOYO9jafKPRGEhHuUMAD2kAQMDOQEAIFkBAKD0elziSAkrmikjxbDCUkXN20TUZ38cFepjsgG395tU2Yhb06ATz8yBZFSQv4ulX0oGQw4TY1c_X9fr-QV6miJwdl3IB1H-7D8xJrQpKerspNNHuJ6ZHziOoN1OF2l4rc1qnmblblAoYCqycjUMpyuPgZqR7gGkv_r5GexVsx02p3VVqSZhhDkrGKKAuHgiVGuBe7uvoE7NN-Voo3doathG3Fxg-O0KVQXu0glk-EkZszUxDZj6zM03L3gzQBTzQ256fUdHZ3EJw4wvM3yH7OAE5ZThkVMbs9FngGXo6q9zIpFZAVNX6tMxFjGP1oy_NccNtmuGGLeabyE7s01ANIchQwEAAQ';
      const clientDataJSON =
        'eyJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY2hhbGxlbmdlIjoiNmFRMk5Id28weUR0OGZHeExTc05FOXEwcUtNbVhBYk92VXBua0pPLUJCeWRTWThiUmNJRnpDaENfSzN6RTZ5R0ZVQkZ5dS1tem51VDJPUlFRWmVfOGciLCJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIn0';
      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const as = new AndroidSafenetFormat();
      as.config(
        {
          ...attStmt,
          response: str2ab.string2arraybuffer(
            [
              str2ab.string2base64url(JSON.stringify({})),
              str2ab.string2base64url(
                JSON.stringify({
                  timestampMs: 1659832190000,
                  nonce: 'nonce',
                  apkPackageName: 'apn',
                  apkCertificateDigestSha256: 'sha256',
                  ctsProfileMatch: true,
                  basicIntegrity: false,
                })
              ),
              'signature',
            ].join('.')
          ),
        },
        result as any,
        {} as any,
        {}
      );

      try {
        const verified = await as.verify();
        t.fail('not come here');
      } catch (err) {
        t.match(err.message, /android-safetynet:basicIntegrity is false*/);
      } finally {
        clock.restore();
      }

      t.end();
    });

    t.test('### result is null', async (t) => {
      const clock = sinon.useFakeTimers({
        now: dayjs('2022-08-07T00:29:50.000Z').valueOf(),
      });

      const attestationObject =
        'o2NmbXRxYW5kcm9pZC1zYWZldHluZXRnYXR0U3RtdKJjdmVyaDEyNjg1MDIzaHJlc3BvbnNlWRX1ZXlKaGJHY2lPaUpTVXpJMU5pSXNJbmcxWXlJNld5Sk5TVWxHVm1wRFEwSkVObWRCZDBsQ1FXZEpVRUpHTlVaMU0zSlhXamhJTUdGT2JYaEJXVzU0VFVFd1IwTlRjVWRUU1dJelJGRkZRa04zVlVGTlJ6UjRRM3BCU2tKblRsWkNRVmxVUVd4V1ZFMVRjM2RMVVZsRVZsRlJTMFJEU2tkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUmxKNVpGaE9NRWxHVG14amJscHdXVEpXZWsxVVNYZE5RVmxFVmxGUlJFUkRiRWRUVlZKUVNVVkdjMkpIYkdoaWJVNXNZM2xDUjFGVmRFWkpSV3gxWkVkV2VXSnRWakJKUlVZeFpFZG9kbU50YkRCbFUwSkhUVlJCWlVaM01IbE5WRUUwVFVSamQwMUVTVFZOYW1oaFJuY3dlVTE2UVRSTlJHTjNUVVJKTlUxcWFHRk5TRVY0UTNwQlNrSm5UbFpDUVZsVVFXeFdWRTFSYzNkRFVWbEVWbEZSU1VSQlNrNVhWRVZUVFVKQlIwRXhWVVZDZDNkS1ZqSkdjbHBYV25CYVYzaHJUVkpaZDBaQldVUldVVkZMUkVFeFIxTlZVbEJKUlVaellrZHNhR0p0VG14TlVYZDNRMmRaUkZaUlVVeEVRVTVFVmpCamVFZDZRVnBDWjA1V1FrRk5UVVZ0UmpCa1IxWjZaRU0xYUdKdFVubGlNbXhyVEcxT2RtSlVRME5CVTBsM1JGRlpTa3R2V2tsb2RtTk9RVkZGUWtKUlFVUm5aMFZRUVVSRFEwRlJiME5uWjBWQ1FVeGFPVFJRZUVFeVdVNU9aVGxuZDA5VFNTdEtSRmhZTm5Bd2F6RjViRGg0U1haa1IyaFdZa280YlVWaE4yVlBjR1JaVm1wT2FtdFlPR3c1UWxwYVdqUkpTV2xuYkdzMmNTc3dUM3BQTTBwNlNrODVaM1JpV1RSMVZXMWxkVTlyYW1aV1pqaFlhVTgyVTNZNWNHZERiME5IY0ZJeGNGaG5TbVVyZHpjNU5rMHlTVXRoZFVWaWVXTm9hRVJXU1RaUlYxQndlRWR4VEhweVdscEZiak5NYlRkamQzZEhOR0poVkVWbVNEVTJOVk0zYUc1amFVZHFlRlIwUTJabk1IZ3JUbFZyVjNSU2VUaFhhSGxMWkhFek4wcHVNRlkzVTI1NmNVcFlXRmRMZERWUE1uTlFSbWN5Y2xWS1ZFNDRObXBzTWxkSlNUSmhRV05EVEhSTFFqazVaRFkwTkZKcVJEVlhla3hTY1hCbmFVbGhhV1oxVFVkWmJ6WnJWMHh4Y25BMVptVlJSVVIxSzNSd1VGVTRNMWRzVlVkTllpczJkU3Q1YVN0Tk5VbG1MelF4TlVOdU5XMVBWbTVSWVU5NVpXNUhjWFJ6T0RFelkwTkJkMFZCUVdGUFEwRmxkM2RuWjBodlRVTkZSMEV4VldSSlFWRmhUVUpuZDBSQldVdExkMWxDUWtGSVYyVlJTVVpCZWtGSlFtZGFibWRSZDBKQlowbDNSWGRaUkZaU01HeENRWGQzUTJkWlNVdDNXVUpDVVZWSVFYZEZkMFJCV1VSV1VqQlVRVkZJTDBKQlNYZEJSRUZrUW1kT1ZraFJORVZHWjFGVk1rVnBWSEUxVURoWk5XMW1aMVJIYmtWTmJ6WlRUVFpZZDNKQmQwaDNXVVJXVWpCcVFrSm5kMFp2UVZWUVUxZHllRU4zUmxCVVFrSnBVVlp3VkRKWksyaHlUVzFsWTBWM1dFRlpSRlpTTUdaQ1JsVjNWWHBDVW05RksyZFVXVnBNWVVoU01HTklUVFpNZVRsM1lUSnJkVmt5Vm5sa1IyeDFXbTVLYUV4dFduQmFSemxvWWtkNGNGbFhOV3BhVXpWMlkyMWpkbU15Um0xYVdGSTFZbTFXTUV3eVRubGlRemxvWkVoU2JHTXpVWFZaVnpWclkyMDVjRnBETldwaU1qQjFXVE5LYzAxSlNVSkJRVmxKUzNkWlFrSlJWVWhCVVVWRloyWk5kMmRtUVhka1FWbEpTM2RaUWtKUlZVaE5RVXRIWVVkb01HUklRbnBQYVRoMlkwZDBjRXh0VG14amJsSndZbTFhZVZsVE5XMWhWMUoyV1ZkNGMyRlhSblZaTWxWMVlqTktia3d6VG1oYWJWWXdaVmMxYkdSRE9VZFRWVkpRU2xSSmQxSnRSbkphVTFWNVRVWktkbUl6VVd4TmFrSkVXbGhLTUdGWFduQlpNa1l3V2xOVmVVMUZSakZrUjJoMlkyMXNNR1ZUVlhsTlJFbDNUVlJuZFZrelNqQk5TR2RIUTBOelIwRlJWVVpDZWtGQ2FHMTRiMlJJVW5kamVtOTJURE5DY21GVE5XcGFXRW93WVZjMWJXTnRSWFZhYld4cllqSkdjMkpIYkdoaWJVNXNURzA1ZVZwNU9YcFpWMXBzWkVoc2RWcFlVWFpaTTBwelREQmFTbEpGT0d4TmFrSkhXVmQwYkVwVVNYZFZiVGwyWkVOVmVVMUZUbXhqYmxKd1dtMXNhbGxZVW14S1ZFbDNVVmhXTUdGSE9YbGhXRkkxU2xSSmQwMXFRWGhQUXpWcVkyMTNkMFJSV1VwTGIxcEphSFpqVGtGUlJVeENVVUZFWjJkRlFrRkVWblJrTlhkTWF6UjVNVUpNVG1NeWNtRnJRa2Q1WldabGNVVnBlWFl3YmxoNFNGZFdhVlpPT1hFMGNuVnBkM0F5T1dORVlrb3pRMDVPUjNBdmIxVTBPVUZxZG1OblJERmhWVFJIZWt0alkyTnpLemsxV2xaV1RYQnRSRmhGTVd0clVIUmhZVnBEZG04M2JtZHJjVWQ1Y2xGS04ybFpkV1pvTDJ4VVF6VXZaV0ZDZFVWbVRuZHFNVmhtV1ZaUGFWSkNRbTFWYkVwQk9UWTJVbEJXVGpSalZIaDVNa0ZpYlc4NE1HZHJVVzh4YVdkbk0wNVJhV1JKVERkMFNVdGlabE14VDFWeFNsTndXSGhGU0c4NGRHWnBORzFyYTB4SE1rZE9ObFl6WmxKdEswUkZlV1ZCSzBwM05rWlVhVlo1UkUxcFoxZGxlbkV3YUhwdGVreHZRMWcxT0hSeloyb3JXRXB4ZEdOMmFYWTNlRVJGTWpaUFEwdzBVakJZT1dWSWNtOUlaVU5wTkV0dFpEZFVjazFPYTBFMGRUUmFhV0YyUjNCcmJscERaMHRtYzNBdk9IQkZPRTVwWWpkcVkxaEpUbFUxWm1aUWJGazlJaXdpVFVsSlJrdFVRME5DUWtkblFYZEpRa0ZuU1ZCQ1EySTFhVXRxV0RCV1NXMXFZM1Z6TkhkNU5VMUJNRWREVTNGSFUwbGlNMFJSUlVKRGQxVkJUVVpCZUVONlFVcENaMDVXUWtGWlZFRnNWbFJOVWxsM1JrRlpSRlpSVVV0RVFURkhVMVZTVUVsRlJuTmlSMnhvWW0xT2JFMVRhM2RLZDFsRVZsRlJSRVJEUWtkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUmtwMllqTlJaMUV3UldkTVUwSlVUVlJCWlVaM01IaE9la0Y1VFVSRmQwMUVRWGROUkVKaFJuY3dlazVVUVhoTmVrVjVUWHBWTlU1VWJHRk5SelI0UTNwQlNrSm5UbFpDUVZsVVFXeFdWRTFUYzNkTFVWbEVWbEZSUzBSRFNrZFRWVkpRU1VWR2MySkhiR2hpYlU1c1kzbENSMUZWZEVaSlJsSjVaRmhPTUVsR1RteGpibHB3V1RKV2VrMVVTWGROUVZsRVZsRlJSRVJEYkVkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUld4MVpFZFdlV0p0VmpCSlJVWXhaRWRvZG1OdGJEQmxVMEpIVFZSRFEwRlRTWGRFVVZsS1MyOWFTV2gyWTA1QlVVVkNRbEZCUkdkblJWQkJSRU5EUVZGdlEyZG5SVUpCVFVWSWJVWm1ZazU1Y0ZCMWNUazBheXRUVTBOcFZYWllVM1Z0YjJ4WmNFaFpTR2xyVUdGV01tcFJZbUpZZGtkMVNpdDNPSGw0ZWtoSFZWSkdXbEZNWmtOR1ZuSlVXakkyT1dWaWRsa3ljRTVzYUZWVGNFNUtZemRUY0dodmJGTnlPWFJEYW5WSVpFZE1NM1YyUW1Sd2VHRmFhblowWkZaRk5ubHVOVnAyUTNoNWVDOW9RV2QxUldSclpGQjFWa1Z0WkZaRWNqWTBZelk0WkRJNGIya3ZNMWx6Um01SlluRk5iblZZZGpod2NYWkdZWE5IYW1SVVYwWkRNMkYxU2tka2RUSjJOalZ6UWxVMGRsZGpja1ZHWkZscU1FMW5kMDlFTUd4dldVaGlLekI2UzBzNWQzaG1hVnBRVlZZNFNFVmFZa3QzUkZkbU5XcHZkV0ZqU21WWFdqTXlORmRHTVV4SVQycFhjbmhJWjI5RVVVSnBlbk15Y1ZWR1NuWkRUbWx1YzJGRFUwMDFTbE40VVhWc1RVZGtZa1JWVlZOMldUTnVhV3Q2Ym5KNVRuSk9ObVl2VDFKdVptc3lLMHRKZW5SamRESnJUMGxqUTBGM1JVRkJZVTlEUVdWQmQyZG5TR05OUVhOSFFURlZaRVIzVVVWQmQwbENhR3BDVlVKblRsWklVMEZGVkZSQ1RFMUZhMGRDYldWQ1JFRkZRMEZxUVM5TlJEQkhRME56UjBGUlZVWkNkMGxDUm1wR2IyUklVbmRqZW05MlRETkNjbUZUTldwYVdFb3dZVmMxYldOdFJYVmFiV3hyWWpKR2MySkhiR2hpYlU1c1RHMDVlVnA1T1hwWlYxcHNaRWhzZFZwWVVYWk5RakJIUVRGVlpFcFJVVmROUWxGSFEwTnpSMEZSVlVaQ2QwMUNRbWRuY2tKblJVWkNVV05FUVdwQlUwSm5UbFpJVWsxQ1FXWTRSVU5FUVVkQlVVZ3ZRV2RGUVUxQ01FZEJNVlZrUkdkUlYwSkNVVGxLWVhaRlRFRlZPVTFGUjBwQ1YyeFFXbW8yUjNONVdqVjNWRUZtUW1kT1ZraFRUVVZIUkVGWFowSlNZMWMxUXpSRWJqWkNOVFl6YW01Vk1tNURWSEZVV1hCMVprdEVRamxDWjA1V1NGSTRSV1JxUWpCTlNFdG5ZMHRDZFdodGVHOWtTRkozWTNwdmRrd3pRbkpoVXpWcVdsaEtNR0ZYTlcxamJVVjFXbTFzYTJJeVJuTmlSMnhvWW0xT2JFeHRPWGxhZVRsNldWZGFiR1JJYkhWYVdGRjJXVE5LYzB3d1drcFNSVGhzVFdwQ1IxbFhkR3hLVkVsM1ZXMDVkbVJEVlhsTlJVNXNZMjVTY0ZwdGJHcFpXRkpzU2xSSmQxRllWakJoUnpsNVlWaFNOVXBVU1hkTmFrRjRUME0xYW1OdGQzZG5XVkZIUTBOelIwRlJWVVpDZDBWQ1FraG5kMlJxUWpCQ1oyZHlRbWRGUmtKUlkzZEJXVnB2WVVoU01HTklUVFpNZVRsM1lUSnJkVmt5Vm5sa1IyeDFXbTVLYUV4dFduQmFSemxvWWtkNGNGbFhOV3BhVXpWMlkyMWpkbU15Um0xYVdGSTFZbTFXTUV3d1drcFNSVGhzVFdwQ1IxbFhkR3hLVkVsM1ZXMDVkbVJEVlhsTlJVNXNZMjVTY0ZwdGJHcFpXRkpzU2xSSmQxRllWakJoUnpsNVlWaFNOVXBVU1hkTmFrRjRUME0xYW1OdVVYZEVVVmxLUzI5YVNXaDJZMDVCVVVWTVFsRkJSR2RuUlVKQlEwb3JMMWxCVDBaaVpFZG9jMFZXWXpsS2VqTkVZVlpxZUZSeVVsQm9TM05NWTNsT01qTkxXWG9yVHpJNGJtRkhSR3RYTkc5cVIwRXZPSEpvY25RNU56aGtUelY0VDFaUlZEWkJhVEJQYm5oUVMzUlBZMUpwVURSMlJIZ3pSMFJrVEZSSE9XbEZNVXhQYkZWWVNHTnNabWRWWkhJNWVVNDNhSFp4VWtOMU1tOUNSbGRTVlVkWFRVNTRNR2R6WjJ4TFkyVnVTbTlEUkdSNVduaDNVWGhVTTBaM1IxQlRhbTFNTnpWRFZrbGxSVk0zVFM5U2RsWXJUVlZGUzNkNGJtMVBMMlIxY1ZCb2RYaElha0ZGY21SeE0xWnpTMGwyWXpVclFtY3JOazUyWkRKek5ERjZVMmgyUTBnMWVEa3phVTlyWmpWVFpUQTBaMlpNTlZveFMwbGtUMGRSUWtSRWVIcEdRbnBVWVVZNFRVNTJVbk5OZDNkcmN6bGtRVVpCV1Rod1JFZHNORXN5TkhOaWRtNTNkWFEzVFVWSWVsSlBha29yUjFGeWVqRmtiRFExVms1aFQyNHZhRm80UTBGek0wRTRkM2cwWW1GSlBTSmRmUS5leUp1YjI1alpTSTZJa05GV25aUVpqZDVRMUZzYUVoRlNtOUhhblZqVTJrNWVqRmpla2RSVEhkSGFGQnlibVJzWlRVM1V6QTlJaXdpZEdsdFpYTjBZVzF3VFhNaU9qRTJOVGs0TXpJeE5qZ3hPRGdzSW1Gd2ExQmhZMnRoWjJWT1lXMWxJam9pWTI5dExtRnVaSEp2YVdRdWEyVjVjM1J2Y21VdVlXNWtjbTlwWkd0bGVYTjBiM0psWkdWdGJ5SXNJbUZ3YTBScFoyVnpkRk5vWVRJMU5pSTZJbVJOTDB4VlNGTkpPVk5yVVdoYVNFaHdVVmRTYm5wS00wMTJka0l5UVU1VFlYVnhXVUZCWWxNeVNtYzlJaXdpWVhCclEyVnlkR2xtYVdOaGRHVkVhV2RsYzNSVGFHRXlOVFlpT2xzaVluTmlOQzlYVVdSaFlVOVhXVU5rTDJvNVQwcHBVWEJuTjJJd2FYZEdaMEZqTDNwNlFURjBRMlozUlQwaVhTd2lZM1J6VUhKdlptbHNaVTFoZEdOb0lqcDBjblZsTENKaVlYTnBZMGx1ZEdWbmNtbDBlU0k2ZEhKMVpYMC5YNFpYMXBtS005OXJocThyNXhUTFlfM0g2MjRCYTZHNXJCazR5R3dsNGtVUnhNRDZEQXcwaEZaVFZpLXc1QmdGV0xWYjVNb2VUMmxUZUw1Tk9vVDY5b01qek4tN3dDcVdGa0w5Xy1ONFpwQXk2aWIxdWs3eG5iN3ZHcnlsb0o0Q3p3bDB5cC12d1BsMDgwdzhVVXU2TjFsTzBJS19BbjFnODFJSVZZZk1qQ0JQejRPZEZxeFh1SHRWMEpXRzk0andFUUJrOXRmeUNMR25wdVhzR3RFUkxzV2U3N2MzYUJzcWY1LVkyNlpfYTBINzJYNUVaRU5fa2FiODJHV2p3Q0dmZVpaT2NzQVVIOENpSDYwMkl5U2ZadHo1Uy1iV09IRTNRZlAtXzZpelpTTG43MTZNZV9VdFZpSlpzckZFZUJDUTVodjctMEhmbUJPUTQ0RzFDS29ZUHdoYXV0aERhdGFZAWeIR20dSr50NYH9fr2gLeUAShXskXlzq1Q6gy8s2HtuGUEAAABxyHzdl1bBSbieJMs2NlTzUAAgd7XmNKs0tMlpq4BQWqji5yuOYO9jafKPRGEhHuUMAD2kAQMDOQEAIFkBAKD0elziSAkrmikjxbDCUkXN20TUZ38cFepjsgG395tU2Yhb06ATz8yBZFSQv4ulX0oGQw4TY1c_X9fr-QV6miJwdl3IB1H-7D8xJrQpKerspNNHuJ6ZHziOoN1OF2l4rc1qnmblblAoYCqycjUMpyuPgZqR7gGkv_r5GexVsx02p3VVqSZhhDkrGKKAuHgiVGuBe7uvoE7NN-Voo3doathG3Fxg-O0KVQXu0glk-EkZszUxDZj6zM03L3gzQBTzQ256fUdHZ3EJw4wvM3yH7OAE5ZThkVMbs9FngGXo6q9zIpFZAVNX6tMxFjGP1oy_NccNtmuGGLeabyE7s01ANIchQwEAAQ';
      const clientDataJSON =
        'eyJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY2hhbGxlbmdlIjoiNmFRMk5Id28weUR0OGZHeExTc05FOXEwcUtNbVhBYk92VXBua0pPLUJCeWRTWThiUmNJRnpDaENfSzN6RTZ5R0ZVQkZ5dS1tem51VDJPUlFRWmVfOGciLCJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIn0';
      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const as = new AndroidSafenetFormat();
      as.config(attStmt, null as any, {} as any, {});

      try {
        const verified = await as.verify();
        t.fail('not come here');
      } catch (err) {
        t.match(err.message, /android-safetynet:Data is not enough*/);
      } finally {
        clock.restore();
      }

      t.end();
    });

    t.test('### result.authData is null', async (t) => {
      const clock = sinon.useFakeTimers({
        now: dayjs('2022-08-07T00:29:50.000Z').valueOf(),
      });

      const attestationObject =
        'o2NmbXRxYW5kcm9pZC1zYWZldHluZXRnYXR0U3RtdKJjdmVyaDEyNjg1MDIzaHJlc3BvbnNlWRX1ZXlKaGJHY2lPaUpTVXpJMU5pSXNJbmcxWXlJNld5Sk5TVWxHVm1wRFEwSkVObWRCZDBsQ1FXZEpVRUpHTlVaMU0zSlhXamhJTUdGT2JYaEJXVzU0VFVFd1IwTlRjVWRUU1dJelJGRkZRa04zVlVGTlJ6UjRRM3BCU2tKblRsWkNRVmxVUVd4V1ZFMVRjM2RMVVZsRVZsRlJTMFJEU2tkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUmxKNVpGaE9NRWxHVG14amJscHdXVEpXZWsxVVNYZE5RVmxFVmxGUlJFUkRiRWRUVlZKUVNVVkdjMkpIYkdoaWJVNXNZM2xDUjFGVmRFWkpSV3gxWkVkV2VXSnRWakJKUlVZeFpFZG9kbU50YkRCbFUwSkhUVlJCWlVaM01IbE5WRUUwVFVSamQwMUVTVFZOYW1oaFJuY3dlVTE2UVRSTlJHTjNUVVJKTlUxcWFHRk5TRVY0UTNwQlNrSm5UbFpDUVZsVVFXeFdWRTFSYzNkRFVWbEVWbEZSU1VSQlNrNVhWRVZUVFVKQlIwRXhWVVZDZDNkS1ZqSkdjbHBYV25CYVYzaHJUVkpaZDBaQldVUldVVkZMUkVFeFIxTlZVbEJKUlVaellrZHNhR0p0VG14TlVYZDNRMmRaUkZaUlVVeEVRVTVFVmpCamVFZDZRVnBDWjA1V1FrRk5UVVZ0UmpCa1IxWjZaRU0xYUdKdFVubGlNbXhyVEcxT2RtSlVRME5CVTBsM1JGRlpTa3R2V2tsb2RtTk9RVkZGUWtKUlFVUm5aMFZRUVVSRFEwRlJiME5uWjBWQ1FVeGFPVFJRZUVFeVdVNU9aVGxuZDA5VFNTdEtSRmhZTm5Bd2F6RjViRGg0U1haa1IyaFdZa280YlVWaE4yVlBjR1JaVm1wT2FtdFlPR3c1UWxwYVdqUkpTV2xuYkdzMmNTc3dUM3BQTTBwNlNrODVaM1JpV1RSMVZXMWxkVTlyYW1aV1pqaFlhVTgyVTNZNWNHZERiME5IY0ZJeGNGaG5TbVVyZHpjNU5rMHlTVXRoZFVWaWVXTm9hRVJXU1RaUlYxQndlRWR4VEhweVdscEZiak5NYlRkamQzZEhOR0poVkVWbVNEVTJOVk0zYUc1amFVZHFlRlIwUTJabk1IZ3JUbFZyVjNSU2VUaFhhSGxMWkhFek4wcHVNRlkzVTI1NmNVcFlXRmRMZERWUE1uTlFSbWN5Y2xWS1ZFNDRObXBzTWxkSlNUSmhRV05EVEhSTFFqazVaRFkwTkZKcVJEVlhla3hTY1hCbmFVbGhhV1oxVFVkWmJ6WnJWMHh4Y25BMVptVlJSVVIxSzNSd1VGVTRNMWRzVlVkTllpczJkU3Q1YVN0Tk5VbG1MelF4TlVOdU5XMVBWbTVSWVU5NVpXNUhjWFJ6T0RFelkwTkJkMFZCUVdGUFEwRmxkM2RuWjBodlRVTkZSMEV4VldSSlFWRmhUVUpuZDBSQldVdExkMWxDUWtGSVYyVlJTVVpCZWtGSlFtZGFibWRSZDBKQlowbDNSWGRaUkZaU01HeENRWGQzUTJkWlNVdDNXVUpDVVZWSVFYZEZkMFJCV1VSV1VqQlVRVkZJTDBKQlNYZEJSRUZrUW1kT1ZraFJORVZHWjFGVk1rVnBWSEUxVURoWk5XMW1aMVJIYmtWTmJ6WlRUVFpZZDNKQmQwaDNXVVJXVWpCcVFrSm5kMFp2UVZWUVUxZHllRU4zUmxCVVFrSnBVVlp3VkRKWksyaHlUVzFsWTBWM1dFRlpSRlpTTUdaQ1JsVjNWWHBDVW05RksyZFVXVnBNWVVoU01HTklUVFpNZVRsM1lUSnJkVmt5Vm5sa1IyeDFXbTVLYUV4dFduQmFSemxvWWtkNGNGbFhOV3BhVXpWMlkyMWpkbU15Um0xYVdGSTFZbTFXTUV3eVRubGlRemxvWkVoU2JHTXpVWFZaVnpWclkyMDVjRnBETldwaU1qQjFXVE5LYzAxSlNVSkJRVmxKUzNkWlFrSlJWVWhCVVVWRloyWk5kMmRtUVhka1FWbEpTM2RaUWtKUlZVaE5RVXRIWVVkb01HUklRbnBQYVRoMlkwZDBjRXh0VG14amJsSndZbTFhZVZsVE5XMWhWMUoyV1ZkNGMyRlhSblZaTWxWMVlqTktia3d6VG1oYWJWWXdaVmMxYkdSRE9VZFRWVkpRU2xSSmQxSnRSbkphVTFWNVRVWktkbUl6VVd4TmFrSkVXbGhLTUdGWFduQlpNa1l3V2xOVmVVMUZSakZrUjJoMlkyMXNNR1ZUVlhsTlJFbDNUVlJuZFZrelNqQk5TR2RIUTBOelIwRlJWVVpDZWtGQ2FHMTRiMlJJVW5kamVtOTJURE5DY21GVE5XcGFXRW93WVZjMWJXTnRSWFZhYld4cllqSkdjMkpIYkdoaWJVNXNURzA1ZVZwNU9YcFpWMXBzWkVoc2RWcFlVWFpaTTBwelREQmFTbEpGT0d4TmFrSkhXVmQwYkVwVVNYZFZiVGwyWkVOVmVVMUZUbXhqYmxKd1dtMXNhbGxZVW14S1ZFbDNVVmhXTUdGSE9YbGhXRkkxU2xSSmQwMXFRWGhQUXpWcVkyMTNkMFJSV1VwTGIxcEphSFpqVGtGUlJVeENVVUZFWjJkRlFrRkVWblJrTlhkTWF6UjVNVUpNVG1NeWNtRnJRa2Q1WldabGNVVnBlWFl3YmxoNFNGZFdhVlpPT1hFMGNuVnBkM0F5T1dORVlrb3pRMDVPUjNBdmIxVTBPVUZxZG1OblJERmhWVFJIZWt0alkyTnpLemsxV2xaV1RYQnRSRmhGTVd0clVIUmhZVnBEZG04M2JtZHJjVWQ1Y2xGS04ybFpkV1pvTDJ4VVF6VXZaV0ZDZFVWbVRuZHFNVmhtV1ZaUGFWSkNRbTFWYkVwQk9UWTJVbEJXVGpSalZIaDVNa0ZpYlc4NE1HZHJVVzh4YVdkbk0wNVJhV1JKVERkMFNVdGlabE14VDFWeFNsTndXSGhGU0c4NGRHWnBORzFyYTB4SE1rZE9ObFl6WmxKdEswUkZlV1ZCSzBwM05rWlVhVlo1UkUxcFoxZGxlbkV3YUhwdGVreHZRMWcxT0hSeloyb3JXRXB4ZEdOMmFYWTNlRVJGTWpaUFEwdzBVakJZT1dWSWNtOUlaVU5wTkV0dFpEZFVjazFPYTBFMGRUUmFhV0YyUjNCcmJscERaMHRtYzNBdk9IQkZPRTVwWWpkcVkxaEpUbFUxWm1aUWJGazlJaXdpVFVsSlJrdFVRME5DUWtkblFYZEpRa0ZuU1ZCQ1EySTFhVXRxV0RCV1NXMXFZM1Z6TkhkNU5VMUJNRWREVTNGSFUwbGlNMFJSUlVKRGQxVkJUVVpCZUVONlFVcENaMDVXUWtGWlZFRnNWbFJOVWxsM1JrRlpSRlpSVVV0RVFURkhVMVZTVUVsRlJuTmlSMnhvWW0xT2JFMVRhM2RLZDFsRVZsRlJSRVJEUWtkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUmtwMllqTlJaMUV3UldkTVUwSlVUVlJCWlVaM01IaE9la0Y1VFVSRmQwMUVRWGROUkVKaFJuY3dlazVVUVhoTmVrVjVUWHBWTlU1VWJHRk5SelI0UTNwQlNrSm5UbFpDUVZsVVFXeFdWRTFUYzNkTFVWbEVWbEZSUzBSRFNrZFRWVkpRU1VWR2MySkhiR2hpYlU1c1kzbENSMUZWZEVaSlJsSjVaRmhPTUVsR1RteGpibHB3V1RKV2VrMVVTWGROUVZsRVZsRlJSRVJEYkVkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUld4MVpFZFdlV0p0VmpCSlJVWXhaRWRvZG1OdGJEQmxVMEpIVFZSRFEwRlRTWGRFVVZsS1MyOWFTV2gyWTA1QlVVVkNRbEZCUkdkblJWQkJSRU5EUVZGdlEyZG5SVUpCVFVWSWJVWm1ZazU1Y0ZCMWNUazBheXRUVTBOcFZYWllVM1Z0YjJ4WmNFaFpTR2xyVUdGV01tcFJZbUpZZGtkMVNpdDNPSGw0ZWtoSFZWSkdXbEZNWmtOR1ZuSlVXakkyT1dWaWRsa3ljRTVzYUZWVGNFNUtZemRUY0dodmJGTnlPWFJEYW5WSVpFZE1NM1YyUW1Sd2VHRmFhblowWkZaRk5ubHVOVnAyUTNoNWVDOW9RV2QxUldSclpGQjFWa1Z0WkZaRWNqWTBZelk0WkRJNGIya3ZNMWx6Um01SlluRk5iblZZZGpod2NYWkdZWE5IYW1SVVYwWkRNMkYxU2tka2RUSjJOalZ6UWxVMGRsZGpja1ZHWkZscU1FMW5kMDlFTUd4dldVaGlLekI2UzBzNWQzaG1hVnBRVlZZNFNFVmFZa3QzUkZkbU5XcHZkV0ZqU21WWFdqTXlORmRHTVV4SVQycFhjbmhJWjI5RVVVSnBlbk15Y1ZWR1NuWkRUbWx1YzJGRFUwMDFTbE40VVhWc1RVZGtZa1JWVlZOMldUTnVhV3Q2Ym5KNVRuSk9ObVl2VDFKdVptc3lLMHRKZW5SamRESnJUMGxqUTBGM1JVRkJZVTlEUVdWQmQyZG5TR05OUVhOSFFURlZaRVIzVVVWQmQwbENhR3BDVlVKblRsWklVMEZGVkZSQ1RFMUZhMGRDYldWQ1JFRkZRMEZxUVM5TlJEQkhRME56UjBGUlZVWkNkMGxDUm1wR2IyUklVbmRqZW05MlRETkNjbUZUTldwYVdFb3dZVmMxYldOdFJYVmFiV3hyWWpKR2MySkhiR2hpYlU1c1RHMDVlVnA1T1hwWlYxcHNaRWhzZFZwWVVYWk5RakJIUVRGVlpFcFJVVmROUWxGSFEwTnpSMEZSVlVaQ2QwMUNRbWRuY2tKblJVWkNVV05FUVdwQlUwSm5UbFpJVWsxQ1FXWTRSVU5FUVVkQlVVZ3ZRV2RGUVUxQ01FZEJNVlZrUkdkUlYwSkNVVGxLWVhaRlRFRlZPVTFGUjBwQ1YyeFFXbW8yUjNONVdqVjNWRUZtUW1kT1ZraFRUVVZIUkVGWFowSlNZMWMxUXpSRWJqWkNOVFl6YW01Vk1tNURWSEZVV1hCMVprdEVRamxDWjA1V1NGSTRSV1JxUWpCTlNFdG5ZMHRDZFdodGVHOWtTRkozWTNwdmRrd3pRbkpoVXpWcVdsaEtNR0ZYTlcxamJVVjFXbTFzYTJJeVJuTmlSMnhvWW0xT2JFeHRPWGxhZVRsNldWZGFiR1JJYkhWYVdGRjJXVE5LYzB3d1drcFNSVGhzVFdwQ1IxbFhkR3hLVkVsM1ZXMDVkbVJEVlhsTlJVNXNZMjVTY0ZwdGJHcFpXRkpzU2xSSmQxRllWakJoUnpsNVlWaFNOVXBVU1hkTmFrRjRUME0xYW1OdGQzZG5XVkZIUTBOelIwRlJWVVpDZDBWQ1FraG5kMlJxUWpCQ1oyZHlRbWRGUmtKUlkzZEJXVnB2WVVoU01HTklUVFpNZVRsM1lUSnJkVmt5Vm5sa1IyeDFXbTVLYUV4dFduQmFSemxvWWtkNGNGbFhOV3BhVXpWMlkyMWpkbU15Um0xYVdGSTFZbTFXTUV3d1drcFNSVGhzVFdwQ1IxbFhkR3hLVkVsM1ZXMDVkbVJEVlhsTlJVNXNZMjVTY0ZwdGJHcFpXRkpzU2xSSmQxRllWakJoUnpsNVlWaFNOVXBVU1hkTmFrRjRUME0xYW1OdVVYZEVVVmxLUzI5YVNXaDJZMDVCVVVWTVFsRkJSR2RuUlVKQlEwb3JMMWxCVDBaaVpFZG9jMFZXWXpsS2VqTkVZVlpxZUZSeVVsQm9TM05NWTNsT01qTkxXWG9yVHpJNGJtRkhSR3RYTkc5cVIwRXZPSEpvY25RNU56aGtUelY0VDFaUlZEWkJhVEJQYm5oUVMzUlBZMUpwVURSMlJIZ3pSMFJrVEZSSE9XbEZNVXhQYkZWWVNHTnNabWRWWkhJNWVVNDNhSFp4VWtOMU1tOUNSbGRTVlVkWFRVNTRNR2R6WjJ4TFkyVnVTbTlEUkdSNVduaDNVWGhVTTBaM1IxQlRhbTFNTnpWRFZrbGxSVk0zVFM5U2RsWXJUVlZGUzNkNGJtMVBMMlIxY1ZCb2RYaElha0ZGY21SeE0xWnpTMGwyWXpVclFtY3JOazUyWkRKek5ERjZVMmgyUTBnMWVEa3phVTlyWmpWVFpUQTBaMlpNTlZveFMwbGtUMGRSUWtSRWVIcEdRbnBVWVVZNFRVNTJVbk5OZDNkcmN6bGtRVVpCV1Rod1JFZHNORXN5TkhOaWRtNTNkWFEzVFVWSWVsSlBha29yUjFGeWVqRmtiRFExVms1aFQyNHZhRm80UTBGek0wRTRkM2cwWW1GSlBTSmRmUS5leUp1YjI1alpTSTZJa05GV25aUVpqZDVRMUZzYUVoRlNtOUhhblZqVTJrNWVqRmpla2RSVEhkSGFGQnlibVJzWlRVM1V6QTlJaXdpZEdsdFpYTjBZVzF3VFhNaU9qRTJOVGs0TXpJeE5qZ3hPRGdzSW1Gd2ExQmhZMnRoWjJWT1lXMWxJam9pWTI5dExtRnVaSEp2YVdRdWEyVjVjM1J2Y21VdVlXNWtjbTlwWkd0bGVYTjBiM0psWkdWdGJ5SXNJbUZ3YTBScFoyVnpkRk5vWVRJMU5pSTZJbVJOTDB4VlNGTkpPVk5yVVdoYVNFaHdVVmRTYm5wS00wMTJka0l5UVU1VFlYVnhXVUZCWWxNeVNtYzlJaXdpWVhCclEyVnlkR2xtYVdOaGRHVkVhV2RsYzNSVGFHRXlOVFlpT2xzaVluTmlOQzlYVVdSaFlVOVhXVU5rTDJvNVQwcHBVWEJuTjJJd2FYZEdaMEZqTDNwNlFURjBRMlozUlQwaVhTd2lZM1J6VUhKdlptbHNaVTFoZEdOb0lqcDBjblZsTENKaVlYTnBZMGx1ZEdWbmNtbDBlU0k2ZEhKMVpYMC5YNFpYMXBtS005OXJocThyNXhUTFlfM0g2MjRCYTZHNXJCazR5R3dsNGtVUnhNRDZEQXcwaEZaVFZpLXc1QmdGV0xWYjVNb2VUMmxUZUw1Tk9vVDY5b01qek4tN3dDcVdGa0w5Xy1ONFpwQXk2aWIxdWs3eG5iN3ZHcnlsb0o0Q3p3bDB5cC12d1BsMDgwdzhVVXU2TjFsTzBJS19BbjFnODFJSVZZZk1qQ0JQejRPZEZxeFh1SHRWMEpXRzk0andFUUJrOXRmeUNMR25wdVhzR3RFUkxzV2U3N2MzYUJzcWY1LVkyNlpfYTBINzJYNUVaRU5fa2FiODJHV2p3Q0dmZVpaT2NzQVVIOENpSDYwMkl5U2ZadHo1Uy1iV09IRTNRZlAtXzZpelpTTG43MTZNZV9VdFZpSlpzckZFZUJDUTVodjctMEhmbUJPUTQ0RzFDS29ZUHdoYXV0aERhdGFZAWeIR20dSr50NYH9fr2gLeUAShXskXlzq1Q6gy8s2HtuGUEAAABxyHzdl1bBSbieJMs2NlTzUAAgd7XmNKs0tMlpq4BQWqji5yuOYO9jafKPRGEhHuUMAD2kAQMDOQEAIFkBAKD0elziSAkrmikjxbDCUkXN20TUZ38cFepjsgG395tU2Yhb06ATz8yBZFSQv4ulX0oGQw4TY1c_X9fr-QV6miJwdl3IB1H-7D8xJrQpKerspNNHuJ6ZHziOoN1OF2l4rc1qnmblblAoYCqycjUMpyuPgZqR7gGkv_r5GexVsx02p3VVqSZhhDkrGKKAuHgiVGuBe7uvoE7NN-Voo3doathG3Fxg-O0KVQXu0glk-EkZszUxDZj6zM03L3gzQBTzQ256fUdHZ3EJw4wvM3yH7OAE5ZThkVMbs9FngGXo6q9zIpFZAVNX6tMxFjGP1oy_NccNtmuGGLeabyE7s01ANIchQwEAAQ';
      const clientDataJSON =
        'eyJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY2hhbGxlbmdlIjoiNmFRMk5Id28weUR0OGZHeExTc05FOXEwcUtNbVhBYk92VXBua0pPLUJCeWRTWThiUmNJRnpDaENfSzN6RTZ5R0ZVQkZ5dS1tem51VDJPUlFRWmVfOGciLCJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIn0';
      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const as = new AndroidSafenetFormat();
      as.config(
        attStmt,
        {
          ...result,
          authData: null,
        } as any,
        {} as any,
        {}
      );

      try {
        const verified = await as.verify();
        t.fail('not come here');
      } catch (err) {
        t.match(err.message, /android-safetynet:Data is not enough*/);
      } finally {
        clock.restore();
      }

      t.end();
    });

    t.test('### result.clientDataJSONHash is null', async (t) => {
      const clock = sinon.useFakeTimers({
        now: dayjs('2022-08-07T00:29:50.000Z').valueOf(),
      });

      const attestationObject =
        'o2NmbXRxYW5kcm9pZC1zYWZldHluZXRnYXR0U3RtdKJjdmVyaDEyNjg1MDIzaHJlc3BvbnNlWRX1ZXlKaGJHY2lPaUpTVXpJMU5pSXNJbmcxWXlJNld5Sk5TVWxHVm1wRFEwSkVObWRCZDBsQ1FXZEpVRUpHTlVaMU0zSlhXamhJTUdGT2JYaEJXVzU0VFVFd1IwTlRjVWRUU1dJelJGRkZRa04zVlVGTlJ6UjRRM3BCU2tKblRsWkNRVmxVUVd4V1ZFMVRjM2RMVVZsRVZsRlJTMFJEU2tkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUmxKNVpGaE9NRWxHVG14amJscHdXVEpXZWsxVVNYZE5RVmxFVmxGUlJFUkRiRWRUVlZKUVNVVkdjMkpIYkdoaWJVNXNZM2xDUjFGVmRFWkpSV3gxWkVkV2VXSnRWakJKUlVZeFpFZG9kbU50YkRCbFUwSkhUVlJCWlVaM01IbE5WRUUwVFVSamQwMUVTVFZOYW1oaFJuY3dlVTE2UVRSTlJHTjNUVVJKTlUxcWFHRk5TRVY0UTNwQlNrSm5UbFpDUVZsVVFXeFdWRTFSYzNkRFVWbEVWbEZSU1VSQlNrNVhWRVZUVFVKQlIwRXhWVVZDZDNkS1ZqSkdjbHBYV25CYVYzaHJUVkpaZDBaQldVUldVVkZMUkVFeFIxTlZVbEJKUlVaellrZHNhR0p0VG14TlVYZDNRMmRaUkZaUlVVeEVRVTVFVmpCamVFZDZRVnBDWjA1V1FrRk5UVVZ0UmpCa1IxWjZaRU0xYUdKdFVubGlNbXhyVEcxT2RtSlVRME5CVTBsM1JGRlpTa3R2V2tsb2RtTk9RVkZGUWtKUlFVUm5aMFZRUVVSRFEwRlJiME5uWjBWQ1FVeGFPVFJRZUVFeVdVNU9aVGxuZDA5VFNTdEtSRmhZTm5Bd2F6RjViRGg0U1haa1IyaFdZa280YlVWaE4yVlBjR1JaVm1wT2FtdFlPR3c1UWxwYVdqUkpTV2xuYkdzMmNTc3dUM3BQTTBwNlNrODVaM1JpV1RSMVZXMWxkVTlyYW1aV1pqaFlhVTgyVTNZNWNHZERiME5IY0ZJeGNGaG5TbVVyZHpjNU5rMHlTVXRoZFVWaWVXTm9hRVJXU1RaUlYxQndlRWR4VEhweVdscEZiak5NYlRkamQzZEhOR0poVkVWbVNEVTJOVk0zYUc1amFVZHFlRlIwUTJabk1IZ3JUbFZyVjNSU2VUaFhhSGxMWkhFek4wcHVNRlkzVTI1NmNVcFlXRmRMZERWUE1uTlFSbWN5Y2xWS1ZFNDRObXBzTWxkSlNUSmhRV05EVEhSTFFqazVaRFkwTkZKcVJEVlhla3hTY1hCbmFVbGhhV1oxVFVkWmJ6WnJWMHh4Y25BMVptVlJSVVIxSzNSd1VGVTRNMWRzVlVkTllpczJkU3Q1YVN0Tk5VbG1MelF4TlVOdU5XMVBWbTVSWVU5NVpXNUhjWFJ6T0RFelkwTkJkMFZCUVdGUFEwRmxkM2RuWjBodlRVTkZSMEV4VldSSlFWRmhUVUpuZDBSQldVdExkMWxDUWtGSVYyVlJTVVpCZWtGSlFtZGFibWRSZDBKQlowbDNSWGRaUkZaU01HeENRWGQzUTJkWlNVdDNXVUpDVVZWSVFYZEZkMFJCV1VSV1VqQlVRVkZJTDBKQlNYZEJSRUZrUW1kT1ZraFJORVZHWjFGVk1rVnBWSEUxVURoWk5XMW1aMVJIYmtWTmJ6WlRUVFpZZDNKQmQwaDNXVVJXVWpCcVFrSm5kMFp2UVZWUVUxZHllRU4zUmxCVVFrSnBVVlp3VkRKWksyaHlUVzFsWTBWM1dFRlpSRlpTTUdaQ1JsVjNWWHBDVW05RksyZFVXVnBNWVVoU01HTklUVFpNZVRsM1lUSnJkVmt5Vm5sa1IyeDFXbTVLYUV4dFduQmFSemxvWWtkNGNGbFhOV3BhVXpWMlkyMWpkbU15Um0xYVdGSTFZbTFXTUV3eVRubGlRemxvWkVoU2JHTXpVWFZaVnpWclkyMDVjRnBETldwaU1qQjFXVE5LYzAxSlNVSkJRVmxKUzNkWlFrSlJWVWhCVVVWRloyWk5kMmRtUVhka1FWbEpTM2RaUWtKUlZVaE5RVXRIWVVkb01HUklRbnBQYVRoMlkwZDBjRXh0VG14amJsSndZbTFhZVZsVE5XMWhWMUoyV1ZkNGMyRlhSblZaTWxWMVlqTktia3d6VG1oYWJWWXdaVmMxYkdSRE9VZFRWVkpRU2xSSmQxSnRSbkphVTFWNVRVWktkbUl6VVd4TmFrSkVXbGhLTUdGWFduQlpNa1l3V2xOVmVVMUZSakZrUjJoMlkyMXNNR1ZUVlhsTlJFbDNUVlJuZFZrelNqQk5TR2RIUTBOelIwRlJWVVpDZWtGQ2FHMTRiMlJJVW5kamVtOTJURE5DY21GVE5XcGFXRW93WVZjMWJXTnRSWFZhYld4cllqSkdjMkpIYkdoaWJVNXNURzA1ZVZwNU9YcFpWMXBzWkVoc2RWcFlVWFpaTTBwelREQmFTbEpGT0d4TmFrSkhXVmQwYkVwVVNYZFZiVGwyWkVOVmVVMUZUbXhqYmxKd1dtMXNhbGxZVW14S1ZFbDNVVmhXTUdGSE9YbGhXRkkxU2xSSmQwMXFRWGhQUXpWcVkyMTNkMFJSV1VwTGIxcEphSFpqVGtGUlJVeENVVUZFWjJkRlFrRkVWblJrTlhkTWF6UjVNVUpNVG1NeWNtRnJRa2Q1WldabGNVVnBlWFl3YmxoNFNGZFdhVlpPT1hFMGNuVnBkM0F5T1dORVlrb3pRMDVPUjNBdmIxVTBPVUZxZG1OblJERmhWVFJIZWt0alkyTnpLemsxV2xaV1RYQnRSRmhGTVd0clVIUmhZVnBEZG04M2JtZHJjVWQ1Y2xGS04ybFpkV1pvTDJ4VVF6VXZaV0ZDZFVWbVRuZHFNVmhtV1ZaUGFWSkNRbTFWYkVwQk9UWTJVbEJXVGpSalZIaDVNa0ZpYlc4NE1HZHJVVzh4YVdkbk0wNVJhV1JKVERkMFNVdGlabE14VDFWeFNsTndXSGhGU0c4NGRHWnBORzFyYTB4SE1rZE9ObFl6WmxKdEswUkZlV1ZCSzBwM05rWlVhVlo1UkUxcFoxZGxlbkV3YUhwdGVreHZRMWcxT0hSeloyb3JXRXB4ZEdOMmFYWTNlRVJGTWpaUFEwdzBVakJZT1dWSWNtOUlaVU5wTkV0dFpEZFVjazFPYTBFMGRUUmFhV0YyUjNCcmJscERaMHRtYzNBdk9IQkZPRTVwWWpkcVkxaEpUbFUxWm1aUWJGazlJaXdpVFVsSlJrdFVRME5DUWtkblFYZEpRa0ZuU1ZCQ1EySTFhVXRxV0RCV1NXMXFZM1Z6TkhkNU5VMUJNRWREVTNGSFUwbGlNMFJSUlVKRGQxVkJUVVpCZUVONlFVcENaMDVXUWtGWlZFRnNWbFJOVWxsM1JrRlpSRlpSVVV0RVFURkhVMVZTVUVsRlJuTmlSMnhvWW0xT2JFMVRhM2RLZDFsRVZsRlJSRVJEUWtkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUmtwMllqTlJaMUV3UldkTVUwSlVUVlJCWlVaM01IaE9la0Y1VFVSRmQwMUVRWGROUkVKaFJuY3dlazVVUVhoTmVrVjVUWHBWTlU1VWJHRk5SelI0UTNwQlNrSm5UbFpDUVZsVVFXeFdWRTFUYzNkTFVWbEVWbEZSUzBSRFNrZFRWVkpRU1VWR2MySkhiR2hpYlU1c1kzbENSMUZWZEVaSlJsSjVaRmhPTUVsR1RteGpibHB3V1RKV2VrMVVTWGROUVZsRVZsRlJSRVJEYkVkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUld4MVpFZFdlV0p0VmpCSlJVWXhaRWRvZG1OdGJEQmxVMEpIVFZSRFEwRlRTWGRFVVZsS1MyOWFTV2gyWTA1QlVVVkNRbEZCUkdkblJWQkJSRU5EUVZGdlEyZG5SVUpCVFVWSWJVWm1ZazU1Y0ZCMWNUazBheXRUVTBOcFZYWllVM1Z0YjJ4WmNFaFpTR2xyVUdGV01tcFJZbUpZZGtkMVNpdDNPSGw0ZWtoSFZWSkdXbEZNWmtOR1ZuSlVXakkyT1dWaWRsa3ljRTVzYUZWVGNFNUtZemRUY0dodmJGTnlPWFJEYW5WSVpFZE1NM1YyUW1Sd2VHRmFhblowWkZaRk5ubHVOVnAyUTNoNWVDOW9RV2QxUldSclpGQjFWa1Z0WkZaRWNqWTBZelk0WkRJNGIya3ZNMWx6Um01SlluRk5iblZZZGpod2NYWkdZWE5IYW1SVVYwWkRNMkYxU2tka2RUSjJOalZ6UWxVMGRsZGpja1ZHWkZscU1FMW5kMDlFTUd4dldVaGlLekI2UzBzNWQzaG1hVnBRVlZZNFNFVmFZa3QzUkZkbU5XcHZkV0ZqU21WWFdqTXlORmRHTVV4SVQycFhjbmhJWjI5RVVVSnBlbk15Y1ZWR1NuWkRUbWx1YzJGRFUwMDFTbE40VVhWc1RVZGtZa1JWVlZOMldUTnVhV3Q2Ym5KNVRuSk9ObVl2VDFKdVptc3lLMHRKZW5SamRESnJUMGxqUTBGM1JVRkJZVTlEUVdWQmQyZG5TR05OUVhOSFFURlZaRVIzVVVWQmQwbENhR3BDVlVKblRsWklVMEZGVkZSQ1RFMUZhMGRDYldWQ1JFRkZRMEZxUVM5TlJEQkhRME56UjBGUlZVWkNkMGxDUm1wR2IyUklVbmRqZW05MlRETkNjbUZUTldwYVdFb3dZVmMxYldOdFJYVmFiV3hyWWpKR2MySkhiR2hpYlU1c1RHMDVlVnA1T1hwWlYxcHNaRWhzZFZwWVVYWk5RakJIUVRGVlpFcFJVVmROUWxGSFEwTnpSMEZSVlVaQ2QwMUNRbWRuY2tKblJVWkNVV05FUVdwQlUwSm5UbFpJVWsxQ1FXWTRSVU5FUVVkQlVVZ3ZRV2RGUVUxQ01FZEJNVlZrUkdkUlYwSkNVVGxLWVhaRlRFRlZPVTFGUjBwQ1YyeFFXbW8yUjNONVdqVjNWRUZtUW1kT1ZraFRUVVZIUkVGWFowSlNZMWMxUXpSRWJqWkNOVFl6YW01Vk1tNURWSEZVV1hCMVprdEVRamxDWjA1V1NGSTRSV1JxUWpCTlNFdG5ZMHRDZFdodGVHOWtTRkozWTNwdmRrd3pRbkpoVXpWcVdsaEtNR0ZYTlcxamJVVjFXbTFzYTJJeVJuTmlSMnhvWW0xT2JFeHRPWGxhZVRsNldWZGFiR1JJYkhWYVdGRjJXVE5LYzB3d1drcFNSVGhzVFdwQ1IxbFhkR3hLVkVsM1ZXMDVkbVJEVlhsTlJVNXNZMjVTY0ZwdGJHcFpXRkpzU2xSSmQxRllWakJoUnpsNVlWaFNOVXBVU1hkTmFrRjRUME0xYW1OdGQzZG5XVkZIUTBOelIwRlJWVVpDZDBWQ1FraG5kMlJxUWpCQ1oyZHlRbWRGUmtKUlkzZEJXVnB2WVVoU01HTklUVFpNZVRsM1lUSnJkVmt5Vm5sa1IyeDFXbTVLYUV4dFduQmFSemxvWWtkNGNGbFhOV3BhVXpWMlkyMWpkbU15Um0xYVdGSTFZbTFXTUV3d1drcFNSVGhzVFdwQ1IxbFhkR3hLVkVsM1ZXMDVkbVJEVlhsTlJVNXNZMjVTY0ZwdGJHcFpXRkpzU2xSSmQxRllWakJoUnpsNVlWaFNOVXBVU1hkTmFrRjRUME0xYW1OdVVYZEVVVmxLUzI5YVNXaDJZMDVCVVVWTVFsRkJSR2RuUlVKQlEwb3JMMWxCVDBaaVpFZG9jMFZXWXpsS2VqTkVZVlpxZUZSeVVsQm9TM05NWTNsT01qTkxXWG9yVHpJNGJtRkhSR3RYTkc5cVIwRXZPSEpvY25RNU56aGtUelY0VDFaUlZEWkJhVEJQYm5oUVMzUlBZMUpwVURSMlJIZ3pSMFJrVEZSSE9XbEZNVXhQYkZWWVNHTnNabWRWWkhJNWVVNDNhSFp4VWtOMU1tOUNSbGRTVlVkWFRVNTRNR2R6WjJ4TFkyVnVTbTlEUkdSNVduaDNVWGhVTTBaM1IxQlRhbTFNTnpWRFZrbGxSVk0zVFM5U2RsWXJUVlZGUzNkNGJtMVBMMlIxY1ZCb2RYaElha0ZGY21SeE0xWnpTMGwyWXpVclFtY3JOazUyWkRKek5ERjZVMmgyUTBnMWVEa3phVTlyWmpWVFpUQTBaMlpNTlZveFMwbGtUMGRSUWtSRWVIcEdRbnBVWVVZNFRVNTJVbk5OZDNkcmN6bGtRVVpCV1Rod1JFZHNORXN5TkhOaWRtNTNkWFEzVFVWSWVsSlBha29yUjFGeWVqRmtiRFExVms1aFQyNHZhRm80UTBGek0wRTRkM2cwWW1GSlBTSmRmUS5leUp1YjI1alpTSTZJa05GV25aUVpqZDVRMUZzYUVoRlNtOUhhblZqVTJrNWVqRmpla2RSVEhkSGFGQnlibVJzWlRVM1V6QTlJaXdpZEdsdFpYTjBZVzF3VFhNaU9qRTJOVGs0TXpJeE5qZ3hPRGdzSW1Gd2ExQmhZMnRoWjJWT1lXMWxJam9pWTI5dExtRnVaSEp2YVdRdWEyVjVjM1J2Y21VdVlXNWtjbTlwWkd0bGVYTjBiM0psWkdWdGJ5SXNJbUZ3YTBScFoyVnpkRk5vWVRJMU5pSTZJbVJOTDB4VlNGTkpPVk5yVVdoYVNFaHdVVmRTYm5wS00wMTJka0l5UVU1VFlYVnhXVUZCWWxNeVNtYzlJaXdpWVhCclEyVnlkR2xtYVdOaGRHVkVhV2RsYzNSVGFHRXlOVFlpT2xzaVluTmlOQzlYVVdSaFlVOVhXVU5rTDJvNVQwcHBVWEJuTjJJd2FYZEdaMEZqTDNwNlFURjBRMlozUlQwaVhTd2lZM1J6VUhKdlptbHNaVTFoZEdOb0lqcDBjblZsTENKaVlYTnBZMGx1ZEdWbmNtbDBlU0k2ZEhKMVpYMC5YNFpYMXBtS005OXJocThyNXhUTFlfM0g2MjRCYTZHNXJCazR5R3dsNGtVUnhNRDZEQXcwaEZaVFZpLXc1QmdGV0xWYjVNb2VUMmxUZUw1Tk9vVDY5b01qek4tN3dDcVdGa0w5Xy1ONFpwQXk2aWIxdWs3eG5iN3ZHcnlsb0o0Q3p3bDB5cC12d1BsMDgwdzhVVXU2TjFsTzBJS19BbjFnODFJSVZZZk1qQ0JQejRPZEZxeFh1SHRWMEpXRzk0andFUUJrOXRmeUNMR25wdVhzR3RFUkxzV2U3N2MzYUJzcWY1LVkyNlpfYTBINzJYNUVaRU5fa2FiODJHV2p3Q0dmZVpaT2NzQVVIOENpSDYwMkl5U2ZadHo1Uy1iV09IRTNRZlAtXzZpelpTTG43MTZNZV9VdFZpSlpzckZFZUJDUTVodjctMEhmbUJPUTQ0RzFDS29ZUHdoYXV0aERhdGFZAWeIR20dSr50NYH9fr2gLeUAShXskXlzq1Q6gy8s2HtuGUEAAABxyHzdl1bBSbieJMs2NlTzUAAgd7XmNKs0tMlpq4BQWqji5yuOYO9jafKPRGEhHuUMAD2kAQMDOQEAIFkBAKD0elziSAkrmikjxbDCUkXN20TUZ38cFepjsgG395tU2Yhb06ATz8yBZFSQv4ulX0oGQw4TY1c_X9fr-QV6miJwdl3IB1H-7D8xJrQpKerspNNHuJ6ZHziOoN1OF2l4rc1qnmblblAoYCqycjUMpyuPgZqR7gGkv_r5GexVsx02p3VVqSZhhDkrGKKAuHgiVGuBe7uvoE7NN-Voo3doathG3Fxg-O0KVQXu0glk-EkZszUxDZj6zM03L3gzQBTzQ256fUdHZ3EJw4wvM3yH7OAE5ZThkVMbs9FngGXo6q9zIpFZAVNX6tMxFjGP1oy_NccNtmuGGLeabyE7s01ANIchQwEAAQ';
      const clientDataJSON =
        'eyJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY2hhbGxlbmdlIjoiNmFRMk5Id28weUR0OGZHeExTc05FOXEwcUtNbVhBYk92VXBua0pPLUJCeWRTWThiUmNJRnpDaENfSzN6RTZ5R0ZVQkZ5dS1tem51VDJPUlFRWmVfOGciLCJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIn0';
      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const as = new AndroidSafenetFormat();
      as.config(
        attStmt,
        {
          ...result,
          clientDataJSONHash: null,
        } as any,
        {} as any,
        {}
      );

      try {
        const verified = await as.verify();
        t.fail('not come here');
      } catch (err) {
        t.match(err.message, /android-safetynet:Data is not enough*/);
      } finally {
        clock.restore();
      }

      t.end();
    });

    t.end();
  });

  t.test('### nonce is not equal', async (t) => {
    const clock = sinon.useFakeTimers({
      now: dayjs('2022-08-14T15:07:00.817Z').valueOf(),
    });

    const attestationObject =
      'o2NmbXRxYW5kcm9pZC1zYWZldHluZXRnYXR0U3RtdKJjdmVyaDEyNjg1MDIzaHJlc3BvbnNlWRX1ZXlKaGJHY2lPaUpTVXpJMU5pSXNJbmcxWXlJNld5Sk5TVWxHVm1wRFEwSkVObWRCZDBsQ1FXZEpVRUpMTkRKVmVXMHdPRWQyTTNCRFZtMXJTa2hqVFVFd1IwTlRjVWRUU1dJelJGRkZRa04zVlVGTlJ6UjRRM3BCU2tKblRsWkNRVmxVUVd4V1ZFMVRjM2RMVVZsRVZsRlJTMFJEU2tkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUmxKNVpGaE9NRWxHVG14amJscHdXVEpXZWsxVVNYZE5RVmxFVmxGUlJFUkRiRWRUVlZKUVNVVkdjMkpIYkdoaWJVNXNZM2xDUjFGVmRFWkpSV3gxWkVkV2VXSnRWakJKUlVZeFpFZG9kbU50YkRCbFUwSkhUVlJCWlVaM01IbE5WRUUwVFZSUmVFNVVRVE5OUkVKaFJuY3dlVTE2UVRSTlZGRjRUbFJCTTAxRVFtRk5TRVY0UTNwQlNrSm5UbFpDUVZsVVFXeFdWRTFSYzNkRFVWbEVWbEZSU1VSQlNrNVhWRVZUVFVKQlIwRXhWVVZDZDNkS1ZqSkdjbHBYV25CYVYzaHJUVkpaZDBaQldVUldVVkZMUkVFeFIxTlZVbEJKUlVaellrZHNhR0p0VG14TlVYZDNRMmRaUkZaUlVVeEVRVTVFVmpCamVFZDZRVnBDWjA1V1FrRk5UVVZ0UmpCa1IxWjZaRU0xYUdKdFVubGlNbXhyVEcxT2RtSlVRME5CVTBsM1JGRlpTa3R2V2tsb2RtTk9RVkZGUWtKUlFVUm5aMFZRUVVSRFEwRlJiME5uWjBWQ1FVNHZaMGhFV1dkcFdrWjFjemxPUVZsYVYybHZVbmRvTVVKU1NHa3lSWE5hT1VsNlNFTXhTVE5YWm1aM2VrVmxWR1J1UjNGb1YwVmxNblpJUnpWUGJYY3ZVakl6WVVFclMwNXNZbTFOTVhSbmFWbHZWVGt2ZWs1U2RXODFiWGhCU21GRU5VZzFUM1ZaV205Wk1tSndjVUZxZDJabk1GbGlWSFJyVkVOTFNtY3hPRVpVTURCc1dXbzFkelZyWWxNdlZHa3ZRMHRQUmpFMlYxQjVVRWhOZVRkeVpraGxabkkwVjFWdWEwOXFMM0oxUW1SNmNVd3dNa3BpWjNaMlRVbFBibkZ5ZUVscGFsQm1TR1Z0T1hsa04xQktSMHRQTkROSlFteFRkM2RQZEdSS05uZENaRTlDYWxsU2VYSjRUbVV3VkROV0x6TktSVTFzY3pSQlRGYzJXR0V4U1hOSWNGRTFNbkZrZUZjNVdUUjFUWFpaTlUxa1dFbHdlREJoYUdSS2RGaDJWR2gyYTJ3NE9ISjFRVEJWVDBWdVNESlJTaXRwWlRJeU5UTk5LMWxLVTIxWE5GZGxZbkJIYjA1Qk9HSlJkemcxUlU4MlJVTkJkMFZCUVdGUFEwRmxkM2RuWjBodlRVTkZSMEV4VldSSlFWRmhUVUpuZDBSQldVdExkMWxDUWtGSVYyVlJTVVpCZWtGSlFtZGFibWRSZDBKQlowbDNSWGRaUkZaU01HeENRWGQzUTJkWlNVdDNXVUpDVVZWSVFYZEZkMFJCV1VSV1VqQlVRVkZJTDBKQlNYZEJSRUZrUW1kT1ZraFJORVZHWjFGVlF6RnVjMnhKTUVWNmNrODFXRzF4VVRNeVIwYzJUMncwWXpOSmQwaDNXVVJXVWpCcVFrSm5kMFp2UVZWUVUxZHllRU4zUmxCVVFrSnBVVlp3VkRKWksyaHlUVzFsWTBWM1dFRlpSRlpTTUdaQ1JsVjNWWHBDVW05RksyZFVXVnBNWVVoU01HTklUVFpNZVRsM1lUSnJkVmt5Vm5sa1IyeDFXbTVLYUV4dFduQmFSemxvWWtkNGNGbFhOV3BhVXpWMlkyMWpkbU15Um0xYVdGSTFZbTFXTUV3eVRubGlRemxvWkVoU2JHTXpVWFZaVnpWclkyMDVjRnBETldwaU1qQjFXVE5LYzAxSlNVSkJRVmxKUzNkWlFrSlJWVWhCVVVWRloyWk5kMmRtUVhka1FWbEpTM2RaUWtKUlZVaE5RVXRIWVVkb01HUklRbnBQYVRoMlkwZDBjRXh0VG14amJsSndZbTFhZVZsVE5XMWhWMUoyV1ZkNGMyRlhSblZaTWxWMVlqTktia3d6VG1oYWJWWXdaVmMxYkdSRE9VZFRWVkpRU2xSSmQxSnRSbkphVTFWNVRVWktkbUl6VVd4TmFrSkVXbGhLTUdGWFduQlpNa1l3V2xOVmVVMUZSakZrUjJoMlkyMXNNR1ZUVlhsTlJFbDNUVlJuZFZrelNqQk5TR2RIUTBOelIwRlJWVVpDZWtGQ2FHMTRiMlJJVW5kamVtOTJURE5DY21GVE5XcGFXRW93WVZjMWJXTnRSWFZhYld4cllqSkdjMkpIYkdoaWJVNXNURzA1ZVZwNU9YcFpWMXBzWkVoc2RWcFlVWFpaTTBwelREQmFTbEpGT0d4TmFrSkhXVmQwYkVwVVNYZFZiVGwyWkVOVmVVMUZUbXhqYmxKd1dtMXNhbGxZVW14S1ZFbDNVVmhXTUdGSE9YbGhXRkkxU2xSSmQwMXFRWGhQUXpWcVkyMTNkMFJSV1VwTGIxcEphSFpqVGtGUlJVeENVVUZFWjJkRlFrRkhVelJ5Y2tsME9XUmhTSFZqWVc5MlpXUk5kVWhtTVZjMk5VVklZaXR1YXpKSlREZEJia2REWm01TGVpdGhaRTFUVGpFMU1XRkJiVGhMWlVGbGFFdDNPVzh6YmxoV1FsQllha0pvWlZkbGRIWTRWVlpUSzNwT1RYQkJlWEYyUm1KUVUzSkpNMEpZYXpOdk4ydFFaelZDU0hkSGFsTTRPV0ZXYjJRd1R5OHpiVE5MTjNWcVdsVldaRlZCWTJjcldERnhZMVZLWTBOM01GRXpiVVJMS3podmNqZFljWFJ6TTJoWmVrVmlOWGQyVERSa01VbGxlWGt6WkU0NU1EZFNTbWN3VWtsdU1DdGlVV2MzUzFsQ0syaFhhVWw1VUdka09HWkxVMGhEVW5ZMGFGbDBaME5vYVhBNFNubEZVa1pxU1hSMVZrRnRRelptTm5ZMlIwVjJjQ3N3T0RFMGMwMXdjelZTWjJaSGVGSmtOMXBsYUdoSVJITm5XRzFSSzJwdk1EQnhTa1k0V1dkaVFYSllaalowVVRoYWIyOXhZM2c0YlV0SWRsZzFWVmx5Ylc0MGJVeGpPV2wwUldsdWQwWldNR052TWpjM09EUTlJaXdpVFVsSlJrdFVRME5DUWtkblFYZEpRa0ZuU1ZCQ1EySTFhVXRxV0RCV1NXMXFZM1Z6TkhkNU5VMUJNRWREVTNGSFUwbGlNMFJSUlVKRGQxVkJUVVpCZUVONlFVcENaMDVXUWtGWlZFRnNWbFJOVWxsM1JrRlpSRlpSVVV0RVFURkhVMVZTVUVsRlJuTmlSMnhvWW0xT2JFMVRhM2RLZDFsRVZsRlJSRVJEUWtkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUmtwMllqTlJaMUV3UldkTVUwSlVUVlJCWlVaM01IaE9la0Y1VFVSRmQwMUVRWGROUkVKaFJuY3dlazVVUVhoTmVrVjVUWHBWTlU1VWJHRk5SelI0UTNwQlNrSm5UbFpDUVZsVVFXeFdWRTFUYzNkTFVWbEVWbEZSUzBSRFNrZFRWVkpRU1VWR2MySkhiR2hpYlU1c1kzbENSMUZWZEVaSlJsSjVaRmhPTUVsR1RteGpibHB3V1RKV2VrMVVTWGROUVZsRVZsRlJSRVJEYkVkVFZWSlFTVVZHYzJKSGJHaGliVTVzWTNsQ1IxRlZkRVpKUld4MVpFZFdlV0p0VmpCSlJVWXhaRWRvZG1OdGJEQmxVMEpIVFZSRFEwRlRTWGRFVVZsS1MyOWFTV2gyWTA1QlVVVkNRbEZCUkdkblJWQkJSRU5EUVZGdlEyZG5SVUpCVFVWSWJVWm1ZazU1Y0ZCMWNUazBheXRUVTBOcFZYWllVM1Z0YjJ4WmNFaFpTR2xyVUdGV01tcFJZbUpZZGtkMVNpdDNPSGw0ZWtoSFZWSkdXbEZNWmtOR1ZuSlVXakkyT1dWaWRsa3ljRTVzYUZWVGNFNUtZemRUY0dodmJGTnlPWFJEYW5WSVpFZE1NM1YyUW1Sd2VHRmFhblowWkZaRk5ubHVOVnAyUTNoNWVDOW9RV2QxUldSclpGQjFWa1Z0WkZaRWNqWTBZelk0WkRJNGIya3ZNMWx6Um01SlluRk5iblZZZGpod2NYWkdZWE5IYW1SVVYwWkRNMkYxU2tka2RUSjJOalZ6UWxVMGRsZGpja1ZHWkZscU1FMW5kMDlFTUd4dldVaGlLekI2UzBzNWQzaG1hVnBRVlZZNFNFVmFZa3QzUkZkbU5XcHZkV0ZqU21WWFdqTXlORmRHTVV4SVQycFhjbmhJWjI5RVVVSnBlbk15Y1ZWR1NuWkRUbWx1YzJGRFUwMDFTbE40VVhWc1RVZGtZa1JWVlZOMldUTnVhV3Q2Ym5KNVRuSk9ObVl2VDFKdVptc3lLMHRKZW5SamRESnJUMGxqUTBGM1JVRkJZVTlEUVdWQmQyZG5TR05OUVhOSFFURlZaRVIzVVVWQmQwbENhR3BDVlVKblRsWklVMEZGVkZSQ1RFMUZhMGRDYldWQ1JFRkZRMEZxUVM5TlJEQkhRME56UjBGUlZVWkNkMGxDUm1wR2IyUklVbmRqZW05MlRETkNjbUZUTldwYVdFb3dZVmMxYldOdFJYVmFiV3hyWWpKR2MySkhiR2hpYlU1c1RHMDVlVnA1T1hwWlYxcHNaRWhzZFZwWVVYWk5RakJIUVRGVlpFcFJVVmROUWxGSFEwTnpSMEZSVlVaQ2QwMUNRbWRuY2tKblJVWkNVV05FUVdwQlUwSm5UbFpJVWsxQ1FXWTRSVU5FUVVkQlVVZ3ZRV2RGUVUxQ01FZEJNVlZrUkdkUlYwSkNVVGxLWVhaRlRFRlZPVTFGUjBwQ1YyeFFXbW8yUjNONVdqVjNWRUZtUW1kT1ZraFRUVVZIUkVGWFowSlNZMWMxUXpSRWJqWkNOVFl6YW01Vk1tNURWSEZVV1hCMVprdEVRamxDWjA1V1NGSTRSV1JxUWpCTlNFdG5ZMHRDZFdodGVHOWtTRkozWTNwdmRrd3pRbkpoVXpWcVdsaEtNR0ZYTlcxamJVVjFXbTFzYTJJeVJuTmlSMnhvWW0xT2JFeHRPWGxhZVRsNldWZGFiR1JJYkhWYVdGRjJXVE5LYzB3d1drcFNSVGhzVFdwQ1IxbFhkR3hLVkVsM1ZXMDVkbVJEVlhsTlJVNXNZMjVTY0ZwdGJHcFpXRkpzU2xSSmQxRllWakJoUnpsNVlWaFNOVXBVU1hkTmFrRjRUME0xYW1OdGQzZG5XVkZIUTBOelIwRlJWVVpDZDBWQ1FraG5kMlJxUWpCQ1oyZHlRbWRGUmtKUlkzZEJXVnB2WVVoU01HTklUVFpNZVRsM1lUSnJkVmt5Vm5sa1IyeDFXbTVLYUV4dFduQmFSemxvWWtkNGNGbFhOV3BhVXpWMlkyMWpkbU15Um0xYVdGSTFZbTFXTUV3d1drcFNSVGhzVFdwQ1IxbFhkR3hLVkVsM1ZXMDVkbVJEVlhsTlJVNXNZMjVTY0ZwdGJHcFpXRkpzU2xSSmQxRllWakJoUnpsNVlWaFNOVXBVU1hkTmFrRjRUME0xYW1OdVVYZEVVVmxLUzI5YVNXaDJZMDVCVVVWTVFsRkJSR2RuUlVKQlEwb3JMMWxCVDBaaVpFZG9jMFZXWXpsS2VqTkVZVlpxZUZSeVVsQm9TM05NWTNsT01qTkxXWG9yVHpJNGJtRkhSR3RYTkc5cVIwRXZPSEpvY25RNU56aGtUelY0VDFaUlZEWkJhVEJQYm5oUVMzUlBZMUpwVURSMlJIZ3pSMFJrVEZSSE9XbEZNVXhQYkZWWVNHTnNabWRWWkhJNWVVNDNhSFp4VWtOMU1tOUNSbGRTVlVkWFRVNTRNR2R6WjJ4TFkyVnVTbTlEUkdSNVduaDNVWGhVTTBaM1IxQlRhbTFNTnpWRFZrbGxSVk0zVFM5U2RsWXJUVlZGUzNkNGJtMVBMMlIxY1ZCb2RYaElha0ZGY21SeE0xWnpTMGwyWXpVclFtY3JOazUyWkRKek5ERjZVMmgyUTBnMWVEa3phVTlyWmpWVFpUQTBaMlpNTlZveFMwbGtUMGRSUWtSRWVIcEdRbnBVWVVZNFRVNTJVbk5OZDNkcmN6bGtRVVpCV1Rod1JFZHNORXN5TkhOaWRtNTNkWFEzVFVWSWVsSlBha29yUjFGeWVqRmtiRFExVms1aFQyNHZhRm80UTBGek0wRTRkM2cwWW1GSlBTSmRmUS5leUp1YjI1alpTSTZJazVOUW13MmFUWmhja1pWZFRWSFIwWnlOV2M0ZG1zd2VtMW9SR1VyVm1VeVUwOHlWMDlrZW1ZNWVUZzlJaXdpZEdsdFpYTjBZVzF3VFhNaU9qRTJOakEwT0RrMk1qQTRNVGNzSW1Gd2ExQmhZMnRoWjJWT1lXMWxJam9pWTI5dExtRnVaSEp2YVdRdWEyVjVjM1J2Y21VdVlXNWtjbTlwWkd0bGVYTjBiM0psWkdWdGJ5SXNJbUZ3YTBScFoyVnpkRk5vWVRJMU5pSTZJbVJOTDB4VlNGTkpPVk5yVVdoYVNFaHdVVmRTYm5wS00wMTJka0l5UVU1VFlYVnhXVUZCWWxNeVNtYzlJaXdpWVhCclEyVnlkR2xtYVdOaGRHVkVhV2RsYzNSVGFHRXlOVFlpT2xzaVluTmlOQzlYVVdSaFlVOVhXVU5rTDJvNVQwcHBVWEJuTjJJd2FYZEdaMEZqTDNwNlFURjBRMlozUlQwaVhTd2lZM1J6VUhKdlptbHNaVTFoZEdOb0lqcDBjblZsTENKaVlYTnBZMGx1ZEdWbmNtbDBlU0k2ZEhKMVpYMC5rQUFsRHN6dlBTczFYWFZUMUh4UnZ5VE1aYk5UYVh5VDVSS1BEM2JXeHRudlVEdG9HR2l2Qmp4WmxfM1dDWFM4dUtELVdKbHRyZ2RCVXFiRS1wdkFmWGFDRlB6MkhsMmhVNXFwVlFkQnRIc1VvbnFiX3dGa3k3SGd4SUIzbEVlT21YSkRFbUp5SFRPMkk0czJyQmdzMzY1TUFITndTRWlSWnpUSmluWHM2UnVUYm50M1FLWUh3NE41TVBKNHNVOExOVkFSZXZSbWc4aGZQUFNBTXlLYXpCUGtXVkhBc21FckZLaVpQUTRxRjhuVkN0Z0FuUGFfcUd3MVlfT2tkSnQza0V1ZVN1dmxlektTVUFiZHhsUHdyTm5yNlQ0TFU5SXVkdnlsMTR5QzZ3NFFHbHQ3V2RxcEQ3UlpXTHFocjFNWVhFbjFEN3RZWGZDMEVQVUt1MTFQMlFoYXV0aERhdGFZAWeIR20dSr50NYH9fr2gLeUAShXskXlzq1Q6gy8s2HtuGUEAAACByHzdl1bBSbieJMs2NlTzUAAgssfzSL__gv8zNKq6JRed4ETsQNoEGXvCcj78X3WTSiekAQMDOQEAIFkBAOqUM-IVEg7pruUU33DHEWG5C7pAWMZzuLcNXX0GO_-DThDq1DBcyByMhyPPsjEbR322Dps81ZjrpY0gm8jQq6YBW918lC-qFJLqUdWH_jMhESKwKlmFdQcbh3lnfStoft8iQjJ7TF-G3et7RNBcJQx0lFy3jJDnX94XHnhkeb4ZquUBVRFBQB_0GTIPaJWHBJNIh3ISjcIvv-IE1M9QmvmzEmpurZAXtw0aI2JjZa6yIv34rI3ec35whjgrYklbZjFQBzCB1DLOXOVcuxm6gIvRAWgplYgmxtdao_ahgifH56D9SaJQFBlrnofWl2EUW9FNLavSgz09TeThkLHODuchQwEAAQ';
    const clientDataJSON =
      'eyJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY2hhbGxlbmdlIjoibjBJSnBkWkZHdzE0T2VqRmUwOVQ0UlVQbmgzV3pucFhMR3RKUmd0MGFtZE4tcW9WWUU4a0NKUW5qb2JkbWNIcjlmbHhPU1RCbGRLRTA5TUNlbFJPa2ciLCJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIn0';
    const { attStmt, result } = await parse(attestationObject, clientDataJSON);

    const as = new AndroidSafenetFormat();
    as.config(attStmt, result as any, {} as any, {});

    try {
      const verified = await as.verify();
      t.fail('not come here');
    } catch (err) {
      t.match(
        err.message,
        /android-safetynet:nonce is not equal to Base64 encoding of the SHA-256 hash of the concatenation of authenticatorData and clientDataHash*/
      );
    } finally {
      clock.restore();
    }

    t.end();
  });

  t.end();
});
