import { test } from 'tap';
import TpmFormat from '../../../../src/attestation/format/tpm/tpm';
import crypto from 'crypto';
import str2ab from 'str2ab';
import parseCoseKey from 'parse-cosekey';
import cbor from 'cbor';
import { FslTpmFormatVerifyResultOthers } from '../../../../src/type';

const parse = async (attestationObject: string, clientDataJSON: string) => {
  const cBuf: Buffer = str2ab.arraybuffer2buffer(str2ab.base64url2arraybuffer(clientDataJSON));
  const clientDataJSONHash: Buffer = crypto.createHash('sha256').update(cBuf).digest();

  const decodedAO = cbor.decodeAllSync(str2ab.arraybuffer2buffer(str2ab.base64url2arraybuffer(attestationObject)));
  const attStmt = decodedAO[0]['attStmt'];
  const authData = decodedAO[0]['authData'];
  const attestedCredentialData: Buffer = authData.slice(32 + 1 + 4);
  const credentialIdLength: Buffer = attestedCredentialData.slice(16, 16 + 2);
  const credentialIdLengthNumber: number = credentialIdLength.readUInt16BE();
  const credentialId: Buffer = attestedCredentialData.slice(16 + 2, 16 + 2 + credentialIdLengthNumber);
  const credentialPublicKey: Buffer = attestedCredentialData.slice(16 + 2 + credentialIdLengthNumber);
  const decodedCredentialPublicKey: any[] = cbor.decodeAllSync(credentialPublicKey);
  const coseCredentialPublicKey = decodedCredentialPublicKey[0];
  const jwkResult = parseCoseKey.KeyParser.cose2jwk(coseCredentialPublicKey);
  const alg = Number(coseCredentialPublicKey.get(3));
  const pem: string = await parseCoseKey.KeyParser.cose2pem(coseCredentialPublicKey);

  const rpIdHash: Buffer = authData.slice(0, 32);

  return {
    attStmt,
    result: {
      attestationObject: decodedAO[0],
      fmt: decodedAO[0]['fmt'],
      authData,
      clientDataJSONHash,
      pem,
      jwk: jwkResult,
      credentialId: {
        buffer: credentialId,
        base64url: str2ab.buffer2base64url(credentialId),
      },
      alg,
      rpIdHash,
      coseCredentialPublicKey,
    },
  };
};

// TODO add test cases
test('# TpmFormat', (t) => {
  t.test('## getName', (t) => {
    t.test('### tpm', (t) => {
      const name = TpmFormat.getName();

      t.equal(name, 'tpm');
      t.end();
    });

    t.end();
  });

  t.test('## config', (t) => {
    t.test('### config', (t) => {
      const none = new TpmFormat();
      none.config(
        {
          attStmt: 'value',
        } as any,
        {
          result: 'value',
        } as any,
        {
          expectation: 'value',
        } as any,
        {
          configure: 'value',
        } as any
      );

      t.same(none.attStmt, { attStmt: 'value' });
      t.same(none.result, { result: 'value' });
      t.same(none.expectation, { expectation: 'value' });
      t.same(none.configure, { configure: 'value' });
      t.end();
    });

    t.end();
  });

  t.test('## verify', (t) => {
    t.test('### valid', async (t) => {
      const attestationObject =
        'o2NmbXRjdHBtZ2F0dFN0bXSmY2FsZzn__mNzaWdZAQAc4Y6uEaGpi8S3THzR8RlV8gxvIJPcXJppNk2SVhCpxQVf6is0qMk5tRK4ChTB7LZVn3_GbpMVXT4ggZhAQld9aiCAAVyywE6LGh-nGuBzDNJyystxkB51wpBuWU65s0BxtONK2bWvX1nMgUzcyIYyiyfy0Krmn4aOnCF-Idsnz555ezrRp8WjcvTLF0SeagX4s16bTWOaBYqNpDNfYDkOq1aiRNpwzyZpexhRbnszkFp2yq71cOP1U2LB-ShWeiWXIr3LOf5fcjXLVfBqKQuwxM4Fmz1XZ34YeI-xSn1duzLQ0ugnHf9X8XJqr6R340PyT9zYCD_X6eBAgPTyCQzEY3ZlcmMyLjBjeDVjglkFuzCCBbcwggOfoAMCAQICEDro7V5QKkXugEpqXYSheWMwDQYJKoZIhvcNAQELBQAwQTE_MD0GA1UEAxM2TkNVLUFNRC1LRVlJRC04QTA1NzhDRjU2MTQ2RkVBMzk5QUY5MDNGQjVCMEFDMzZFQjI3ODZBMB4XDTIyMDIwNzE3MjQzMVoXDTI3MDYxMDE4NTIxOFowADCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAJWJcBlHvdsGoI9TqkvPgiA--a_GgdPEAPrdtZwklWkABId8rfaTlNKSveR-G-SR13AkccEPVzsvMCDTrhzca7mAZoqr4O2YX0dbwm8EKEkvzc6Wvliil3-EQ0XrzckHdDkHO4goHdT9ap7AA-s-cX2tmgtoyIOLTczoy2Azs1vzqtRGpsWeVpGS5_9eZMX5dsI3TPaQyhZY1OLnAMSySQk4Dz0Hv3pfA9B6QijEawMOn0qeuaLediJQLmLvNT_PXphkKE0qUTt7_PUvRZl29uI7aRGt-UjkAYs6YFLaT6dqnU-9nXjsY1Du8k8yUU_PrL-OjKSwvY84bfyNyqGfBmMCAwEAAaOCAeowggHmMA4GA1UdDwEB_wQEAwIHgDAMBgNVHRMBAf8EAjAAMG0GA1UdIAEB_wRjMGEwXwYJKwYBBAGCNxUfMFIwUAYIKwYBBQUHAgIwRB5CAFQAQwBQAEEAIAAgAFQAcgB1AHMAdABlAGQAIAAgAFAAbABhAHQAZgBvAHIAbQAgACAASQBkAGUAbgB0AGkAdAB5MBAGA1UdJQQJMAcGBWeBBQgDMFAGA1UdEQEB_wRGMESkQjBAMRYwFAYFZ4EFAgEMC2lkOjQxNEQ0NDAwMQ4wDAYFZ4EFAgIMA0FNRDEWMBQGBWeBBQIDDAtpZDowMDAzMDAwMTAfBgNVHSMEGDAWgBS5sZO0vZWinFrRYD-ePZLA799qMTAdBgNVHQ4EFgQUmy2Muo_fQZp01vcfSXRlP9LQ5l4wgbIGCCsGAQUFBwEBBIGlMIGiMIGfBggrBgEFBQcwAoaBkmh0dHA6Ly9hemNzcHJvZG5jdWFpa3B1Ymxpc2guYmxvYi5jb3JlLndpbmRvd3MubmV0L25jdS1hbWQta2V5aWQtOGEwNTc4Y2Y1NjE0NmZlYTM5OWFmOTAzZmI1YjBhYzM2ZWIyNzg2YS81NDAwMWIyYy1hNmU2LTRmMTYtOWFjNS0wYzZiYmFhOTRjOGMuY2VyMA0GCSqGSIb3DQEBCwUAA4ICAQBjLdWVZ0eBzEVdT1RAVUxyvhmlEQFPxxzzj9fFafB9V9YEZwH2GJ1iOpMjY1TKzkJ27kI4waiA1E5DNY0agngHNBaedvqdFksZU28XfaCtNkQbvR_FOBqtr-MZNfTERfivLTHXgxCALJgL_0FbmTeiJw9vcIvrXwN3y17SG-T7mlzIgWsBPULY57JjBTRaIIcDMysfPi4PQqkneslAXRT--Q0NkV6pG1YTDZayBN0EPnsOXMB2ICPfnJ7ipUjAOiyGa_Go8GsNLlccYi7nS8YvY2SnfjyjQRfVChbAmEUpaWYWk8yZ8TkyVXUYmruPQNfF_V5GNj2wUZPI_BjJ7Es2m1Z7IPDpoMuJiagZv13enjYy6jNygLN33hpB8tpK6uP3W8UHjoN3izI8GpsXwVkiNvZBiYEi1nbZAQSwREr10LBj5XAT3sQ8Q05iNEW6oOW2o_i5Zb_yeMsfyB4C9aM3u-lTaFIWiV7MRNXYBBUorg1dtYnSuVy2BvO00vHNOsXGl_kLaAOn7UNTJfdpXHlBQyDrsp9R4m8N1pJLz6stOQW9cEGYxkSNnhFu-_nixVOFaYzoWCkMhAD9IXRG2vJMuXwD8vBrzcnzJ3UjbFoUGn1kRQXoBRLKgiNfRTUdAhD8Mx7RYNqMDGUMbhTgbMm_A8ZkOh1onCJuoI5SY7G0TVkG7zCCBuswggTToAMCAQICEzMAAAYzhDtjWMyMW-wAAAAABjMwDQYJKoZIhvcNAQELBQAwgYwxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpXYXNoaW5ndG9uMRAwDgYDVQQHEwdSZWRtb25kMR4wHAYDVQQKExVNaWNyb3NvZnQgQ29ycG9yYXRpb24xNjA0BgNVBAMTLU1pY3Jvc29mdCBUUE0gUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkgMjAxNDAeFw0yMTA2MTAxODUyMThaFw0yNzA2MTAxODUyMThaMEExPzA9BgNVBAMTNk5DVS1BTUQtS0VZSUQtOEEwNTc4Q0Y1NjE0NkZFQTM5OUFGOTAzRkI1QjBBQzM2RUIyNzg2QTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAMtiiRvBQra6Yu-Mfcuo4eRfSf5JQfE3mCKDlSOQFGmdbYeIExndRMrxqhCSeN0Sy10v0XIRK7yCikCh2tZHlHpdPnE1M7RXttLRus6EBffEfWH-JPsSKZn1z9KFgOCBjrAqP7rwX4P_WGyNwdWHSfSVw8KCm67bhN6IoVlodg3EV9sOmxU9AxcfYsfSosQVOEhBeYo8MxRB_dULhrqZKETRJN5403TOn6b0VDwtygjBMaoFks7Gpaj22OJ8YhMtD2ZbNnkkgHAL6rdwIQd0ksR7rdrVFKXIuhjLeMHYBs3h6CctyaPVnqfXuNpIKzcBfIT8sqFUsN70dnGVedfA1PJhoLZ6pL8uv_R_TbV9F2QxZ7LHffrnR7x7p3N9bB7gz4uIR5Q7mwUayd8fZ3i4BLEsCfb6awnNUAkSn1-YFg6S1fmR5PuHi1unkMzx52hbtyakXDS9u63QGCAlo8G3n7IDZD30hzQQhLwOIe_cwVxdfCyornEX7AKYAlMDwgyXqrnoQs34M4unXrIAkIcqqhhc4aObrCLVCPn7Ho44EHlNt8wgWPA4JNK_PcEuIXyaYt4IMEgz4k9YCKi8F4HNIObIkTDxk7OiddC3fRdcWeXtVAGXlGsCJixy8bpeLcIgyVIyin2FtNU6GTEr7za6GgQYjTJG9P1PZV0UoMrd8_vHAgMBAAGjggGOMIIBijAOBgNVHQ8BAf8EBAMCAoQwGwYDVR0lBBQwEgYJKwYBBAGCNxUkBgVngQUIAzAWBgNVHSAEDzANMAsGCSsGAQQBgjcVHzASBgNVHRMBAf8ECDAGAQH_AgEAMB0GA1UdDgQWBBS5sZO0vZWinFrRYD-ePZLA799qMTAfBgNVHSMEGDAWgBR6jArOL0hiF-KU0a5VwVLscXSkVjBwBgNVHR8EaTBnMGWgY6Bhhl9odHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20vcGtpb3BzL2NybC9NaWNyb3NvZnQlMjBUUE0lMjBSb290JTIwQ2VydGlmaWNhdGUlMjBBdXRob3JpdHklMjAyMDE0LmNybDB9BggrBgEFBQcBAQRxMG8wbQYIKwYBBQUHMAKGYWh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9wa2lvcHMvY2VydHMvTWljcm9zb2Z0JTIwVFBNJTIwUm9vdCUyMENlcnRpZmljYXRlJTIwQXV0aG9yaXR5JTIwMjAxNC5jcnQwDQYJKoZIhvcNAQELBQADggIBAHY7WQQfcEZx9Auozwthy4DXsd3o_HrxqWlai_W7Hz8ZLuWmiTcPSRRzcHJyKWvVXn7k57kyI9Mn-diMRwOzGMkA2uPTQhbQ4viFDoo35UaI6Cat-oa9TzQ24ayhdeGBlpiOdy7MLfHn_pwPnD8N4xxWikCEtQtPDqLQ8MqFz85U2wJM3WkAM6Lw0qGoeciDt0CRbCs_cPrOdBUCi0gmDNh9ykqCpvYET3c6kOUHBV_afXslRerit2-N43GPLP9nM_5fQ3f_M_AUQmU0zXXpBwmGqy5iGia_BCs8QfVZ2XHnVoIPTn-vZ8gKI1YEFckb3O6O-zh87PnhuhW-ttI4tm9orXVl5LXBniTt_amhmV6Y0mOv4HbQuBCYBQZSM0mx9vu4WEuJkLNm3mUPxhmc2k9ac1fzD5fVNG1drk_4S_F_tQuyWsD5pg-cgnOMc4IHWjwsUrdM6815EnIkXBOkUefT_RwFukAuSiPgKZI3xsxguB22PTkvYgAz2Oerv21RY3cH9rvihblLnAhTco9UMLsr2uyljU3hFuaoQgIeO1HL9stJ50nR7gOCt5am5PHv1H9zVuTUdZsgPndYSOor8c98hCYxEyGkGeIDSecMjKb8lZ2GdixFUhYU6GkVJdfRFVidx2j9f_8faPSwwr56rop5PqquW470jwYdI_qE1D6GZ3B1YkFyZWFZATYAAQALAAYEcgAgnf_L82w4OuaZ-5ho3G3LidcVOIS-KAOSLBJBWL-tIq4AEAAQCAAAAAAAAQDOHY3XwC6PgKLX6N39Al6zP5v_ISOHP2oOZQQtBlY0lnpu79-5JL6fa5ntSsUSZL9JJTAJGCpw2hmGahPQATWNFswVLnslcn2g89cUkU82Eg4DJtW-ArLprmLo9Q53GiHJFtU2cqXFU6QkDWxXhswIs3rM-u6nOPCFjUJ3sj3Nbf9s3JtCE7DqofXi5fEdNMFIk9x-rMpZwMR45itb3hh0CXrDN9zZ1vnJszfcvkPtJBs7MlzfxF_pyrx92z3I0Wf7eRVVbfpj4LKL4IEn8yIrJXp-ROZIP9dQBNmuJ8_ao7jMsVt9Zl-WbwWeqxIx13ZvgTO0xvX_Vr-7LK96KfQ5aGNlcnRJbmZvWKH_VENHgBcAIgAL-NYSfwfy5hKcW4hWT2TiFBdgPIFEp7SqMR8Oyouy0tYAFAXMY6LVU2-C93d1RpcY01e6FDfHAAAAAPZ9WEO-WcZzpKq35AE847UBjyKiiwAiAAtTEaxCM1z69kvpqTqEPaA2moo_JmomCopSZvzX6QaHbwAiAAt0kOPLyV4VuXM7V8WLQdYx1U_zgGiBd-n85Mwc5ACAm2hhdXRoRGF0YVkBZ4hHbR1KvnQ1gf1-vaAt5QBKFeyReXOrVDqDLyzYe24ZRQAAAAAImHBYytxLgbbhMN5Q3L6WACD3NeqCnqpuoqEFn-n7u3l4B2Mb6t7iXPEAYZFZrP6dH6QBAwM5AQAgWQEAzh2N18Auj4Ci1-jd_QJesz-b_yEjhz9qDmUELQZWNJZ6bu_fuSS-n2uZ7UrFEmS_SSUwCRgqcNoZhmoT0AE1jRbMFS57JXJ9oPPXFJFPNhIOAybVvgKy6a5i6PUOdxohyRbVNnKlxVOkJA1sV4bMCLN6zPrupzjwhY1Cd7I9zW3_bNybQhOw6qH14uXxHTTBSJPcfqzKWcDEeOYrW94YdAl6wzfc2db5ybM33L5D7SQbOzJc38Rf6cq8fds9yNFn-3kVVW36Y-Cyi-CBJ_MiKyV6fkTmSD_XUATZrifP2qO4zLFbfWZflm8FnqsSMdd2b4EztMb1_1a_uyyvein0OSFDAQAB';
      const clientDataJSON =
        'eyJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIiwiY2hhbGxlbmdlIjoicFN3QV90TWxiUE1JNmxEY3FkR3ZIeWo1TC1USG5DQlhScFlid294YlBuUC1EZWp5UkNSMmpuTHE5dTZ6N2NwSGFDdVVzc1UzUFJySko5T1NaeHZuX0EiLCJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY3Jvc3NPcmlnaW4iOmZhbHNlfQ';

      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const tf = new TpmFormat();
      tf.config(attStmt, result as any, {} as any, {});

      const verified = await tf.verify();

      t.ok(verified.isValid);
      t.same(verified.attestationStatementAlg, -65535);
      t.notSame(verified.attestationStatementSig, null);
      t.notSame(verified.attestationStatementX5c, []);
      t.ok(verified.isValidSignature);
      t.same(verified.attestationType, ['AttCA']);
      t.notSame(verified.attestationTrustPath, null);
      t.ok(verified.isValidCertificateChain);
      t.notSame(verified.others, null);
      t.equal(verified.others?.attestationFormat, 'tpm');
      t.notSame((verified.others as FslTpmFormatVerifyResultOthers).pubArea, null);
      t.notSame((verified.others as FslTpmFormatVerifyResultOthers).certInfo, null);
      t.notSame((verified.others as FslTpmFormatVerifyResultOthers).tpmManufacturer, null);
      t.notSame((verified.others as FslTpmFormatVerifyResultOthers).tpmPartNumber, null);
      t.notSame((verified.others as FslTpmFormatVerifyResultOthers).tpmFirmwareVersion, null);
      t.same((verified.others as FslTpmFormatVerifyResultOthers).ocsp, []);

      t.end();
    });

    t.test('### ver is not 2.0', async (t) => {
      const attestationObject =
        'o2NmbXRjdHBtZ2F0dFN0bXSmY2FsZzn__mNzaWdZAQAc4Y6uEaGpi8S3THzR8RlV8gxvIJPcXJppNk2SVhCpxQVf6is0qMk5tRK4ChTB7LZVn3_GbpMVXT4ggZhAQld9aiCAAVyywE6LGh-nGuBzDNJyystxkB51wpBuWU65s0BxtONK2bWvX1nMgUzcyIYyiyfy0Krmn4aOnCF-Idsnz555ezrRp8WjcvTLF0SeagX4s16bTWOaBYqNpDNfYDkOq1aiRNpwzyZpexhRbnszkFp2yq71cOP1U2LB-ShWeiWXIr3LOf5fcjXLVfBqKQuwxM4Fmz1XZ34YeI-xSn1duzLQ0ugnHf9X8XJqr6R340PyT9zYCD_X6eBAgPTyCQzEY3ZlcmMyLjBjeDVjglkFuzCCBbcwggOfoAMCAQICEDro7V5QKkXugEpqXYSheWMwDQYJKoZIhvcNAQELBQAwQTE_MD0GA1UEAxM2TkNVLUFNRC1LRVlJRC04QTA1NzhDRjU2MTQ2RkVBMzk5QUY5MDNGQjVCMEFDMzZFQjI3ODZBMB4XDTIyMDIwNzE3MjQzMVoXDTI3MDYxMDE4NTIxOFowADCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAJWJcBlHvdsGoI9TqkvPgiA--a_GgdPEAPrdtZwklWkABId8rfaTlNKSveR-G-SR13AkccEPVzsvMCDTrhzca7mAZoqr4O2YX0dbwm8EKEkvzc6Wvliil3-EQ0XrzckHdDkHO4goHdT9ap7AA-s-cX2tmgtoyIOLTczoy2Azs1vzqtRGpsWeVpGS5_9eZMX5dsI3TPaQyhZY1OLnAMSySQk4Dz0Hv3pfA9B6QijEawMOn0qeuaLediJQLmLvNT_PXphkKE0qUTt7_PUvRZl29uI7aRGt-UjkAYs6YFLaT6dqnU-9nXjsY1Du8k8yUU_PrL-OjKSwvY84bfyNyqGfBmMCAwEAAaOCAeowggHmMA4GA1UdDwEB_wQEAwIHgDAMBgNVHRMBAf8EAjAAMG0GA1UdIAEB_wRjMGEwXwYJKwYBBAGCNxUfMFIwUAYIKwYBBQUHAgIwRB5CAFQAQwBQAEEAIAAgAFQAcgB1AHMAdABlAGQAIAAgAFAAbABhAHQAZgBvAHIAbQAgACAASQBkAGUAbgB0AGkAdAB5MBAGA1UdJQQJMAcGBWeBBQgDMFAGA1UdEQEB_wRGMESkQjBAMRYwFAYFZ4EFAgEMC2lkOjQxNEQ0NDAwMQ4wDAYFZ4EFAgIMA0FNRDEWMBQGBWeBBQIDDAtpZDowMDAzMDAwMTAfBgNVHSMEGDAWgBS5sZO0vZWinFrRYD-ePZLA799qMTAdBgNVHQ4EFgQUmy2Muo_fQZp01vcfSXRlP9LQ5l4wgbIGCCsGAQUFBwEBBIGlMIGiMIGfBggrBgEFBQcwAoaBkmh0dHA6Ly9hemNzcHJvZG5jdWFpa3B1Ymxpc2guYmxvYi5jb3JlLndpbmRvd3MubmV0L25jdS1hbWQta2V5aWQtOGEwNTc4Y2Y1NjE0NmZlYTM5OWFmOTAzZmI1YjBhYzM2ZWIyNzg2YS81NDAwMWIyYy1hNmU2LTRmMTYtOWFjNS0wYzZiYmFhOTRjOGMuY2VyMA0GCSqGSIb3DQEBCwUAA4ICAQBjLdWVZ0eBzEVdT1RAVUxyvhmlEQFPxxzzj9fFafB9V9YEZwH2GJ1iOpMjY1TKzkJ27kI4waiA1E5DNY0agngHNBaedvqdFksZU28XfaCtNkQbvR_FOBqtr-MZNfTERfivLTHXgxCALJgL_0FbmTeiJw9vcIvrXwN3y17SG-T7mlzIgWsBPULY57JjBTRaIIcDMysfPi4PQqkneslAXRT--Q0NkV6pG1YTDZayBN0EPnsOXMB2ICPfnJ7ipUjAOiyGa_Go8GsNLlccYi7nS8YvY2SnfjyjQRfVChbAmEUpaWYWk8yZ8TkyVXUYmruPQNfF_V5GNj2wUZPI_BjJ7Es2m1Z7IPDpoMuJiagZv13enjYy6jNygLN33hpB8tpK6uP3W8UHjoN3izI8GpsXwVkiNvZBiYEi1nbZAQSwREr10LBj5XAT3sQ8Q05iNEW6oOW2o_i5Zb_yeMsfyB4C9aM3u-lTaFIWiV7MRNXYBBUorg1dtYnSuVy2BvO00vHNOsXGl_kLaAOn7UNTJfdpXHlBQyDrsp9R4m8N1pJLz6stOQW9cEGYxkSNnhFu-_nixVOFaYzoWCkMhAD9IXRG2vJMuXwD8vBrzcnzJ3UjbFoUGn1kRQXoBRLKgiNfRTUdAhD8Mx7RYNqMDGUMbhTgbMm_A8ZkOh1onCJuoI5SY7G0TVkG7zCCBuswggTToAMCAQICEzMAAAYzhDtjWMyMW-wAAAAABjMwDQYJKoZIhvcNAQELBQAwgYwxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpXYXNoaW5ndG9uMRAwDgYDVQQHEwdSZWRtb25kMR4wHAYDVQQKExVNaWNyb3NvZnQgQ29ycG9yYXRpb24xNjA0BgNVBAMTLU1pY3Jvc29mdCBUUE0gUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkgMjAxNDAeFw0yMTA2MTAxODUyMThaFw0yNzA2MTAxODUyMThaMEExPzA9BgNVBAMTNk5DVS1BTUQtS0VZSUQtOEEwNTc4Q0Y1NjE0NkZFQTM5OUFGOTAzRkI1QjBBQzM2RUIyNzg2QTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAMtiiRvBQra6Yu-Mfcuo4eRfSf5JQfE3mCKDlSOQFGmdbYeIExndRMrxqhCSeN0Sy10v0XIRK7yCikCh2tZHlHpdPnE1M7RXttLRus6EBffEfWH-JPsSKZn1z9KFgOCBjrAqP7rwX4P_WGyNwdWHSfSVw8KCm67bhN6IoVlodg3EV9sOmxU9AxcfYsfSosQVOEhBeYo8MxRB_dULhrqZKETRJN5403TOn6b0VDwtygjBMaoFks7Gpaj22OJ8YhMtD2ZbNnkkgHAL6rdwIQd0ksR7rdrVFKXIuhjLeMHYBs3h6CctyaPVnqfXuNpIKzcBfIT8sqFUsN70dnGVedfA1PJhoLZ6pL8uv_R_TbV9F2QxZ7LHffrnR7x7p3N9bB7gz4uIR5Q7mwUayd8fZ3i4BLEsCfb6awnNUAkSn1-YFg6S1fmR5PuHi1unkMzx52hbtyakXDS9u63QGCAlo8G3n7IDZD30hzQQhLwOIe_cwVxdfCyornEX7AKYAlMDwgyXqrnoQs34M4unXrIAkIcqqhhc4aObrCLVCPn7Ho44EHlNt8wgWPA4JNK_PcEuIXyaYt4IMEgz4k9YCKi8F4HNIObIkTDxk7OiddC3fRdcWeXtVAGXlGsCJixy8bpeLcIgyVIyin2FtNU6GTEr7za6GgQYjTJG9P1PZV0UoMrd8_vHAgMBAAGjggGOMIIBijAOBgNVHQ8BAf8EBAMCAoQwGwYDVR0lBBQwEgYJKwYBBAGCNxUkBgVngQUIAzAWBgNVHSAEDzANMAsGCSsGAQQBgjcVHzASBgNVHRMBAf8ECDAGAQH_AgEAMB0GA1UdDgQWBBS5sZO0vZWinFrRYD-ePZLA799qMTAfBgNVHSMEGDAWgBR6jArOL0hiF-KU0a5VwVLscXSkVjBwBgNVHR8EaTBnMGWgY6Bhhl9odHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20vcGtpb3BzL2NybC9NaWNyb3NvZnQlMjBUUE0lMjBSb290JTIwQ2VydGlmaWNhdGUlMjBBdXRob3JpdHklMjAyMDE0LmNybDB9BggrBgEFBQcBAQRxMG8wbQYIKwYBBQUHMAKGYWh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9wa2lvcHMvY2VydHMvTWljcm9zb2Z0JTIwVFBNJTIwUm9vdCUyMENlcnRpZmljYXRlJTIwQXV0aG9yaXR5JTIwMjAxNC5jcnQwDQYJKoZIhvcNAQELBQADggIBAHY7WQQfcEZx9Auozwthy4DXsd3o_HrxqWlai_W7Hz8ZLuWmiTcPSRRzcHJyKWvVXn7k57kyI9Mn-diMRwOzGMkA2uPTQhbQ4viFDoo35UaI6Cat-oa9TzQ24ayhdeGBlpiOdy7MLfHn_pwPnD8N4xxWikCEtQtPDqLQ8MqFz85U2wJM3WkAM6Lw0qGoeciDt0CRbCs_cPrOdBUCi0gmDNh9ykqCpvYET3c6kOUHBV_afXslRerit2-N43GPLP9nM_5fQ3f_M_AUQmU0zXXpBwmGqy5iGia_BCs8QfVZ2XHnVoIPTn-vZ8gKI1YEFckb3O6O-zh87PnhuhW-ttI4tm9orXVl5LXBniTt_amhmV6Y0mOv4HbQuBCYBQZSM0mx9vu4WEuJkLNm3mUPxhmc2k9ac1fzD5fVNG1drk_4S_F_tQuyWsD5pg-cgnOMc4IHWjwsUrdM6815EnIkXBOkUefT_RwFukAuSiPgKZI3xsxguB22PTkvYgAz2Oerv21RY3cH9rvihblLnAhTco9UMLsr2uyljU3hFuaoQgIeO1HL9stJ50nR7gOCt5am5PHv1H9zVuTUdZsgPndYSOor8c98hCYxEyGkGeIDSecMjKb8lZ2GdixFUhYU6GkVJdfRFVidx2j9f_8faPSwwr56rop5PqquW470jwYdI_qE1D6GZ3B1YkFyZWFZATYAAQALAAYEcgAgnf_L82w4OuaZ-5ho3G3LidcVOIS-KAOSLBJBWL-tIq4AEAAQCAAAAAAAAQDOHY3XwC6PgKLX6N39Al6zP5v_ISOHP2oOZQQtBlY0lnpu79-5JL6fa5ntSsUSZL9JJTAJGCpw2hmGahPQATWNFswVLnslcn2g89cUkU82Eg4DJtW-ArLprmLo9Q53GiHJFtU2cqXFU6QkDWxXhswIs3rM-u6nOPCFjUJ3sj3Nbf9s3JtCE7DqofXi5fEdNMFIk9x-rMpZwMR45itb3hh0CXrDN9zZ1vnJszfcvkPtJBs7MlzfxF_pyrx92z3I0Wf7eRVVbfpj4LKL4IEn8yIrJXp-ROZIP9dQBNmuJ8_ao7jMsVt9Zl-WbwWeqxIx13ZvgTO0xvX_Vr-7LK96KfQ5aGNlcnRJbmZvWKH_VENHgBcAIgAL-NYSfwfy5hKcW4hWT2TiFBdgPIFEp7SqMR8Oyouy0tYAFAXMY6LVU2-C93d1RpcY01e6FDfHAAAAAPZ9WEO-WcZzpKq35AE847UBjyKiiwAiAAtTEaxCM1z69kvpqTqEPaA2moo_JmomCopSZvzX6QaHbwAiAAt0kOPLyV4VuXM7V8WLQdYx1U_zgGiBd-n85Mwc5ACAm2hhdXRoRGF0YVkBZ4hHbR1KvnQ1gf1-vaAt5QBKFeyReXOrVDqDLyzYe24ZRQAAAAAImHBYytxLgbbhMN5Q3L6WACD3NeqCnqpuoqEFn-n7u3l4B2Mb6t7iXPEAYZFZrP6dH6QBAwM5AQAgWQEAzh2N18Auj4Ci1-jd_QJesz-b_yEjhz9qDmUELQZWNJZ6bu_fuSS-n2uZ7UrFEmS_SSUwCRgqcNoZhmoT0AE1jRbMFS57JXJ9oPPXFJFPNhIOAybVvgKy6a5i6PUOdxohyRbVNnKlxVOkJA1sV4bMCLN6zPrupzjwhY1Cd7I9zW3_bNybQhOw6qH14uXxHTTBSJPcfqzKWcDEeOYrW94YdAl6wzfc2db5ybM33L5D7SQbOzJc38Rf6cq8fds9yNFn-3kVVW36Y-Cyi-CBJ_MiKyV6fkTmSD_XUATZrifP2qO4zLFbfWZflm8FnqsSMdd2b4EztMb1_1a_uyyvein0OSFDAQAB';
      const clientDataJSON =
        'eyJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIiwiY2hhbGxlbmdlIjoicFN3QV90TWxiUE1JNmxEY3FkR3ZIeWo1TC1USG5DQlhScFlid294YlBuUC1EZWp5UkNSMmpuTHE5dTZ6N2NwSGFDdVVzc1UzUFJySko5T1NaeHZuX0EiLCJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY3Jvc3NPcmlnaW4iOmZhbHNlfQ';

      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const tf = new TpmFormat();
      tf.config(
        {
          ...attStmt,
          ver: '1.5',
        },
        {
          ...result,
        } as any,
        {} as any,
        {}
      );

      try {
        const verified = await tf.verify();
        t.fail('not come here');
      } catch (err) {
        t.match(err.message, /TPM version must be "2.0"/);
      }

      t.end();
    });

    t.test('### result is null', async (t) => {
      const attestationObject =
        'o2NmbXRjdHBtZ2F0dFN0bXSmY2FsZzn__mNzaWdZAQAc4Y6uEaGpi8S3THzR8RlV8gxvIJPcXJppNk2SVhCpxQVf6is0qMk5tRK4ChTB7LZVn3_GbpMVXT4ggZhAQld9aiCAAVyywE6LGh-nGuBzDNJyystxkB51wpBuWU65s0BxtONK2bWvX1nMgUzcyIYyiyfy0Krmn4aOnCF-Idsnz555ezrRp8WjcvTLF0SeagX4s16bTWOaBYqNpDNfYDkOq1aiRNpwzyZpexhRbnszkFp2yq71cOP1U2LB-ShWeiWXIr3LOf5fcjXLVfBqKQuwxM4Fmz1XZ34YeI-xSn1duzLQ0ugnHf9X8XJqr6R340PyT9zYCD_X6eBAgPTyCQzEY3ZlcmMyLjBjeDVjglkFuzCCBbcwggOfoAMCAQICEDro7V5QKkXugEpqXYSheWMwDQYJKoZIhvcNAQELBQAwQTE_MD0GA1UEAxM2TkNVLUFNRC1LRVlJRC04QTA1NzhDRjU2MTQ2RkVBMzk5QUY5MDNGQjVCMEFDMzZFQjI3ODZBMB4XDTIyMDIwNzE3MjQzMVoXDTI3MDYxMDE4NTIxOFowADCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAJWJcBlHvdsGoI9TqkvPgiA--a_GgdPEAPrdtZwklWkABId8rfaTlNKSveR-G-SR13AkccEPVzsvMCDTrhzca7mAZoqr4O2YX0dbwm8EKEkvzc6Wvliil3-EQ0XrzckHdDkHO4goHdT9ap7AA-s-cX2tmgtoyIOLTczoy2Azs1vzqtRGpsWeVpGS5_9eZMX5dsI3TPaQyhZY1OLnAMSySQk4Dz0Hv3pfA9B6QijEawMOn0qeuaLediJQLmLvNT_PXphkKE0qUTt7_PUvRZl29uI7aRGt-UjkAYs6YFLaT6dqnU-9nXjsY1Du8k8yUU_PrL-OjKSwvY84bfyNyqGfBmMCAwEAAaOCAeowggHmMA4GA1UdDwEB_wQEAwIHgDAMBgNVHRMBAf8EAjAAMG0GA1UdIAEB_wRjMGEwXwYJKwYBBAGCNxUfMFIwUAYIKwYBBQUHAgIwRB5CAFQAQwBQAEEAIAAgAFQAcgB1AHMAdABlAGQAIAAgAFAAbABhAHQAZgBvAHIAbQAgACAASQBkAGUAbgB0AGkAdAB5MBAGA1UdJQQJMAcGBWeBBQgDMFAGA1UdEQEB_wRGMESkQjBAMRYwFAYFZ4EFAgEMC2lkOjQxNEQ0NDAwMQ4wDAYFZ4EFAgIMA0FNRDEWMBQGBWeBBQIDDAtpZDowMDAzMDAwMTAfBgNVHSMEGDAWgBS5sZO0vZWinFrRYD-ePZLA799qMTAdBgNVHQ4EFgQUmy2Muo_fQZp01vcfSXRlP9LQ5l4wgbIGCCsGAQUFBwEBBIGlMIGiMIGfBggrBgEFBQcwAoaBkmh0dHA6Ly9hemNzcHJvZG5jdWFpa3B1Ymxpc2guYmxvYi5jb3JlLndpbmRvd3MubmV0L25jdS1hbWQta2V5aWQtOGEwNTc4Y2Y1NjE0NmZlYTM5OWFmOTAzZmI1YjBhYzM2ZWIyNzg2YS81NDAwMWIyYy1hNmU2LTRmMTYtOWFjNS0wYzZiYmFhOTRjOGMuY2VyMA0GCSqGSIb3DQEBCwUAA4ICAQBjLdWVZ0eBzEVdT1RAVUxyvhmlEQFPxxzzj9fFafB9V9YEZwH2GJ1iOpMjY1TKzkJ27kI4waiA1E5DNY0agngHNBaedvqdFksZU28XfaCtNkQbvR_FOBqtr-MZNfTERfivLTHXgxCALJgL_0FbmTeiJw9vcIvrXwN3y17SG-T7mlzIgWsBPULY57JjBTRaIIcDMysfPi4PQqkneslAXRT--Q0NkV6pG1YTDZayBN0EPnsOXMB2ICPfnJ7ipUjAOiyGa_Go8GsNLlccYi7nS8YvY2SnfjyjQRfVChbAmEUpaWYWk8yZ8TkyVXUYmruPQNfF_V5GNj2wUZPI_BjJ7Es2m1Z7IPDpoMuJiagZv13enjYy6jNygLN33hpB8tpK6uP3W8UHjoN3izI8GpsXwVkiNvZBiYEi1nbZAQSwREr10LBj5XAT3sQ8Q05iNEW6oOW2o_i5Zb_yeMsfyB4C9aM3u-lTaFIWiV7MRNXYBBUorg1dtYnSuVy2BvO00vHNOsXGl_kLaAOn7UNTJfdpXHlBQyDrsp9R4m8N1pJLz6stOQW9cEGYxkSNnhFu-_nixVOFaYzoWCkMhAD9IXRG2vJMuXwD8vBrzcnzJ3UjbFoUGn1kRQXoBRLKgiNfRTUdAhD8Mx7RYNqMDGUMbhTgbMm_A8ZkOh1onCJuoI5SY7G0TVkG7zCCBuswggTToAMCAQICEzMAAAYzhDtjWMyMW-wAAAAABjMwDQYJKoZIhvcNAQELBQAwgYwxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpXYXNoaW5ndG9uMRAwDgYDVQQHEwdSZWRtb25kMR4wHAYDVQQKExVNaWNyb3NvZnQgQ29ycG9yYXRpb24xNjA0BgNVBAMTLU1pY3Jvc29mdCBUUE0gUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkgMjAxNDAeFw0yMTA2MTAxODUyMThaFw0yNzA2MTAxODUyMThaMEExPzA9BgNVBAMTNk5DVS1BTUQtS0VZSUQtOEEwNTc4Q0Y1NjE0NkZFQTM5OUFGOTAzRkI1QjBBQzM2RUIyNzg2QTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAMtiiRvBQra6Yu-Mfcuo4eRfSf5JQfE3mCKDlSOQFGmdbYeIExndRMrxqhCSeN0Sy10v0XIRK7yCikCh2tZHlHpdPnE1M7RXttLRus6EBffEfWH-JPsSKZn1z9KFgOCBjrAqP7rwX4P_WGyNwdWHSfSVw8KCm67bhN6IoVlodg3EV9sOmxU9AxcfYsfSosQVOEhBeYo8MxRB_dULhrqZKETRJN5403TOn6b0VDwtygjBMaoFks7Gpaj22OJ8YhMtD2ZbNnkkgHAL6rdwIQd0ksR7rdrVFKXIuhjLeMHYBs3h6CctyaPVnqfXuNpIKzcBfIT8sqFUsN70dnGVedfA1PJhoLZ6pL8uv_R_TbV9F2QxZ7LHffrnR7x7p3N9bB7gz4uIR5Q7mwUayd8fZ3i4BLEsCfb6awnNUAkSn1-YFg6S1fmR5PuHi1unkMzx52hbtyakXDS9u63QGCAlo8G3n7IDZD30hzQQhLwOIe_cwVxdfCyornEX7AKYAlMDwgyXqrnoQs34M4unXrIAkIcqqhhc4aObrCLVCPn7Ho44EHlNt8wgWPA4JNK_PcEuIXyaYt4IMEgz4k9YCKi8F4HNIObIkTDxk7OiddC3fRdcWeXtVAGXlGsCJixy8bpeLcIgyVIyin2FtNU6GTEr7za6GgQYjTJG9P1PZV0UoMrd8_vHAgMBAAGjggGOMIIBijAOBgNVHQ8BAf8EBAMCAoQwGwYDVR0lBBQwEgYJKwYBBAGCNxUkBgVngQUIAzAWBgNVHSAEDzANMAsGCSsGAQQBgjcVHzASBgNVHRMBAf8ECDAGAQH_AgEAMB0GA1UdDgQWBBS5sZO0vZWinFrRYD-ePZLA799qMTAfBgNVHSMEGDAWgBR6jArOL0hiF-KU0a5VwVLscXSkVjBwBgNVHR8EaTBnMGWgY6Bhhl9odHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20vcGtpb3BzL2NybC9NaWNyb3NvZnQlMjBUUE0lMjBSb290JTIwQ2VydGlmaWNhdGUlMjBBdXRob3JpdHklMjAyMDE0LmNybDB9BggrBgEFBQcBAQRxMG8wbQYIKwYBBQUHMAKGYWh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9wa2lvcHMvY2VydHMvTWljcm9zb2Z0JTIwVFBNJTIwUm9vdCUyMENlcnRpZmljYXRlJTIwQXV0aG9yaXR5JTIwMjAxNC5jcnQwDQYJKoZIhvcNAQELBQADggIBAHY7WQQfcEZx9Auozwthy4DXsd3o_HrxqWlai_W7Hz8ZLuWmiTcPSRRzcHJyKWvVXn7k57kyI9Mn-diMRwOzGMkA2uPTQhbQ4viFDoo35UaI6Cat-oa9TzQ24ayhdeGBlpiOdy7MLfHn_pwPnD8N4xxWikCEtQtPDqLQ8MqFz85U2wJM3WkAM6Lw0qGoeciDt0CRbCs_cPrOdBUCi0gmDNh9ykqCpvYET3c6kOUHBV_afXslRerit2-N43GPLP9nM_5fQ3f_M_AUQmU0zXXpBwmGqy5iGia_BCs8QfVZ2XHnVoIPTn-vZ8gKI1YEFckb3O6O-zh87PnhuhW-ttI4tm9orXVl5LXBniTt_amhmV6Y0mOv4HbQuBCYBQZSM0mx9vu4WEuJkLNm3mUPxhmc2k9ac1fzD5fVNG1drk_4S_F_tQuyWsD5pg-cgnOMc4IHWjwsUrdM6815EnIkXBOkUefT_RwFukAuSiPgKZI3xsxguB22PTkvYgAz2Oerv21RY3cH9rvihblLnAhTco9UMLsr2uyljU3hFuaoQgIeO1HL9stJ50nR7gOCt5am5PHv1H9zVuTUdZsgPndYSOor8c98hCYxEyGkGeIDSecMjKb8lZ2GdixFUhYU6GkVJdfRFVidx2j9f_8faPSwwr56rop5PqquW470jwYdI_qE1D6GZ3B1YkFyZWFZATYAAQALAAYEcgAgnf_L82w4OuaZ-5ho3G3LidcVOIS-KAOSLBJBWL-tIq4AEAAQCAAAAAAAAQDOHY3XwC6PgKLX6N39Al6zP5v_ISOHP2oOZQQtBlY0lnpu79-5JL6fa5ntSsUSZL9JJTAJGCpw2hmGahPQATWNFswVLnslcn2g89cUkU82Eg4DJtW-ArLprmLo9Q53GiHJFtU2cqXFU6QkDWxXhswIs3rM-u6nOPCFjUJ3sj3Nbf9s3JtCE7DqofXi5fEdNMFIk9x-rMpZwMR45itb3hh0CXrDN9zZ1vnJszfcvkPtJBs7MlzfxF_pyrx92z3I0Wf7eRVVbfpj4LKL4IEn8yIrJXp-ROZIP9dQBNmuJ8_ao7jMsVt9Zl-WbwWeqxIx13ZvgTO0xvX_Vr-7LK96KfQ5aGNlcnRJbmZvWKH_VENHgBcAIgAL-NYSfwfy5hKcW4hWT2TiFBdgPIFEp7SqMR8Oyouy0tYAFAXMY6LVU2-C93d1RpcY01e6FDfHAAAAAPZ9WEO-WcZzpKq35AE847UBjyKiiwAiAAtTEaxCM1z69kvpqTqEPaA2moo_JmomCopSZvzX6QaHbwAiAAt0kOPLyV4VuXM7V8WLQdYx1U_zgGiBd-n85Mwc5ACAm2hhdXRoRGF0YVkBZ4hHbR1KvnQ1gf1-vaAt5QBKFeyReXOrVDqDLyzYe24ZRQAAAAAImHBYytxLgbbhMN5Q3L6WACD3NeqCnqpuoqEFn-n7u3l4B2Mb6t7iXPEAYZFZrP6dH6QBAwM5AQAgWQEAzh2N18Auj4Ci1-jd_QJesz-b_yEjhz9qDmUELQZWNJZ6bu_fuSS-n2uZ7UrFEmS_SSUwCRgqcNoZhmoT0AE1jRbMFS57JXJ9oPPXFJFPNhIOAybVvgKy6a5i6PUOdxohyRbVNnKlxVOkJA1sV4bMCLN6zPrupzjwhY1Cd7I9zW3_bNybQhOw6qH14uXxHTTBSJPcfqzKWcDEeOYrW94YdAl6wzfc2db5ybM33L5D7SQbOzJc38Rf6cq8fds9yNFn-3kVVW36Y-Cyi-CBJ_MiKyV6fkTmSD_XUATZrifP2qO4zLFbfWZflm8FnqsSMdd2b4EztMb1_1a_uyyvein0OSFDAQAB';
      const clientDataJSON =
        'eyJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIiwiY2hhbGxlbmdlIjoicFN3QV90TWxiUE1JNmxEY3FkR3ZIeWo1TC1USG5DQlhScFlid294YlBuUC1EZWp5UkNSMmpuTHE5dTZ6N2NwSGFDdVVzc1UzUFJySko5T1NaeHZuX0EiLCJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY3Jvc3NPcmlnaW4iOmZhbHNlfQ';

      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const tf = new TpmFormat();
      tf.config(
        {
          ...attStmt,
        },
        null as any,
        {} as any,
        {}
      );

      try {
        const verified = await tf.verify();
        t.fail('not come here');
      } catch (err) {
        t.match(err.message, /Data is not enough/);
      }

      t.end();
    });

    t.test('### pubArea is null', async (t) => {
      const attestationObject =
        'o2NmbXRjdHBtZ2F0dFN0bXSmY2FsZzn__mNzaWdZAQAc4Y6uEaGpi8S3THzR8RlV8gxvIJPcXJppNk2SVhCpxQVf6is0qMk5tRK4ChTB7LZVn3_GbpMVXT4ggZhAQld9aiCAAVyywE6LGh-nGuBzDNJyystxkB51wpBuWU65s0BxtONK2bWvX1nMgUzcyIYyiyfy0Krmn4aOnCF-Idsnz555ezrRp8WjcvTLF0SeagX4s16bTWOaBYqNpDNfYDkOq1aiRNpwzyZpexhRbnszkFp2yq71cOP1U2LB-ShWeiWXIr3LOf5fcjXLVfBqKQuwxM4Fmz1XZ34YeI-xSn1duzLQ0ugnHf9X8XJqr6R340PyT9zYCD_X6eBAgPTyCQzEY3ZlcmMyLjBjeDVjglkFuzCCBbcwggOfoAMCAQICEDro7V5QKkXugEpqXYSheWMwDQYJKoZIhvcNAQELBQAwQTE_MD0GA1UEAxM2TkNVLUFNRC1LRVlJRC04QTA1NzhDRjU2MTQ2RkVBMzk5QUY5MDNGQjVCMEFDMzZFQjI3ODZBMB4XDTIyMDIwNzE3MjQzMVoXDTI3MDYxMDE4NTIxOFowADCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAJWJcBlHvdsGoI9TqkvPgiA--a_GgdPEAPrdtZwklWkABId8rfaTlNKSveR-G-SR13AkccEPVzsvMCDTrhzca7mAZoqr4O2YX0dbwm8EKEkvzc6Wvliil3-EQ0XrzckHdDkHO4goHdT9ap7AA-s-cX2tmgtoyIOLTczoy2Azs1vzqtRGpsWeVpGS5_9eZMX5dsI3TPaQyhZY1OLnAMSySQk4Dz0Hv3pfA9B6QijEawMOn0qeuaLediJQLmLvNT_PXphkKE0qUTt7_PUvRZl29uI7aRGt-UjkAYs6YFLaT6dqnU-9nXjsY1Du8k8yUU_PrL-OjKSwvY84bfyNyqGfBmMCAwEAAaOCAeowggHmMA4GA1UdDwEB_wQEAwIHgDAMBgNVHRMBAf8EAjAAMG0GA1UdIAEB_wRjMGEwXwYJKwYBBAGCNxUfMFIwUAYIKwYBBQUHAgIwRB5CAFQAQwBQAEEAIAAgAFQAcgB1AHMAdABlAGQAIAAgAFAAbABhAHQAZgBvAHIAbQAgACAASQBkAGUAbgB0AGkAdAB5MBAGA1UdJQQJMAcGBWeBBQgDMFAGA1UdEQEB_wRGMESkQjBAMRYwFAYFZ4EFAgEMC2lkOjQxNEQ0NDAwMQ4wDAYFZ4EFAgIMA0FNRDEWMBQGBWeBBQIDDAtpZDowMDAzMDAwMTAfBgNVHSMEGDAWgBS5sZO0vZWinFrRYD-ePZLA799qMTAdBgNVHQ4EFgQUmy2Muo_fQZp01vcfSXRlP9LQ5l4wgbIGCCsGAQUFBwEBBIGlMIGiMIGfBggrBgEFBQcwAoaBkmh0dHA6Ly9hemNzcHJvZG5jdWFpa3B1Ymxpc2guYmxvYi5jb3JlLndpbmRvd3MubmV0L25jdS1hbWQta2V5aWQtOGEwNTc4Y2Y1NjE0NmZlYTM5OWFmOTAzZmI1YjBhYzM2ZWIyNzg2YS81NDAwMWIyYy1hNmU2LTRmMTYtOWFjNS0wYzZiYmFhOTRjOGMuY2VyMA0GCSqGSIb3DQEBCwUAA4ICAQBjLdWVZ0eBzEVdT1RAVUxyvhmlEQFPxxzzj9fFafB9V9YEZwH2GJ1iOpMjY1TKzkJ27kI4waiA1E5DNY0agngHNBaedvqdFksZU28XfaCtNkQbvR_FOBqtr-MZNfTERfivLTHXgxCALJgL_0FbmTeiJw9vcIvrXwN3y17SG-T7mlzIgWsBPULY57JjBTRaIIcDMysfPi4PQqkneslAXRT--Q0NkV6pG1YTDZayBN0EPnsOXMB2ICPfnJ7ipUjAOiyGa_Go8GsNLlccYi7nS8YvY2SnfjyjQRfVChbAmEUpaWYWk8yZ8TkyVXUYmruPQNfF_V5GNj2wUZPI_BjJ7Es2m1Z7IPDpoMuJiagZv13enjYy6jNygLN33hpB8tpK6uP3W8UHjoN3izI8GpsXwVkiNvZBiYEi1nbZAQSwREr10LBj5XAT3sQ8Q05iNEW6oOW2o_i5Zb_yeMsfyB4C9aM3u-lTaFIWiV7MRNXYBBUorg1dtYnSuVy2BvO00vHNOsXGl_kLaAOn7UNTJfdpXHlBQyDrsp9R4m8N1pJLz6stOQW9cEGYxkSNnhFu-_nixVOFaYzoWCkMhAD9IXRG2vJMuXwD8vBrzcnzJ3UjbFoUGn1kRQXoBRLKgiNfRTUdAhD8Mx7RYNqMDGUMbhTgbMm_A8ZkOh1onCJuoI5SY7G0TVkG7zCCBuswggTToAMCAQICEzMAAAYzhDtjWMyMW-wAAAAABjMwDQYJKoZIhvcNAQELBQAwgYwxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpXYXNoaW5ndG9uMRAwDgYDVQQHEwdSZWRtb25kMR4wHAYDVQQKExVNaWNyb3NvZnQgQ29ycG9yYXRpb24xNjA0BgNVBAMTLU1pY3Jvc29mdCBUUE0gUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkgMjAxNDAeFw0yMTA2MTAxODUyMThaFw0yNzA2MTAxODUyMThaMEExPzA9BgNVBAMTNk5DVS1BTUQtS0VZSUQtOEEwNTc4Q0Y1NjE0NkZFQTM5OUFGOTAzRkI1QjBBQzM2RUIyNzg2QTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAMtiiRvBQra6Yu-Mfcuo4eRfSf5JQfE3mCKDlSOQFGmdbYeIExndRMrxqhCSeN0Sy10v0XIRK7yCikCh2tZHlHpdPnE1M7RXttLRus6EBffEfWH-JPsSKZn1z9KFgOCBjrAqP7rwX4P_WGyNwdWHSfSVw8KCm67bhN6IoVlodg3EV9sOmxU9AxcfYsfSosQVOEhBeYo8MxRB_dULhrqZKETRJN5403TOn6b0VDwtygjBMaoFks7Gpaj22OJ8YhMtD2ZbNnkkgHAL6rdwIQd0ksR7rdrVFKXIuhjLeMHYBs3h6CctyaPVnqfXuNpIKzcBfIT8sqFUsN70dnGVedfA1PJhoLZ6pL8uv_R_TbV9F2QxZ7LHffrnR7x7p3N9bB7gz4uIR5Q7mwUayd8fZ3i4BLEsCfb6awnNUAkSn1-YFg6S1fmR5PuHi1unkMzx52hbtyakXDS9u63QGCAlo8G3n7IDZD30hzQQhLwOIe_cwVxdfCyornEX7AKYAlMDwgyXqrnoQs34M4unXrIAkIcqqhhc4aObrCLVCPn7Ho44EHlNt8wgWPA4JNK_PcEuIXyaYt4IMEgz4k9YCKi8F4HNIObIkTDxk7OiddC3fRdcWeXtVAGXlGsCJixy8bpeLcIgyVIyin2FtNU6GTEr7za6GgQYjTJG9P1PZV0UoMrd8_vHAgMBAAGjggGOMIIBijAOBgNVHQ8BAf8EBAMCAoQwGwYDVR0lBBQwEgYJKwYBBAGCNxUkBgVngQUIAzAWBgNVHSAEDzANMAsGCSsGAQQBgjcVHzASBgNVHRMBAf8ECDAGAQH_AgEAMB0GA1UdDgQWBBS5sZO0vZWinFrRYD-ePZLA799qMTAfBgNVHSMEGDAWgBR6jArOL0hiF-KU0a5VwVLscXSkVjBwBgNVHR8EaTBnMGWgY6Bhhl9odHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20vcGtpb3BzL2NybC9NaWNyb3NvZnQlMjBUUE0lMjBSb290JTIwQ2VydGlmaWNhdGUlMjBBdXRob3JpdHklMjAyMDE0LmNybDB9BggrBgEFBQcBAQRxMG8wbQYIKwYBBQUHMAKGYWh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9wa2lvcHMvY2VydHMvTWljcm9zb2Z0JTIwVFBNJTIwUm9vdCUyMENlcnRpZmljYXRlJTIwQXV0aG9yaXR5JTIwMjAxNC5jcnQwDQYJKoZIhvcNAQELBQADggIBAHY7WQQfcEZx9Auozwthy4DXsd3o_HrxqWlai_W7Hz8ZLuWmiTcPSRRzcHJyKWvVXn7k57kyI9Mn-diMRwOzGMkA2uPTQhbQ4viFDoo35UaI6Cat-oa9TzQ24ayhdeGBlpiOdy7MLfHn_pwPnD8N4xxWikCEtQtPDqLQ8MqFz85U2wJM3WkAM6Lw0qGoeciDt0CRbCs_cPrOdBUCi0gmDNh9ykqCpvYET3c6kOUHBV_afXslRerit2-N43GPLP9nM_5fQ3f_M_AUQmU0zXXpBwmGqy5iGia_BCs8QfVZ2XHnVoIPTn-vZ8gKI1YEFckb3O6O-zh87PnhuhW-ttI4tm9orXVl5LXBniTt_amhmV6Y0mOv4HbQuBCYBQZSM0mx9vu4WEuJkLNm3mUPxhmc2k9ac1fzD5fVNG1drk_4S_F_tQuyWsD5pg-cgnOMc4IHWjwsUrdM6815EnIkXBOkUefT_RwFukAuSiPgKZI3xsxguB22PTkvYgAz2Oerv21RY3cH9rvihblLnAhTco9UMLsr2uyljU3hFuaoQgIeO1HL9stJ50nR7gOCt5am5PHv1H9zVuTUdZsgPndYSOor8c98hCYxEyGkGeIDSecMjKb8lZ2GdixFUhYU6GkVJdfRFVidx2j9f_8faPSwwr56rop5PqquW470jwYdI_qE1D6GZ3B1YkFyZWFZATYAAQALAAYEcgAgnf_L82w4OuaZ-5ho3G3LidcVOIS-KAOSLBJBWL-tIq4AEAAQCAAAAAAAAQDOHY3XwC6PgKLX6N39Al6zP5v_ISOHP2oOZQQtBlY0lnpu79-5JL6fa5ntSsUSZL9JJTAJGCpw2hmGahPQATWNFswVLnslcn2g89cUkU82Eg4DJtW-ArLprmLo9Q53GiHJFtU2cqXFU6QkDWxXhswIs3rM-u6nOPCFjUJ3sj3Nbf9s3JtCE7DqofXi5fEdNMFIk9x-rMpZwMR45itb3hh0CXrDN9zZ1vnJszfcvkPtJBs7MlzfxF_pyrx92z3I0Wf7eRVVbfpj4LKL4IEn8yIrJXp-ROZIP9dQBNmuJ8_ao7jMsVt9Zl-WbwWeqxIx13ZvgTO0xvX_Vr-7LK96KfQ5aGNlcnRJbmZvWKH_VENHgBcAIgAL-NYSfwfy5hKcW4hWT2TiFBdgPIFEp7SqMR8Oyouy0tYAFAXMY6LVU2-C93d1RpcY01e6FDfHAAAAAPZ9WEO-WcZzpKq35AE847UBjyKiiwAiAAtTEaxCM1z69kvpqTqEPaA2moo_JmomCopSZvzX6QaHbwAiAAt0kOPLyV4VuXM7V8WLQdYx1U_zgGiBd-n85Mwc5ACAm2hhdXRoRGF0YVkBZ4hHbR1KvnQ1gf1-vaAt5QBKFeyReXOrVDqDLyzYe24ZRQAAAAAImHBYytxLgbbhMN5Q3L6WACD3NeqCnqpuoqEFn-n7u3l4B2Mb6t7iXPEAYZFZrP6dH6QBAwM5AQAgWQEAzh2N18Auj4Ci1-jd_QJesz-b_yEjhz9qDmUELQZWNJZ6bu_fuSS-n2uZ7UrFEmS_SSUwCRgqcNoZhmoT0AE1jRbMFS57JXJ9oPPXFJFPNhIOAybVvgKy6a5i6PUOdxohyRbVNnKlxVOkJA1sV4bMCLN6zPrupzjwhY1Cd7I9zW3_bNybQhOw6qH14uXxHTTBSJPcfqzKWcDEeOYrW94YdAl6wzfc2db5ybM33L5D7SQbOzJc38Rf6cq8fds9yNFn-3kVVW36Y-Cyi-CBJ_MiKyV6fkTmSD_XUATZrifP2qO4zLFbfWZflm8FnqsSMdd2b4EztMb1_1a_uyyvein0OSFDAQAB';
      const clientDataJSON =
        'eyJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIiwiY2hhbGxlbmdlIjoicFN3QV90TWxiUE1JNmxEY3FkR3ZIeWo1TC1USG5DQlhScFlid294YlBuUC1EZWp5UkNSMmpuTHE5dTZ6N2NwSGFDdVVzc1UzUFJySko5T1NaeHZuX0EiLCJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY3Jvc3NPcmlnaW4iOmZhbHNlfQ';

      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const tf = new TpmFormat();
      tf.config(
        {
          ...attStmt,
          pubArea: null,
        },
        {
          ...result,
        } as any,
        {} as any,
        {}
      );

      try {
        const verified = await tf.verify();
        t.fail('not come here');
      } catch (err) {
        t.match(err.message, /Data is not enough/);
      }

      t.end();
    });

    t.test('### result.jwk is null', async (t) => {
      const attestationObject =
        'o2NmbXRjdHBtZ2F0dFN0bXSmY2FsZzn__mNzaWdZAQAc4Y6uEaGpi8S3THzR8RlV8gxvIJPcXJppNk2SVhCpxQVf6is0qMk5tRK4ChTB7LZVn3_GbpMVXT4ggZhAQld9aiCAAVyywE6LGh-nGuBzDNJyystxkB51wpBuWU65s0BxtONK2bWvX1nMgUzcyIYyiyfy0Krmn4aOnCF-Idsnz555ezrRp8WjcvTLF0SeagX4s16bTWOaBYqNpDNfYDkOq1aiRNpwzyZpexhRbnszkFp2yq71cOP1U2LB-ShWeiWXIr3LOf5fcjXLVfBqKQuwxM4Fmz1XZ34YeI-xSn1duzLQ0ugnHf9X8XJqr6R340PyT9zYCD_X6eBAgPTyCQzEY3ZlcmMyLjBjeDVjglkFuzCCBbcwggOfoAMCAQICEDro7V5QKkXugEpqXYSheWMwDQYJKoZIhvcNAQELBQAwQTE_MD0GA1UEAxM2TkNVLUFNRC1LRVlJRC04QTA1NzhDRjU2MTQ2RkVBMzk5QUY5MDNGQjVCMEFDMzZFQjI3ODZBMB4XDTIyMDIwNzE3MjQzMVoXDTI3MDYxMDE4NTIxOFowADCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAJWJcBlHvdsGoI9TqkvPgiA--a_GgdPEAPrdtZwklWkABId8rfaTlNKSveR-G-SR13AkccEPVzsvMCDTrhzca7mAZoqr4O2YX0dbwm8EKEkvzc6Wvliil3-EQ0XrzckHdDkHO4goHdT9ap7AA-s-cX2tmgtoyIOLTczoy2Azs1vzqtRGpsWeVpGS5_9eZMX5dsI3TPaQyhZY1OLnAMSySQk4Dz0Hv3pfA9B6QijEawMOn0qeuaLediJQLmLvNT_PXphkKE0qUTt7_PUvRZl29uI7aRGt-UjkAYs6YFLaT6dqnU-9nXjsY1Du8k8yUU_PrL-OjKSwvY84bfyNyqGfBmMCAwEAAaOCAeowggHmMA4GA1UdDwEB_wQEAwIHgDAMBgNVHRMBAf8EAjAAMG0GA1UdIAEB_wRjMGEwXwYJKwYBBAGCNxUfMFIwUAYIKwYBBQUHAgIwRB5CAFQAQwBQAEEAIAAgAFQAcgB1AHMAdABlAGQAIAAgAFAAbABhAHQAZgBvAHIAbQAgACAASQBkAGUAbgB0AGkAdAB5MBAGA1UdJQQJMAcGBWeBBQgDMFAGA1UdEQEB_wRGMESkQjBAMRYwFAYFZ4EFAgEMC2lkOjQxNEQ0NDAwMQ4wDAYFZ4EFAgIMA0FNRDEWMBQGBWeBBQIDDAtpZDowMDAzMDAwMTAfBgNVHSMEGDAWgBS5sZO0vZWinFrRYD-ePZLA799qMTAdBgNVHQ4EFgQUmy2Muo_fQZp01vcfSXRlP9LQ5l4wgbIGCCsGAQUFBwEBBIGlMIGiMIGfBggrBgEFBQcwAoaBkmh0dHA6Ly9hemNzcHJvZG5jdWFpa3B1Ymxpc2guYmxvYi5jb3JlLndpbmRvd3MubmV0L25jdS1hbWQta2V5aWQtOGEwNTc4Y2Y1NjE0NmZlYTM5OWFmOTAzZmI1YjBhYzM2ZWIyNzg2YS81NDAwMWIyYy1hNmU2LTRmMTYtOWFjNS0wYzZiYmFhOTRjOGMuY2VyMA0GCSqGSIb3DQEBCwUAA4ICAQBjLdWVZ0eBzEVdT1RAVUxyvhmlEQFPxxzzj9fFafB9V9YEZwH2GJ1iOpMjY1TKzkJ27kI4waiA1E5DNY0agngHNBaedvqdFksZU28XfaCtNkQbvR_FOBqtr-MZNfTERfivLTHXgxCALJgL_0FbmTeiJw9vcIvrXwN3y17SG-T7mlzIgWsBPULY57JjBTRaIIcDMysfPi4PQqkneslAXRT--Q0NkV6pG1YTDZayBN0EPnsOXMB2ICPfnJ7ipUjAOiyGa_Go8GsNLlccYi7nS8YvY2SnfjyjQRfVChbAmEUpaWYWk8yZ8TkyVXUYmruPQNfF_V5GNj2wUZPI_BjJ7Es2m1Z7IPDpoMuJiagZv13enjYy6jNygLN33hpB8tpK6uP3W8UHjoN3izI8GpsXwVkiNvZBiYEi1nbZAQSwREr10LBj5XAT3sQ8Q05iNEW6oOW2o_i5Zb_yeMsfyB4C9aM3u-lTaFIWiV7MRNXYBBUorg1dtYnSuVy2BvO00vHNOsXGl_kLaAOn7UNTJfdpXHlBQyDrsp9R4m8N1pJLz6stOQW9cEGYxkSNnhFu-_nixVOFaYzoWCkMhAD9IXRG2vJMuXwD8vBrzcnzJ3UjbFoUGn1kRQXoBRLKgiNfRTUdAhD8Mx7RYNqMDGUMbhTgbMm_A8ZkOh1onCJuoI5SY7G0TVkG7zCCBuswggTToAMCAQICEzMAAAYzhDtjWMyMW-wAAAAABjMwDQYJKoZIhvcNAQELBQAwgYwxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpXYXNoaW5ndG9uMRAwDgYDVQQHEwdSZWRtb25kMR4wHAYDVQQKExVNaWNyb3NvZnQgQ29ycG9yYXRpb24xNjA0BgNVBAMTLU1pY3Jvc29mdCBUUE0gUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkgMjAxNDAeFw0yMTA2MTAxODUyMThaFw0yNzA2MTAxODUyMThaMEExPzA9BgNVBAMTNk5DVS1BTUQtS0VZSUQtOEEwNTc4Q0Y1NjE0NkZFQTM5OUFGOTAzRkI1QjBBQzM2RUIyNzg2QTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAMtiiRvBQra6Yu-Mfcuo4eRfSf5JQfE3mCKDlSOQFGmdbYeIExndRMrxqhCSeN0Sy10v0XIRK7yCikCh2tZHlHpdPnE1M7RXttLRus6EBffEfWH-JPsSKZn1z9KFgOCBjrAqP7rwX4P_WGyNwdWHSfSVw8KCm67bhN6IoVlodg3EV9sOmxU9AxcfYsfSosQVOEhBeYo8MxRB_dULhrqZKETRJN5403TOn6b0VDwtygjBMaoFks7Gpaj22OJ8YhMtD2ZbNnkkgHAL6rdwIQd0ksR7rdrVFKXIuhjLeMHYBs3h6CctyaPVnqfXuNpIKzcBfIT8sqFUsN70dnGVedfA1PJhoLZ6pL8uv_R_TbV9F2QxZ7LHffrnR7x7p3N9bB7gz4uIR5Q7mwUayd8fZ3i4BLEsCfb6awnNUAkSn1-YFg6S1fmR5PuHi1unkMzx52hbtyakXDS9u63QGCAlo8G3n7IDZD30hzQQhLwOIe_cwVxdfCyornEX7AKYAlMDwgyXqrnoQs34M4unXrIAkIcqqhhc4aObrCLVCPn7Ho44EHlNt8wgWPA4JNK_PcEuIXyaYt4IMEgz4k9YCKi8F4HNIObIkTDxk7OiddC3fRdcWeXtVAGXlGsCJixy8bpeLcIgyVIyin2FtNU6GTEr7za6GgQYjTJG9P1PZV0UoMrd8_vHAgMBAAGjggGOMIIBijAOBgNVHQ8BAf8EBAMCAoQwGwYDVR0lBBQwEgYJKwYBBAGCNxUkBgVngQUIAzAWBgNVHSAEDzANMAsGCSsGAQQBgjcVHzASBgNVHRMBAf8ECDAGAQH_AgEAMB0GA1UdDgQWBBS5sZO0vZWinFrRYD-ePZLA799qMTAfBgNVHSMEGDAWgBR6jArOL0hiF-KU0a5VwVLscXSkVjBwBgNVHR8EaTBnMGWgY6Bhhl9odHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20vcGtpb3BzL2NybC9NaWNyb3NvZnQlMjBUUE0lMjBSb290JTIwQ2VydGlmaWNhdGUlMjBBdXRob3JpdHklMjAyMDE0LmNybDB9BggrBgEFBQcBAQRxMG8wbQYIKwYBBQUHMAKGYWh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9wa2lvcHMvY2VydHMvTWljcm9zb2Z0JTIwVFBNJTIwUm9vdCUyMENlcnRpZmljYXRlJTIwQXV0aG9yaXR5JTIwMjAxNC5jcnQwDQYJKoZIhvcNAQELBQADggIBAHY7WQQfcEZx9Auozwthy4DXsd3o_HrxqWlai_W7Hz8ZLuWmiTcPSRRzcHJyKWvVXn7k57kyI9Mn-diMRwOzGMkA2uPTQhbQ4viFDoo35UaI6Cat-oa9TzQ24ayhdeGBlpiOdy7MLfHn_pwPnD8N4xxWikCEtQtPDqLQ8MqFz85U2wJM3WkAM6Lw0qGoeciDt0CRbCs_cPrOdBUCi0gmDNh9ykqCpvYET3c6kOUHBV_afXslRerit2-N43GPLP9nM_5fQ3f_M_AUQmU0zXXpBwmGqy5iGia_BCs8QfVZ2XHnVoIPTn-vZ8gKI1YEFckb3O6O-zh87PnhuhW-ttI4tm9orXVl5LXBniTt_amhmV6Y0mOv4HbQuBCYBQZSM0mx9vu4WEuJkLNm3mUPxhmc2k9ac1fzD5fVNG1drk_4S_F_tQuyWsD5pg-cgnOMc4IHWjwsUrdM6815EnIkXBOkUefT_RwFukAuSiPgKZI3xsxguB22PTkvYgAz2Oerv21RY3cH9rvihblLnAhTco9UMLsr2uyljU3hFuaoQgIeO1HL9stJ50nR7gOCt5am5PHv1H9zVuTUdZsgPndYSOor8c98hCYxEyGkGeIDSecMjKb8lZ2GdixFUhYU6GkVJdfRFVidx2j9f_8faPSwwr56rop5PqquW470jwYdI_qE1D6GZ3B1YkFyZWFZATYAAQALAAYEcgAgnf_L82w4OuaZ-5ho3G3LidcVOIS-KAOSLBJBWL-tIq4AEAAQCAAAAAAAAQDOHY3XwC6PgKLX6N39Al6zP5v_ISOHP2oOZQQtBlY0lnpu79-5JL6fa5ntSsUSZL9JJTAJGCpw2hmGahPQATWNFswVLnslcn2g89cUkU82Eg4DJtW-ArLprmLo9Q53GiHJFtU2cqXFU6QkDWxXhswIs3rM-u6nOPCFjUJ3sj3Nbf9s3JtCE7DqofXi5fEdNMFIk9x-rMpZwMR45itb3hh0CXrDN9zZ1vnJszfcvkPtJBs7MlzfxF_pyrx92z3I0Wf7eRVVbfpj4LKL4IEn8yIrJXp-ROZIP9dQBNmuJ8_ao7jMsVt9Zl-WbwWeqxIx13ZvgTO0xvX_Vr-7LK96KfQ5aGNlcnRJbmZvWKH_VENHgBcAIgAL-NYSfwfy5hKcW4hWT2TiFBdgPIFEp7SqMR8Oyouy0tYAFAXMY6LVU2-C93d1RpcY01e6FDfHAAAAAPZ9WEO-WcZzpKq35AE847UBjyKiiwAiAAtTEaxCM1z69kvpqTqEPaA2moo_JmomCopSZvzX6QaHbwAiAAt0kOPLyV4VuXM7V8WLQdYx1U_zgGiBd-n85Mwc5ACAm2hhdXRoRGF0YVkBZ4hHbR1KvnQ1gf1-vaAt5QBKFeyReXOrVDqDLyzYe24ZRQAAAAAImHBYytxLgbbhMN5Q3L6WACD3NeqCnqpuoqEFn-n7u3l4B2Mb6t7iXPEAYZFZrP6dH6QBAwM5AQAgWQEAzh2N18Auj4Ci1-jd_QJesz-b_yEjhz9qDmUELQZWNJZ6bu_fuSS-n2uZ7UrFEmS_SSUwCRgqcNoZhmoT0AE1jRbMFS57JXJ9oPPXFJFPNhIOAybVvgKy6a5i6PUOdxohyRbVNnKlxVOkJA1sV4bMCLN6zPrupzjwhY1Cd7I9zW3_bNybQhOw6qH14uXxHTTBSJPcfqzKWcDEeOYrW94YdAl6wzfc2db5ybM33L5D7SQbOzJc38Rf6cq8fds9yNFn-3kVVW36Y-Cyi-CBJ_MiKyV6fkTmSD_XUATZrifP2qO4zLFbfWZflm8FnqsSMdd2b4EztMb1_1a_uyyvein0OSFDAQAB';
      const clientDataJSON =
        'eyJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIiwiY2hhbGxlbmdlIjoicFN3QV90TWxiUE1JNmxEY3FkR3ZIeWo1TC1USG5DQlhScFlid294YlBuUC1EZWp5UkNSMmpuTHE5dTZ6N2NwSGFDdVVzc1UzUFJySko5T1NaeHZuX0EiLCJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY3Jvc3NPcmlnaW4iOmZhbHNlfQ';

      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const tf = new TpmFormat();
      tf.config(
        {
          ...attStmt,
        },
        {
          ...result,
          jwk: null,
        } as any,
        {} as any,
        {}
      );

      try {
        const verified = await tf.verify();
        t.fail('not come here');
      } catch (err) {
        t.match(err.message, /Public key in authData does not exist/);
      }

      t.end();
    });

    t.test('### result.clientDataJSONHash is null', async (t) => {
      const attestationObject =
        'o2NmbXRjdHBtZ2F0dFN0bXSmY2FsZzn__mNzaWdZAQAc4Y6uEaGpi8S3THzR8RlV8gxvIJPcXJppNk2SVhCpxQVf6is0qMk5tRK4ChTB7LZVn3_GbpMVXT4ggZhAQld9aiCAAVyywE6LGh-nGuBzDNJyystxkB51wpBuWU65s0BxtONK2bWvX1nMgUzcyIYyiyfy0Krmn4aOnCF-Idsnz555ezrRp8WjcvTLF0SeagX4s16bTWOaBYqNpDNfYDkOq1aiRNpwzyZpexhRbnszkFp2yq71cOP1U2LB-ShWeiWXIr3LOf5fcjXLVfBqKQuwxM4Fmz1XZ34YeI-xSn1duzLQ0ugnHf9X8XJqr6R340PyT9zYCD_X6eBAgPTyCQzEY3ZlcmMyLjBjeDVjglkFuzCCBbcwggOfoAMCAQICEDro7V5QKkXugEpqXYSheWMwDQYJKoZIhvcNAQELBQAwQTE_MD0GA1UEAxM2TkNVLUFNRC1LRVlJRC04QTA1NzhDRjU2MTQ2RkVBMzk5QUY5MDNGQjVCMEFDMzZFQjI3ODZBMB4XDTIyMDIwNzE3MjQzMVoXDTI3MDYxMDE4NTIxOFowADCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAJWJcBlHvdsGoI9TqkvPgiA--a_GgdPEAPrdtZwklWkABId8rfaTlNKSveR-G-SR13AkccEPVzsvMCDTrhzca7mAZoqr4O2YX0dbwm8EKEkvzc6Wvliil3-EQ0XrzckHdDkHO4goHdT9ap7AA-s-cX2tmgtoyIOLTczoy2Azs1vzqtRGpsWeVpGS5_9eZMX5dsI3TPaQyhZY1OLnAMSySQk4Dz0Hv3pfA9B6QijEawMOn0qeuaLediJQLmLvNT_PXphkKE0qUTt7_PUvRZl29uI7aRGt-UjkAYs6YFLaT6dqnU-9nXjsY1Du8k8yUU_PrL-OjKSwvY84bfyNyqGfBmMCAwEAAaOCAeowggHmMA4GA1UdDwEB_wQEAwIHgDAMBgNVHRMBAf8EAjAAMG0GA1UdIAEB_wRjMGEwXwYJKwYBBAGCNxUfMFIwUAYIKwYBBQUHAgIwRB5CAFQAQwBQAEEAIAAgAFQAcgB1AHMAdABlAGQAIAAgAFAAbABhAHQAZgBvAHIAbQAgACAASQBkAGUAbgB0AGkAdAB5MBAGA1UdJQQJMAcGBWeBBQgDMFAGA1UdEQEB_wRGMESkQjBAMRYwFAYFZ4EFAgEMC2lkOjQxNEQ0NDAwMQ4wDAYFZ4EFAgIMA0FNRDEWMBQGBWeBBQIDDAtpZDowMDAzMDAwMTAfBgNVHSMEGDAWgBS5sZO0vZWinFrRYD-ePZLA799qMTAdBgNVHQ4EFgQUmy2Muo_fQZp01vcfSXRlP9LQ5l4wgbIGCCsGAQUFBwEBBIGlMIGiMIGfBggrBgEFBQcwAoaBkmh0dHA6Ly9hemNzcHJvZG5jdWFpa3B1Ymxpc2guYmxvYi5jb3JlLndpbmRvd3MubmV0L25jdS1hbWQta2V5aWQtOGEwNTc4Y2Y1NjE0NmZlYTM5OWFmOTAzZmI1YjBhYzM2ZWIyNzg2YS81NDAwMWIyYy1hNmU2LTRmMTYtOWFjNS0wYzZiYmFhOTRjOGMuY2VyMA0GCSqGSIb3DQEBCwUAA4ICAQBjLdWVZ0eBzEVdT1RAVUxyvhmlEQFPxxzzj9fFafB9V9YEZwH2GJ1iOpMjY1TKzkJ27kI4waiA1E5DNY0agngHNBaedvqdFksZU28XfaCtNkQbvR_FOBqtr-MZNfTERfivLTHXgxCALJgL_0FbmTeiJw9vcIvrXwN3y17SG-T7mlzIgWsBPULY57JjBTRaIIcDMysfPi4PQqkneslAXRT--Q0NkV6pG1YTDZayBN0EPnsOXMB2ICPfnJ7ipUjAOiyGa_Go8GsNLlccYi7nS8YvY2SnfjyjQRfVChbAmEUpaWYWk8yZ8TkyVXUYmruPQNfF_V5GNj2wUZPI_BjJ7Es2m1Z7IPDpoMuJiagZv13enjYy6jNygLN33hpB8tpK6uP3W8UHjoN3izI8GpsXwVkiNvZBiYEi1nbZAQSwREr10LBj5XAT3sQ8Q05iNEW6oOW2o_i5Zb_yeMsfyB4C9aM3u-lTaFIWiV7MRNXYBBUorg1dtYnSuVy2BvO00vHNOsXGl_kLaAOn7UNTJfdpXHlBQyDrsp9R4m8N1pJLz6stOQW9cEGYxkSNnhFu-_nixVOFaYzoWCkMhAD9IXRG2vJMuXwD8vBrzcnzJ3UjbFoUGn1kRQXoBRLKgiNfRTUdAhD8Mx7RYNqMDGUMbhTgbMm_A8ZkOh1onCJuoI5SY7G0TVkG7zCCBuswggTToAMCAQICEzMAAAYzhDtjWMyMW-wAAAAABjMwDQYJKoZIhvcNAQELBQAwgYwxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpXYXNoaW5ndG9uMRAwDgYDVQQHEwdSZWRtb25kMR4wHAYDVQQKExVNaWNyb3NvZnQgQ29ycG9yYXRpb24xNjA0BgNVBAMTLU1pY3Jvc29mdCBUUE0gUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkgMjAxNDAeFw0yMTA2MTAxODUyMThaFw0yNzA2MTAxODUyMThaMEExPzA9BgNVBAMTNk5DVS1BTUQtS0VZSUQtOEEwNTc4Q0Y1NjE0NkZFQTM5OUFGOTAzRkI1QjBBQzM2RUIyNzg2QTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAMtiiRvBQra6Yu-Mfcuo4eRfSf5JQfE3mCKDlSOQFGmdbYeIExndRMrxqhCSeN0Sy10v0XIRK7yCikCh2tZHlHpdPnE1M7RXttLRus6EBffEfWH-JPsSKZn1z9KFgOCBjrAqP7rwX4P_WGyNwdWHSfSVw8KCm67bhN6IoVlodg3EV9sOmxU9AxcfYsfSosQVOEhBeYo8MxRB_dULhrqZKETRJN5403TOn6b0VDwtygjBMaoFks7Gpaj22OJ8YhMtD2ZbNnkkgHAL6rdwIQd0ksR7rdrVFKXIuhjLeMHYBs3h6CctyaPVnqfXuNpIKzcBfIT8sqFUsN70dnGVedfA1PJhoLZ6pL8uv_R_TbV9F2QxZ7LHffrnR7x7p3N9bB7gz4uIR5Q7mwUayd8fZ3i4BLEsCfb6awnNUAkSn1-YFg6S1fmR5PuHi1unkMzx52hbtyakXDS9u63QGCAlo8G3n7IDZD30hzQQhLwOIe_cwVxdfCyornEX7AKYAlMDwgyXqrnoQs34M4unXrIAkIcqqhhc4aObrCLVCPn7Ho44EHlNt8wgWPA4JNK_PcEuIXyaYt4IMEgz4k9YCKi8F4HNIObIkTDxk7OiddC3fRdcWeXtVAGXlGsCJixy8bpeLcIgyVIyin2FtNU6GTEr7za6GgQYjTJG9P1PZV0UoMrd8_vHAgMBAAGjggGOMIIBijAOBgNVHQ8BAf8EBAMCAoQwGwYDVR0lBBQwEgYJKwYBBAGCNxUkBgVngQUIAzAWBgNVHSAEDzANMAsGCSsGAQQBgjcVHzASBgNVHRMBAf8ECDAGAQH_AgEAMB0GA1UdDgQWBBS5sZO0vZWinFrRYD-ePZLA799qMTAfBgNVHSMEGDAWgBR6jArOL0hiF-KU0a5VwVLscXSkVjBwBgNVHR8EaTBnMGWgY6Bhhl9odHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20vcGtpb3BzL2NybC9NaWNyb3NvZnQlMjBUUE0lMjBSb290JTIwQ2VydGlmaWNhdGUlMjBBdXRob3JpdHklMjAyMDE0LmNybDB9BggrBgEFBQcBAQRxMG8wbQYIKwYBBQUHMAKGYWh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9wa2lvcHMvY2VydHMvTWljcm9zb2Z0JTIwVFBNJTIwUm9vdCUyMENlcnRpZmljYXRlJTIwQXV0aG9yaXR5JTIwMjAxNC5jcnQwDQYJKoZIhvcNAQELBQADggIBAHY7WQQfcEZx9Auozwthy4DXsd3o_HrxqWlai_W7Hz8ZLuWmiTcPSRRzcHJyKWvVXn7k57kyI9Mn-diMRwOzGMkA2uPTQhbQ4viFDoo35UaI6Cat-oa9TzQ24ayhdeGBlpiOdy7MLfHn_pwPnD8N4xxWikCEtQtPDqLQ8MqFz85U2wJM3WkAM6Lw0qGoeciDt0CRbCs_cPrOdBUCi0gmDNh9ykqCpvYET3c6kOUHBV_afXslRerit2-N43GPLP9nM_5fQ3f_M_AUQmU0zXXpBwmGqy5iGia_BCs8QfVZ2XHnVoIPTn-vZ8gKI1YEFckb3O6O-zh87PnhuhW-ttI4tm9orXVl5LXBniTt_amhmV6Y0mOv4HbQuBCYBQZSM0mx9vu4WEuJkLNm3mUPxhmc2k9ac1fzD5fVNG1drk_4S_F_tQuyWsD5pg-cgnOMc4IHWjwsUrdM6815EnIkXBOkUefT_RwFukAuSiPgKZI3xsxguB22PTkvYgAz2Oerv21RY3cH9rvihblLnAhTco9UMLsr2uyljU3hFuaoQgIeO1HL9stJ50nR7gOCt5am5PHv1H9zVuTUdZsgPndYSOor8c98hCYxEyGkGeIDSecMjKb8lZ2GdixFUhYU6GkVJdfRFVidx2j9f_8faPSwwr56rop5PqquW470jwYdI_qE1D6GZ3B1YkFyZWFZATYAAQALAAYEcgAgnf_L82w4OuaZ-5ho3G3LidcVOIS-KAOSLBJBWL-tIq4AEAAQCAAAAAAAAQDOHY3XwC6PgKLX6N39Al6zP5v_ISOHP2oOZQQtBlY0lnpu79-5JL6fa5ntSsUSZL9JJTAJGCpw2hmGahPQATWNFswVLnslcn2g89cUkU82Eg4DJtW-ArLprmLo9Q53GiHJFtU2cqXFU6QkDWxXhswIs3rM-u6nOPCFjUJ3sj3Nbf9s3JtCE7DqofXi5fEdNMFIk9x-rMpZwMR45itb3hh0CXrDN9zZ1vnJszfcvkPtJBs7MlzfxF_pyrx92z3I0Wf7eRVVbfpj4LKL4IEn8yIrJXp-ROZIP9dQBNmuJ8_ao7jMsVt9Zl-WbwWeqxIx13ZvgTO0xvX_Vr-7LK96KfQ5aGNlcnRJbmZvWKH_VENHgBcAIgAL-NYSfwfy5hKcW4hWT2TiFBdgPIFEp7SqMR8Oyouy0tYAFAXMY6LVU2-C93d1RpcY01e6FDfHAAAAAPZ9WEO-WcZzpKq35AE847UBjyKiiwAiAAtTEaxCM1z69kvpqTqEPaA2moo_JmomCopSZvzX6QaHbwAiAAt0kOPLyV4VuXM7V8WLQdYx1U_zgGiBd-n85Mwc5ACAm2hhdXRoRGF0YVkBZ4hHbR1KvnQ1gf1-vaAt5QBKFeyReXOrVDqDLyzYe24ZRQAAAAAImHBYytxLgbbhMN5Q3L6WACD3NeqCnqpuoqEFn-n7u3l4B2Mb6t7iXPEAYZFZrP6dH6QBAwM5AQAgWQEAzh2N18Auj4Ci1-jd_QJesz-b_yEjhz9qDmUELQZWNJZ6bu_fuSS-n2uZ7UrFEmS_SSUwCRgqcNoZhmoT0AE1jRbMFS57JXJ9oPPXFJFPNhIOAybVvgKy6a5i6PUOdxohyRbVNnKlxVOkJA1sV4bMCLN6zPrupzjwhY1Cd7I9zW3_bNybQhOw6qH14uXxHTTBSJPcfqzKWcDEeOYrW94YdAl6wzfc2db5ybM33L5D7SQbOzJc38Rf6cq8fds9yNFn-3kVVW36Y-Cyi-CBJ_MiKyV6fkTmSD_XUATZrifP2qO4zLFbfWZflm8FnqsSMdd2b4EztMb1_1a_uyyvein0OSFDAQAB';
      const clientDataJSON =
        'eyJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIiwiY2hhbGxlbmdlIjoicFN3QV90TWxiUE1JNmxEY3FkR3ZIeWo1TC1USG5DQlhScFlid294YlBuUC1EZWp5UkNSMmpuTHE5dTZ6N2NwSGFDdVVzc1UzUFJySko5T1NaeHZuX0EiLCJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY3Jvc3NPcmlnaW4iOmZhbHNlfQ';

      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const tf = new TpmFormat();
      tf.config(
        {
          ...attStmt,
        },
        {
          ...result,
          clientDataJSONHash: null,
        } as any,
        {} as any,
        {}
      );

      try {
        const verified = await tf.verify();
        t.fail('not come here');
      } catch (err) {
        t.match(err.message, /Data is not enough/);
      }

      t.end();
    });

    t.test('### alg is undefined', async (t) => {
      const attestationObject =
        'o2NmbXRjdHBtZ2F0dFN0bXSmY2FsZzn__mNzaWdZAQAc4Y6uEaGpi8S3THzR8RlV8gxvIJPcXJppNk2SVhCpxQVf6is0qMk5tRK4ChTB7LZVn3_GbpMVXT4ggZhAQld9aiCAAVyywE6LGh-nGuBzDNJyystxkB51wpBuWU65s0BxtONK2bWvX1nMgUzcyIYyiyfy0Krmn4aOnCF-Idsnz555ezrRp8WjcvTLF0SeagX4s16bTWOaBYqNpDNfYDkOq1aiRNpwzyZpexhRbnszkFp2yq71cOP1U2LB-ShWeiWXIr3LOf5fcjXLVfBqKQuwxM4Fmz1XZ34YeI-xSn1duzLQ0ugnHf9X8XJqr6R340PyT9zYCD_X6eBAgPTyCQzEY3ZlcmMyLjBjeDVjglkFuzCCBbcwggOfoAMCAQICEDro7V5QKkXugEpqXYSheWMwDQYJKoZIhvcNAQELBQAwQTE_MD0GA1UEAxM2TkNVLUFNRC1LRVlJRC04QTA1NzhDRjU2MTQ2RkVBMzk5QUY5MDNGQjVCMEFDMzZFQjI3ODZBMB4XDTIyMDIwNzE3MjQzMVoXDTI3MDYxMDE4NTIxOFowADCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAJWJcBlHvdsGoI9TqkvPgiA--a_GgdPEAPrdtZwklWkABId8rfaTlNKSveR-G-SR13AkccEPVzsvMCDTrhzca7mAZoqr4O2YX0dbwm8EKEkvzc6Wvliil3-EQ0XrzckHdDkHO4goHdT9ap7AA-s-cX2tmgtoyIOLTczoy2Azs1vzqtRGpsWeVpGS5_9eZMX5dsI3TPaQyhZY1OLnAMSySQk4Dz0Hv3pfA9B6QijEawMOn0qeuaLediJQLmLvNT_PXphkKE0qUTt7_PUvRZl29uI7aRGt-UjkAYs6YFLaT6dqnU-9nXjsY1Du8k8yUU_PrL-OjKSwvY84bfyNyqGfBmMCAwEAAaOCAeowggHmMA4GA1UdDwEB_wQEAwIHgDAMBgNVHRMBAf8EAjAAMG0GA1UdIAEB_wRjMGEwXwYJKwYBBAGCNxUfMFIwUAYIKwYBBQUHAgIwRB5CAFQAQwBQAEEAIAAgAFQAcgB1AHMAdABlAGQAIAAgAFAAbABhAHQAZgBvAHIAbQAgACAASQBkAGUAbgB0AGkAdAB5MBAGA1UdJQQJMAcGBWeBBQgDMFAGA1UdEQEB_wRGMESkQjBAMRYwFAYFZ4EFAgEMC2lkOjQxNEQ0NDAwMQ4wDAYFZ4EFAgIMA0FNRDEWMBQGBWeBBQIDDAtpZDowMDAzMDAwMTAfBgNVHSMEGDAWgBS5sZO0vZWinFrRYD-ePZLA799qMTAdBgNVHQ4EFgQUmy2Muo_fQZp01vcfSXRlP9LQ5l4wgbIGCCsGAQUFBwEBBIGlMIGiMIGfBggrBgEFBQcwAoaBkmh0dHA6Ly9hemNzcHJvZG5jdWFpa3B1Ymxpc2guYmxvYi5jb3JlLndpbmRvd3MubmV0L25jdS1hbWQta2V5aWQtOGEwNTc4Y2Y1NjE0NmZlYTM5OWFmOTAzZmI1YjBhYzM2ZWIyNzg2YS81NDAwMWIyYy1hNmU2LTRmMTYtOWFjNS0wYzZiYmFhOTRjOGMuY2VyMA0GCSqGSIb3DQEBCwUAA4ICAQBjLdWVZ0eBzEVdT1RAVUxyvhmlEQFPxxzzj9fFafB9V9YEZwH2GJ1iOpMjY1TKzkJ27kI4waiA1E5DNY0agngHNBaedvqdFksZU28XfaCtNkQbvR_FOBqtr-MZNfTERfivLTHXgxCALJgL_0FbmTeiJw9vcIvrXwN3y17SG-T7mlzIgWsBPULY57JjBTRaIIcDMysfPi4PQqkneslAXRT--Q0NkV6pG1YTDZayBN0EPnsOXMB2ICPfnJ7ipUjAOiyGa_Go8GsNLlccYi7nS8YvY2SnfjyjQRfVChbAmEUpaWYWk8yZ8TkyVXUYmruPQNfF_V5GNj2wUZPI_BjJ7Es2m1Z7IPDpoMuJiagZv13enjYy6jNygLN33hpB8tpK6uP3W8UHjoN3izI8GpsXwVkiNvZBiYEi1nbZAQSwREr10LBj5XAT3sQ8Q05iNEW6oOW2o_i5Zb_yeMsfyB4C9aM3u-lTaFIWiV7MRNXYBBUorg1dtYnSuVy2BvO00vHNOsXGl_kLaAOn7UNTJfdpXHlBQyDrsp9R4m8N1pJLz6stOQW9cEGYxkSNnhFu-_nixVOFaYzoWCkMhAD9IXRG2vJMuXwD8vBrzcnzJ3UjbFoUGn1kRQXoBRLKgiNfRTUdAhD8Mx7RYNqMDGUMbhTgbMm_A8ZkOh1onCJuoI5SY7G0TVkG7zCCBuswggTToAMCAQICEzMAAAYzhDtjWMyMW-wAAAAABjMwDQYJKoZIhvcNAQELBQAwgYwxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpXYXNoaW5ndG9uMRAwDgYDVQQHEwdSZWRtb25kMR4wHAYDVQQKExVNaWNyb3NvZnQgQ29ycG9yYXRpb24xNjA0BgNVBAMTLU1pY3Jvc29mdCBUUE0gUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkgMjAxNDAeFw0yMTA2MTAxODUyMThaFw0yNzA2MTAxODUyMThaMEExPzA9BgNVBAMTNk5DVS1BTUQtS0VZSUQtOEEwNTc4Q0Y1NjE0NkZFQTM5OUFGOTAzRkI1QjBBQzM2RUIyNzg2QTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAMtiiRvBQra6Yu-Mfcuo4eRfSf5JQfE3mCKDlSOQFGmdbYeIExndRMrxqhCSeN0Sy10v0XIRK7yCikCh2tZHlHpdPnE1M7RXttLRus6EBffEfWH-JPsSKZn1z9KFgOCBjrAqP7rwX4P_WGyNwdWHSfSVw8KCm67bhN6IoVlodg3EV9sOmxU9AxcfYsfSosQVOEhBeYo8MxRB_dULhrqZKETRJN5403TOn6b0VDwtygjBMaoFks7Gpaj22OJ8YhMtD2ZbNnkkgHAL6rdwIQd0ksR7rdrVFKXIuhjLeMHYBs3h6CctyaPVnqfXuNpIKzcBfIT8sqFUsN70dnGVedfA1PJhoLZ6pL8uv_R_TbV9F2QxZ7LHffrnR7x7p3N9bB7gz4uIR5Q7mwUayd8fZ3i4BLEsCfb6awnNUAkSn1-YFg6S1fmR5PuHi1unkMzx52hbtyakXDS9u63QGCAlo8G3n7IDZD30hzQQhLwOIe_cwVxdfCyornEX7AKYAlMDwgyXqrnoQs34M4unXrIAkIcqqhhc4aObrCLVCPn7Ho44EHlNt8wgWPA4JNK_PcEuIXyaYt4IMEgz4k9YCKi8F4HNIObIkTDxk7OiddC3fRdcWeXtVAGXlGsCJixy8bpeLcIgyVIyin2FtNU6GTEr7za6GgQYjTJG9P1PZV0UoMrd8_vHAgMBAAGjggGOMIIBijAOBgNVHQ8BAf8EBAMCAoQwGwYDVR0lBBQwEgYJKwYBBAGCNxUkBgVngQUIAzAWBgNVHSAEDzANMAsGCSsGAQQBgjcVHzASBgNVHRMBAf8ECDAGAQH_AgEAMB0GA1UdDgQWBBS5sZO0vZWinFrRYD-ePZLA799qMTAfBgNVHSMEGDAWgBR6jArOL0hiF-KU0a5VwVLscXSkVjBwBgNVHR8EaTBnMGWgY6Bhhl9odHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20vcGtpb3BzL2NybC9NaWNyb3NvZnQlMjBUUE0lMjBSb290JTIwQ2VydGlmaWNhdGUlMjBBdXRob3JpdHklMjAyMDE0LmNybDB9BggrBgEFBQcBAQRxMG8wbQYIKwYBBQUHMAKGYWh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9wa2lvcHMvY2VydHMvTWljcm9zb2Z0JTIwVFBNJTIwUm9vdCUyMENlcnRpZmljYXRlJTIwQXV0aG9yaXR5JTIwMjAxNC5jcnQwDQYJKoZIhvcNAQELBQADggIBAHY7WQQfcEZx9Auozwthy4DXsd3o_HrxqWlai_W7Hz8ZLuWmiTcPSRRzcHJyKWvVXn7k57kyI9Mn-diMRwOzGMkA2uPTQhbQ4viFDoo35UaI6Cat-oa9TzQ24ayhdeGBlpiOdy7MLfHn_pwPnD8N4xxWikCEtQtPDqLQ8MqFz85U2wJM3WkAM6Lw0qGoeciDt0CRbCs_cPrOdBUCi0gmDNh9ykqCpvYET3c6kOUHBV_afXslRerit2-N43GPLP9nM_5fQ3f_M_AUQmU0zXXpBwmGqy5iGia_BCs8QfVZ2XHnVoIPTn-vZ8gKI1YEFckb3O6O-zh87PnhuhW-ttI4tm9orXVl5LXBniTt_amhmV6Y0mOv4HbQuBCYBQZSM0mx9vu4WEuJkLNm3mUPxhmc2k9ac1fzD5fVNG1drk_4S_F_tQuyWsD5pg-cgnOMc4IHWjwsUrdM6815EnIkXBOkUefT_RwFukAuSiPgKZI3xsxguB22PTkvYgAz2Oerv21RY3cH9rvihblLnAhTco9UMLsr2uyljU3hFuaoQgIeO1HL9stJ50nR7gOCt5am5PHv1H9zVuTUdZsgPndYSOor8c98hCYxEyGkGeIDSecMjKb8lZ2GdixFUhYU6GkVJdfRFVidx2j9f_8faPSwwr56rop5PqquW470jwYdI_qE1D6GZ3B1YkFyZWFZATYAAQALAAYEcgAgnf_L82w4OuaZ-5ho3G3LidcVOIS-KAOSLBJBWL-tIq4AEAAQCAAAAAAAAQDOHY3XwC6PgKLX6N39Al6zP5v_ISOHP2oOZQQtBlY0lnpu79-5JL6fa5ntSsUSZL9JJTAJGCpw2hmGahPQATWNFswVLnslcn2g89cUkU82Eg4DJtW-ArLprmLo9Q53GiHJFtU2cqXFU6QkDWxXhswIs3rM-u6nOPCFjUJ3sj3Nbf9s3JtCE7DqofXi5fEdNMFIk9x-rMpZwMR45itb3hh0CXrDN9zZ1vnJszfcvkPtJBs7MlzfxF_pyrx92z3I0Wf7eRVVbfpj4LKL4IEn8yIrJXp-ROZIP9dQBNmuJ8_ao7jMsVt9Zl-WbwWeqxIx13ZvgTO0xvX_Vr-7LK96KfQ5aGNlcnRJbmZvWKH_VENHgBcAIgAL-NYSfwfy5hKcW4hWT2TiFBdgPIFEp7SqMR8Oyouy0tYAFAXMY6LVU2-C93d1RpcY01e6FDfHAAAAAPZ9WEO-WcZzpKq35AE847UBjyKiiwAiAAtTEaxCM1z69kvpqTqEPaA2moo_JmomCopSZvzX6QaHbwAiAAt0kOPLyV4VuXM7V8WLQdYx1U_zgGiBd-n85Mwc5ACAm2hhdXRoRGF0YVkBZ4hHbR1KvnQ1gf1-vaAt5QBKFeyReXOrVDqDLyzYe24ZRQAAAAAImHBYytxLgbbhMN5Q3L6WACD3NeqCnqpuoqEFn-n7u3l4B2Mb6t7iXPEAYZFZrP6dH6QBAwM5AQAgWQEAzh2N18Auj4Ci1-jd_QJesz-b_yEjhz9qDmUELQZWNJZ6bu_fuSS-n2uZ7UrFEmS_SSUwCRgqcNoZhmoT0AE1jRbMFS57JXJ9oPPXFJFPNhIOAybVvgKy6a5i6PUOdxohyRbVNnKlxVOkJA1sV4bMCLN6zPrupzjwhY1Cd7I9zW3_bNybQhOw6qH14uXxHTTBSJPcfqzKWcDEeOYrW94YdAl6wzfc2db5ybM33L5D7SQbOzJc38Rf6cq8fds9yNFn-3kVVW36Y-Cyi-CBJ_MiKyV6fkTmSD_XUATZrifP2qO4zLFbfWZflm8FnqsSMdd2b4EztMb1_1a_uyyvein0OSFDAQAB';
      const clientDataJSON =
        'eyJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIiwiY2hhbGxlbmdlIjoicFN3QV90TWxiUE1JNmxEY3FkR3ZIeWo1TC1USG5DQlhScFlid294YlBuUC1EZWp5UkNSMmpuTHE5dTZ6N2NwSGFDdVVzc1UzUFJySko5T1NaeHZuX0EiLCJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY3Jvc3NPcmlnaW4iOmZhbHNlfQ';

      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const tf = new TpmFormat();
      tf.config(
        {
          ...attStmt,
          alg: undefined,
        },
        {
          ...result,
        } as any,
        {} as any,
        {}
      );

      try {
        const verified = await tf.verify();
        t.fail('not come here');
      } catch (err) {
        t.match(err.message, /Data is not enough/);
      }

      t.end();
    });

    t.test('### alg is not valid', async (t) => {
      const attestationObject =
        'o2NmbXRjdHBtZ2F0dFN0bXSmY2FsZzn__mNzaWdZAQAc4Y6uEaGpi8S3THzR8RlV8gxvIJPcXJppNk2SVhCpxQVf6is0qMk5tRK4ChTB7LZVn3_GbpMVXT4ggZhAQld9aiCAAVyywE6LGh-nGuBzDNJyystxkB51wpBuWU65s0BxtONK2bWvX1nMgUzcyIYyiyfy0Krmn4aOnCF-Idsnz555ezrRp8WjcvTLF0SeagX4s16bTWOaBYqNpDNfYDkOq1aiRNpwzyZpexhRbnszkFp2yq71cOP1U2LB-ShWeiWXIr3LOf5fcjXLVfBqKQuwxM4Fmz1XZ34YeI-xSn1duzLQ0ugnHf9X8XJqr6R340PyT9zYCD_X6eBAgPTyCQzEY3ZlcmMyLjBjeDVjglkFuzCCBbcwggOfoAMCAQICEDro7V5QKkXugEpqXYSheWMwDQYJKoZIhvcNAQELBQAwQTE_MD0GA1UEAxM2TkNVLUFNRC1LRVlJRC04QTA1NzhDRjU2MTQ2RkVBMzk5QUY5MDNGQjVCMEFDMzZFQjI3ODZBMB4XDTIyMDIwNzE3MjQzMVoXDTI3MDYxMDE4NTIxOFowADCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAJWJcBlHvdsGoI9TqkvPgiA--a_GgdPEAPrdtZwklWkABId8rfaTlNKSveR-G-SR13AkccEPVzsvMCDTrhzca7mAZoqr4O2YX0dbwm8EKEkvzc6Wvliil3-EQ0XrzckHdDkHO4goHdT9ap7AA-s-cX2tmgtoyIOLTczoy2Azs1vzqtRGpsWeVpGS5_9eZMX5dsI3TPaQyhZY1OLnAMSySQk4Dz0Hv3pfA9B6QijEawMOn0qeuaLediJQLmLvNT_PXphkKE0qUTt7_PUvRZl29uI7aRGt-UjkAYs6YFLaT6dqnU-9nXjsY1Du8k8yUU_PrL-OjKSwvY84bfyNyqGfBmMCAwEAAaOCAeowggHmMA4GA1UdDwEB_wQEAwIHgDAMBgNVHRMBAf8EAjAAMG0GA1UdIAEB_wRjMGEwXwYJKwYBBAGCNxUfMFIwUAYIKwYBBQUHAgIwRB5CAFQAQwBQAEEAIAAgAFQAcgB1AHMAdABlAGQAIAAgAFAAbABhAHQAZgBvAHIAbQAgACAASQBkAGUAbgB0AGkAdAB5MBAGA1UdJQQJMAcGBWeBBQgDMFAGA1UdEQEB_wRGMESkQjBAMRYwFAYFZ4EFAgEMC2lkOjQxNEQ0NDAwMQ4wDAYFZ4EFAgIMA0FNRDEWMBQGBWeBBQIDDAtpZDowMDAzMDAwMTAfBgNVHSMEGDAWgBS5sZO0vZWinFrRYD-ePZLA799qMTAdBgNVHQ4EFgQUmy2Muo_fQZp01vcfSXRlP9LQ5l4wgbIGCCsGAQUFBwEBBIGlMIGiMIGfBggrBgEFBQcwAoaBkmh0dHA6Ly9hemNzcHJvZG5jdWFpa3B1Ymxpc2guYmxvYi5jb3JlLndpbmRvd3MubmV0L25jdS1hbWQta2V5aWQtOGEwNTc4Y2Y1NjE0NmZlYTM5OWFmOTAzZmI1YjBhYzM2ZWIyNzg2YS81NDAwMWIyYy1hNmU2LTRmMTYtOWFjNS0wYzZiYmFhOTRjOGMuY2VyMA0GCSqGSIb3DQEBCwUAA4ICAQBjLdWVZ0eBzEVdT1RAVUxyvhmlEQFPxxzzj9fFafB9V9YEZwH2GJ1iOpMjY1TKzkJ27kI4waiA1E5DNY0agngHNBaedvqdFksZU28XfaCtNkQbvR_FOBqtr-MZNfTERfivLTHXgxCALJgL_0FbmTeiJw9vcIvrXwN3y17SG-T7mlzIgWsBPULY57JjBTRaIIcDMysfPi4PQqkneslAXRT--Q0NkV6pG1YTDZayBN0EPnsOXMB2ICPfnJ7ipUjAOiyGa_Go8GsNLlccYi7nS8YvY2SnfjyjQRfVChbAmEUpaWYWk8yZ8TkyVXUYmruPQNfF_V5GNj2wUZPI_BjJ7Es2m1Z7IPDpoMuJiagZv13enjYy6jNygLN33hpB8tpK6uP3W8UHjoN3izI8GpsXwVkiNvZBiYEi1nbZAQSwREr10LBj5XAT3sQ8Q05iNEW6oOW2o_i5Zb_yeMsfyB4C9aM3u-lTaFIWiV7MRNXYBBUorg1dtYnSuVy2BvO00vHNOsXGl_kLaAOn7UNTJfdpXHlBQyDrsp9R4m8N1pJLz6stOQW9cEGYxkSNnhFu-_nixVOFaYzoWCkMhAD9IXRG2vJMuXwD8vBrzcnzJ3UjbFoUGn1kRQXoBRLKgiNfRTUdAhD8Mx7RYNqMDGUMbhTgbMm_A8ZkOh1onCJuoI5SY7G0TVkG7zCCBuswggTToAMCAQICEzMAAAYzhDtjWMyMW-wAAAAABjMwDQYJKoZIhvcNAQELBQAwgYwxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpXYXNoaW5ndG9uMRAwDgYDVQQHEwdSZWRtb25kMR4wHAYDVQQKExVNaWNyb3NvZnQgQ29ycG9yYXRpb24xNjA0BgNVBAMTLU1pY3Jvc29mdCBUUE0gUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkgMjAxNDAeFw0yMTA2MTAxODUyMThaFw0yNzA2MTAxODUyMThaMEExPzA9BgNVBAMTNk5DVS1BTUQtS0VZSUQtOEEwNTc4Q0Y1NjE0NkZFQTM5OUFGOTAzRkI1QjBBQzM2RUIyNzg2QTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAMtiiRvBQra6Yu-Mfcuo4eRfSf5JQfE3mCKDlSOQFGmdbYeIExndRMrxqhCSeN0Sy10v0XIRK7yCikCh2tZHlHpdPnE1M7RXttLRus6EBffEfWH-JPsSKZn1z9KFgOCBjrAqP7rwX4P_WGyNwdWHSfSVw8KCm67bhN6IoVlodg3EV9sOmxU9AxcfYsfSosQVOEhBeYo8MxRB_dULhrqZKETRJN5403TOn6b0VDwtygjBMaoFks7Gpaj22OJ8YhMtD2ZbNnkkgHAL6rdwIQd0ksR7rdrVFKXIuhjLeMHYBs3h6CctyaPVnqfXuNpIKzcBfIT8sqFUsN70dnGVedfA1PJhoLZ6pL8uv_R_TbV9F2QxZ7LHffrnR7x7p3N9bB7gz4uIR5Q7mwUayd8fZ3i4BLEsCfb6awnNUAkSn1-YFg6S1fmR5PuHi1unkMzx52hbtyakXDS9u63QGCAlo8G3n7IDZD30hzQQhLwOIe_cwVxdfCyornEX7AKYAlMDwgyXqrnoQs34M4unXrIAkIcqqhhc4aObrCLVCPn7Ho44EHlNt8wgWPA4JNK_PcEuIXyaYt4IMEgz4k9YCKi8F4HNIObIkTDxk7OiddC3fRdcWeXtVAGXlGsCJixy8bpeLcIgyVIyin2FtNU6GTEr7za6GgQYjTJG9P1PZV0UoMrd8_vHAgMBAAGjggGOMIIBijAOBgNVHQ8BAf8EBAMCAoQwGwYDVR0lBBQwEgYJKwYBBAGCNxUkBgVngQUIAzAWBgNVHSAEDzANMAsGCSsGAQQBgjcVHzASBgNVHRMBAf8ECDAGAQH_AgEAMB0GA1UdDgQWBBS5sZO0vZWinFrRYD-ePZLA799qMTAfBgNVHSMEGDAWgBR6jArOL0hiF-KU0a5VwVLscXSkVjBwBgNVHR8EaTBnMGWgY6Bhhl9odHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20vcGtpb3BzL2NybC9NaWNyb3NvZnQlMjBUUE0lMjBSb290JTIwQ2VydGlmaWNhdGUlMjBBdXRob3JpdHklMjAyMDE0LmNybDB9BggrBgEFBQcBAQRxMG8wbQYIKwYBBQUHMAKGYWh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9wa2lvcHMvY2VydHMvTWljcm9zb2Z0JTIwVFBNJTIwUm9vdCUyMENlcnRpZmljYXRlJTIwQXV0aG9yaXR5JTIwMjAxNC5jcnQwDQYJKoZIhvcNAQELBQADggIBAHY7WQQfcEZx9Auozwthy4DXsd3o_HrxqWlai_W7Hz8ZLuWmiTcPSRRzcHJyKWvVXn7k57kyI9Mn-diMRwOzGMkA2uPTQhbQ4viFDoo35UaI6Cat-oa9TzQ24ayhdeGBlpiOdy7MLfHn_pwPnD8N4xxWikCEtQtPDqLQ8MqFz85U2wJM3WkAM6Lw0qGoeciDt0CRbCs_cPrOdBUCi0gmDNh9ykqCpvYET3c6kOUHBV_afXslRerit2-N43GPLP9nM_5fQ3f_M_AUQmU0zXXpBwmGqy5iGia_BCs8QfVZ2XHnVoIPTn-vZ8gKI1YEFckb3O6O-zh87PnhuhW-ttI4tm9orXVl5LXBniTt_amhmV6Y0mOv4HbQuBCYBQZSM0mx9vu4WEuJkLNm3mUPxhmc2k9ac1fzD5fVNG1drk_4S_F_tQuyWsD5pg-cgnOMc4IHWjwsUrdM6815EnIkXBOkUefT_RwFukAuSiPgKZI3xsxguB22PTkvYgAz2Oerv21RY3cH9rvihblLnAhTco9UMLsr2uyljU3hFuaoQgIeO1HL9stJ50nR7gOCt5am5PHv1H9zVuTUdZsgPndYSOor8c98hCYxEyGkGeIDSecMjKb8lZ2GdixFUhYU6GkVJdfRFVidx2j9f_8faPSwwr56rop5PqquW470jwYdI_qE1D6GZ3B1YkFyZWFZATYAAQALAAYEcgAgnf_L82w4OuaZ-5ho3G3LidcVOIS-KAOSLBJBWL-tIq4AEAAQCAAAAAAAAQDOHY3XwC6PgKLX6N39Al6zP5v_ISOHP2oOZQQtBlY0lnpu79-5JL6fa5ntSsUSZL9JJTAJGCpw2hmGahPQATWNFswVLnslcn2g89cUkU82Eg4DJtW-ArLprmLo9Q53GiHJFtU2cqXFU6QkDWxXhswIs3rM-u6nOPCFjUJ3sj3Nbf9s3JtCE7DqofXi5fEdNMFIk9x-rMpZwMR45itb3hh0CXrDN9zZ1vnJszfcvkPtJBs7MlzfxF_pyrx92z3I0Wf7eRVVbfpj4LKL4IEn8yIrJXp-ROZIP9dQBNmuJ8_ao7jMsVt9Zl-WbwWeqxIx13ZvgTO0xvX_Vr-7LK96KfQ5aGNlcnRJbmZvWKH_VENHgBcAIgAL-NYSfwfy5hKcW4hWT2TiFBdgPIFEp7SqMR8Oyouy0tYAFAXMY6LVU2-C93d1RpcY01e6FDfHAAAAAPZ9WEO-WcZzpKq35AE847UBjyKiiwAiAAtTEaxCM1z69kvpqTqEPaA2moo_JmomCopSZvzX6QaHbwAiAAt0kOPLyV4VuXM7V8WLQdYx1U_zgGiBd-n85Mwc5ACAm2hhdXRoRGF0YVkBZ4hHbR1KvnQ1gf1-vaAt5QBKFeyReXOrVDqDLyzYe24ZRQAAAAAImHBYytxLgbbhMN5Q3L6WACD3NeqCnqpuoqEFn-n7u3l4B2Mb6t7iXPEAYZFZrP6dH6QBAwM5AQAgWQEAzh2N18Auj4Ci1-jd_QJesz-b_yEjhz9qDmUELQZWNJZ6bu_fuSS-n2uZ7UrFEmS_SSUwCRgqcNoZhmoT0AE1jRbMFS57JXJ9oPPXFJFPNhIOAybVvgKy6a5i6PUOdxohyRbVNnKlxVOkJA1sV4bMCLN6zPrupzjwhY1Cd7I9zW3_bNybQhOw6qH14uXxHTTBSJPcfqzKWcDEeOYrW94YdAl6wzfc2db5ybM33L5D7SQbOzJc38Rf6cq8fds9yNFn-3kVVW36Y-Cyi-CBJ_MiKyV6fkTmSD_XUATZrifP2qO4zLFbfWZflm8FnqsSMdd2b4EztMb1_1a_uyyvein0OSFDAQAB';
      const clientDataJSON =
        'eyJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIiwiY2hhbGxlbmdlIjoicFN3QV90TWxiUE1JNmxEY3FkR3ZIeWo1TC1USG5DQlhScFlid294YlBuUC1EZWp5UkNSMmpuTHE5dTZ6N2NwSGFDdVVzc1UzUFJySko5T1NaeHZuX0EiLCJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY3Jvc3NPcmlnaW4iOmZhbHNlfQ';

      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const tf = new TpmFormat();
      tf.config(
        {
          ...attStmt,
          alg: 10000000,
        },
        {
          ...result,
        } as any,
        {} as any,
        {}
      );

      try {
        const verified = await tf.verify();
        t.fail('not come here');
      } catch (err) {
        t.match(err.message, /Cannot convert to COSE Algorithm/);
      }

      t.end();
    });

    t.test('### x5c is null', async (t) => {
      const attestationObject =
        'o2NmbXRjdHBtZ2F0dFN0bXSmY2FsZzn__mNzaWdZAQAc4Y6uEaGpi8S3THzR8RlV8gxvIJPcXJppNk2SVhCpxQVf6is0qMk5tRK4ChTB7LZVn3_GbpMVXT4ggZhAQld9aiCAAVyywE6LGh-nGuBzDNJyystxkB51wpBuWU65s0BxtONK2bWvX1nMgUzcyIYyiyfy0Krmn4aOnCF-Idsnz555ezrRp8WjcvTLF0SeagX4s16bTWOaBYqNpDNfYDkOq1aiRNpwzyZpexhRbnszkFp2yq71cOP1U2LB-ShWeiWXIr3LOf5fcjXLVfBqKQuwxM4Fmz1XZ34YeI-xSn1duzLQ0ugnHf9X8XJqr6R340PyT9zYCD_X6eBAgPTyCQzEY3ZlcmMyLjBjeDVjglkFuzCCBbcwggOfoAMCAQICEDro7V5QKkXugEpqXYSheWMwDQYJKoZIhvcNAQELBQAwQTE_MD0GA1UEAxM2TkNVLUFNRC1LRVlJRC04QTA1NzhDRjU2MTQ2RkVBMzk5QUY5MDNGQjVCMEFDMzZFQjI3ODZBMB4XDTIyMDIwNzE3MjQzMVoXDTI3MDYxMDE4NTIxOFowADCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAJWJcBlHvdsGoI9TqkvPgiA--a_GgdPEAPrdtZwklWkABId8rfaTlNKSveR-G-SR13AkccEPVzsvMCDTrhzca7mAZoqr4O2YX0dbwm8EKEkvzc6Wvliil3-EQ0XrzckHdDkHO4goHdT9ap7AA-s-cX2tmgtoyIOLTczoy2Azs1vzqtRGpsWeVpGS5_9eZMX5dsI3TPaQyhZY1OLnAMSySQk4Dz0Hv3pfA9B6QijEawMOn0qeuaLediJQLmLvNT_PXphkKE0qUTt7_PUvRZl29uI7aRGt-UjkAYs6YFLaT6dqnU-9nXjsY1Du8k8yUU_PrL-OjKSwvY84bfyNyqGfBmMCAwEAAaOCAeowggHmMA4GA1UdDwEB_wQEAwIHgDAMBgNVHRMBAf8EAjAAMG0GA1UdIAEB_wRjMGEwXwYJKwYBBAGCNxUfMFIwUAYIKwYBBQUHAgIwRB5CAFQAQwBQAEEAIAAgAFQAcgB1AHMAdABlAGQAIAAgAFAAbABhAHQAZgBvAHIAbQAgACAASQBkAGUAbgB0AGkAdAB5MBAGA1UdJQQJMAcGBWeBBQgDMFAGA1UdEQEB_wRGMESkQjBAMRYwFAYFZ4EFAgEMC2lkOjQxNEQ0NDAwMQ4wDAYFZ4EFAgIMA0FNRDEWMBQGBWeBBQIDDAtpZDowMDAzMDAwMTAfBgNVHSMEGDAWgBS5sZO0vZWinFrRYD-ePZLA799qMTAdBgNVHQ4EFgQUmy2Muo_fQZp01vcfSXRlP9LQ5l4wgbIGCCsGAQUFBwEBBIGlMIGiMIGfBggrBgEFBQcwAoaBkmh0dHA6Ly9hemNzcHJvZG5jdWFpa3B1Ymxpc2guYmxvYi5jb3JlLndpbmRvd3MubmV0L25jdS1hbWQta2V5aWQtOGEwNTc4Y2Y1NjE0NmZlYTM5OWFmOTAzZmI1YjBhYzM2ZWIyNzg2YS81NDAwMWIyYy1hNmU2LTRmMTYtOWFjNS0wYzZiYmFhOTRjOGMuY2VyMA0GCSqGSIb3DQEBCwUAA4ICAQBjLdWVZ0eBzEVdT1RAVUxyvhmlEQFPxxzzj9fFafB9V9YEZwH2GJ1iOpMjY1TKzkJ27kI4waiA1E5DNY0agngHNBaedvqdFksZU28XfaCtNkQbvR_FOBqtr-MZNfTERfivLTHXgxCALJgL_0FbmTeiJw9vcIvrXwN3y17SG-T7mlzIgWsBPULY57JjBTRaIIcDMysfPi4PQqkneslAXRT--Q0NkV6pG1YTDZayBN0EPnsOXMB2ICPfnJ7ipUjAOiyGa_Go8GsNLlccYi7nS8YvY2SnfjyjQRfVChbAmEUpaWYWk8yZ8TkyVXUYmruPQNfF_V5GNj2wUZPI_BjJ7Es2m1Z7IPDpoMuJiagZv13enjYy6jNygLN33hpB8tpK6uP3W8UHjoN3izI8GpsXwVkiNvZBiYEi1nbZAQSwREr10LBj5XAT3sQ8Q05iNEW6oOW2o_i5Zb_yeMsfyB4C9aM3u-lTaFIWiV7MRNXYBBUorg1dtYnSuVy2BvO00vHNOsXGl_kLaAOn7UNTJfdpXHlBQyDrsp9R4m8N1pJLz6stOQW9cEGYxkSNnhFu-_nixVOFaYzoWCkMhAD9IXRG2vJMuXwD8vBrzcnzJ3UjbFoUGn1kRQXoBRLKgiNfRTUdAhD8Mx7RYNqMDGUMbhTgbMm_A8ZkOh1onCJuoI5SY7G0TVkG7zCCBuswggTToAMCAQICEzMAAAYzhDtjWMyMW-wAAAAABjMwDQYJKoZIhvcNAQELBQAwgYwxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpXYXNoaW5ndG9uMRAwDgYDVQQHEwdSZWRtb25kMR4wHAYDVQQKExVNaWNyb3NvZnQgQ29ycG9yYXRpb24xNjA0BgNVBAMTLU1pY3Jvc29mdCBUUE0gUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkgMjAxNDAeFw0yMTA2MTAxODUyMThaFw0yNzA2MTAxODUyMThaMEExPzA9BgNVBAMTNk5DVS1BTUQtS0VZSUQtOEEwNTc4Q0Y1NjE0NkZFQTM5OUFGOTAzRkI1QjBBQzM2RUIyNzg2QTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAMtiiRvBQra6Yu-Mfcuo4eRfSf5JQfE3mCKDlSOQFGmdbYeIExndRMrxqhCSeN0Sy10v0XIRK7yCikCh2tZHlHpdPnE1M7RXttLRus6EBffEfWH-JPsSKZn1z9KFgOCBjrAqP7rwX4P_WGyNwdWHSfSVw8KCm67bhN6IoVlodg3EV9sOmxU9AxcfYsfSosQVOEhBeYo8MxRB_dULhrqZKETRJN5403TOn6b0VDwtygjBMaoFks7Gpaj22OJ8YhMtD2ZbNnkkgHAL6rdwIQd0ksR7rdrVFKXIuhjLeMHYBs3h6CctyaPVnqfXuNpIKzcBfIT8sqFUsN70dnGVedfA1PJhoLZ6pL8uv_R_TbV9F2QxZ7LHffrnR7x7p3N9bB7gz4uIR5Q7mwUayd8fZ3i4BLEsCfb6awnNUAkSn1-YFg6S1fmR5PuHi1unkMzx52hbtyakXDS9u63QGCAlo8G3n7IDZD30hzQQhLwOIe_cwVxdfCyornEX7AKYAlMDwgyXqrnoQs34M4unXrIAkIcqqhhc4aObrCLVCPn7Ho44EHlNt8wgWPA4JNK_PcEuIXyaYt4IMEgz4k9YCKi8F4HNIObIkTDxk7OiddC3fRdcWeXtVAGXlGsCJixy8bpeLcIgyVIyin2FtNU6GTEr7za6GgQYjTJG9P1PZV0UoMrd8_vHAgMBAAGjggGOMIIBijAOBgNVHQ8BAf8EBAMCAoQwGwYDVR0lBBQwEgYJKwYBBAGCNxUkBgVngQUIAzAWBgNVHSAEDzANMAsGCSsGAQQBgjcVHzASBgNVHRMBAf8ECDAGAQH_AgEAMB0GA1UdDgQWBBS5sZO0vZWinFrRYD-ePZLA799qMTAfBgNVHSMEGDAWgBR6jArOL0hiF-KU0a5VwVLscXSkVjBwBgNVHR8EaTBnMGWgY6Bhhl9odHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20vcGtpb3BzL2NybC9NaWNyb3NvZnQlMjBUUE0lMjBSb290JTIwQ2VydGlmaWNhdGUlMjBBdXRob3JpdHklMjAyMDE0LmNybDB9BggrBgEFBQcBAQRxMG8wbQYIKwYBBQUHMAKGYWh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9wa2lvcHMvY2VydHMvTWljcm9zb2Z0JTIwVFBNJTIwUm9vdCUyMENlcnRpZmljYXRlJTIwQXV0aG9yaXR5JTIwMjAxNC5jcnQwDQYJKoZIhvcNAQELBQADggIBAHY7WQQfcEZx9Auozwthy4DXsd3o_HrxqWlai_W7Hz8ZLuWmiTcPSRRzcHJyKWvVXn7k57kyI9Mn-diMRwOzGMkA2uPTQhbQ4viFDoo35UaI6Cat-oa9TzQ24ayhdeGBlpiOdy7MLfHn_pwPnD8N4xxWikCEtQtPDqLQ8MqFz85U2wJM3WkAM6Lw0qGoeciDt0CRbCs_cPrOdBUCi0gmDNh9ykqCpvYET3c6kOUHBV_afXslRerit2-N43GPLP9nM_5fQ3f_M_AUQmU0zXXpBwmGqy5iGia_BCs8QfVZ2XHnVoIPTn-vZ8gKI1YEFckb3O6O-zh87PnhuhW-ttI4tm9orXVl5LXBniTt_amhmV6Y0mOv4HbQuBCYBQZSM0mx9vu4WEuJkLNm3mUPxhmc2k9ac1fzD5fVNG1drk_4S_F_tQuyWsD5pg-cgnOMc4IHWjwsUrdM6815EnIkXBOkUefT_RwFukAuSiPgKZI3xsxguB22PTkvYgAz2Oerv21RY3cH9rvihblLnAhTco9UMLsr2uyljU3hFuaoQgIeO1HL9stJ50nR7gOCt5am5PHv1H9zVuTUdZsgPndYSOor8c98hCYxEyGkGeIDSecMjKb8lZ2GdixFUhYU6GkVJdfRFVidx2j9f_8faPSwwr56rop5PqquW470jwYdI_qE1D6GZ3B1YkFyZWFZATYAAQALAAYEcgAgnf_L82w4OuaZ-5ho3G3LidcVOIS-KAOSLBJBWL-tIq4AEAAQCAAAAAAAAQDOHY3XwC6PgKLX6N39Al6zP5v_ISOHP2oOZQQtBlY0lnpu79-5JL6fa5ntSsUSZL9JJTAJGCpw2hmGahPQATWNFswVLnslcn2g89cUkU82Eg4DJtW-ArLprmLo9Q53GiHJFtU2cqXFU6QkDWxXhswIs3rM-u6nOPCFjUJ3sj3Nbf9s3JtCE7DqofXi5fEdNMFIk9x-rMpZwMR45itb3hh0CXrDN9zZ1vnJszfcvkPtJBs7MlzfxF_pyrx92z3I0Wf7eRVVbfpj4LKL4IEn8yIrJXp-ROZIP9dQBNmuJ8_ao7jMsVt9Zl-WbwWeqxIx13ZvgTO0xvX_Vr-7LK96KfQ5aGNlcnRJbmZvWKH_VENHgBcAIgAL-NYSfwfy5hKcW4hWT2TiFBdgPIFEp7SqMR8Oyouy0tYAFAXMY6LVU2-C93d1RpcY01e6FDfHAAAAAPZ9WEO-WcZzpKq35AE847UBjyKiiwAiAAtTEaxCM1z69kvpqTqEPaA2moo_JmomCopSZvzX6QaHbwAiAAt0kOPLyV4VuXM7V8WLQdYx1U_zgGiBd-n85Mwc5ACAm2hhdXRoRGF0YVkBZ4hHbR1KvnQ1gf1-vaAt5QBKFeyReXOrVDqDLyzYe24ZRQAAAAAImHBYytxLgbbhMN5Q3L6WACD3NeqCnqpuoqEFn-n7u3l4B2Mb6t7iXPEAYZFZrP6dH6QBAwM5AQAgWQEAzh2N18Auj4Ci1-jd_QJesz-b_yEjhz9qDmUELQZWNJZ6bu_fuSS-n2uZ7UrFEmS_SSUwCRgqcNoZhmoT0AE1jRbMFS57JXJ9oPPXFJFPNhIOAybVvgKy6a5i6PUOdxohyRbVNnKlxVOkJA1sV4bMCLN6zPrupzjwhY1Cd7I9zW3_bNybQhOw6qH14uXxHTTBSJPcfqzKWcDEeOYrW94YdAl6wzfc2db5ybM33L5D7SQbOzJc38Rf6cq8fds9yNFn-3kVVW36Y-Cyi-CBJ_MiKyV6fkTmSD_XUATZrifP2qO4zLFbfWZflm8FnqsSMdd2b4EztMb1_1a_uyyvein0OSFDAQAB';
      const clientDataJSON =
        'eyJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIiwiY2hhbGxlbmdlIjoicFN3QV90TWxiUE1JNmxEY3FkR3ZIeWo1TC1USG5DQlhScFlid294YlBuUC1EZWp5UkNSMmpuTHE5dTZ6N2NwSGFDdVVzc1UzUFJySko5T1NaeHZuX0EiLCJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY3Jvc3NPcmlnaW4iOmZhbHNlfQ';

      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const tf = new TpmFormat();
      tf.config(
        {
          ...attStmt,
          x5c: null,
        },
        {
          ...result,
        } as any,
        {} as any,
        {}
      );

      try {
        const verified = await tf.verify();
        t.fail('not come here');
      } catch (err) {
        t.match(err.message, /x5c does not exist/);
      }

      t.end();
    });

    t.test('### aikCert subject', async (t) => {
      const attestationObject =
        'o2NmbXRjdHBtZ2F0dFN0bXSmY2FsZzkBAGNzaWdZAQAbnFVNmtmc-AsINu7vZxh0R3gjiiJTX-sSoBho5jtz3p4629pcaJbHpJnxB0vxfJypIiGEYcob4x6_MQoTVxCK7u3njgWFYLqJRCQOje82EMfQbC5zA3LUhobWddrkbft-gEJPmtOOtydMrR6ugbEeWpHBLIJYng_PqGvftLT_3EucaEUHxPnva5msVDENc527zrXKpp-amE9HpTYDEFERxzuSfk8sG8FY5Vun2-oD5w32GPtzzu9ascYIe7NpYWbUHpNg91XflYtHSk6BEU9Z4CqXwP0BeYqDF-4n-eCNlCs_wNKEd1wWFlaG6e8JJiPTbXvdDXW0fi_8hz8b1bC8Y3ZlcmMyLjBjeDVjglkGFzCCBhMwggP7oAMCAQICDwTDZT9__rrXaEADze-h2jANBgkqhkiG9w0BAQsFADCBvzELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAk1ZMRIwEAYDVQQHDAlXYWtlZmllbGQxFjAUBgNVBAoMDUZJRE8gQWxsaWFuY2UxDDAKBgNVBAsMA0NXRzE2MDQGA1UEAwwtRklETyBGYWtlIFRQTSBSb290IENlcnRpZmljYXRlIEF1dGhvcml0eSAyMDE4MTEwLwYJKoZIhvcNAQkBFiJjb25mb3JtYW5jZS10b29sc0BmaWRvYWxsaWFuY2Uub3JnMB4XDTE3MDIwMTAwMDAwMFoXDTM1MDEzMTIzNTk1OVowQTE_MD0GA1UEAxM2TkNVLU5UQy1LRVlJRC1GRjk5MDMzOEUxODcwNzlBNkNENkEwM0FEQzU3MjM3NDQ1RjZBNDlBMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1z5zfRGlB378sKiIsltfPe3--pyI4ii_CN7Pv38O1WCLwb0-H608v6ULS54UYExI9wp39EN1IV7ZAJhB317QO2IXGtr65YZrSiUjWEcjtsrYbM0BlJMoRvCCql_y9cxD7tI9qODo9_FI4sf82PbJ3q2Q2RRJ2Ua1Z9jxcYHef6r76e3dQd1RBYS2BShN7lpsFewbsxBK5M2hp3e_q-T60t3RbjiK8zqlsWoVQdyHHyYYsCkKmOVVet9E5oKhz0T3WEb0H5Y296QnR0zqQnrnwfLvKxxDol2ogSiViiMK1ZpY2bBx-_744TUDH_hRvbiCXeGkH0Q5wELOlvhQWYthQQIDAQABo4IBhzCCAYMwCwYDVR0PBAQDAgGGMBYGA1UdIAQPMA0wCwYJKwYBBAGCNxUfMBsGA1UdJQQUMBIGCSsGAQQBgjcVJAYFZ4EFCAMwEgYDVR0TAQH_BAgwBgEB_wIBADAdBgNVHQ4EFgQUdOhwbuNi8U8_KoCvb3uGHTvHco0wHwYDVR0jBBgwFoAUQxEWmZrunVA3wk_-4lsVyQkzPzIwcQYDVR0fBGowaDBmoGSgYoZgaHR0cHM6Ly9wa2kuY2VydGluZnJhLmZpZG9hbGxpYW5jZS5vcmcvdHBtL2NybC9GSURPIEZha2UgVFBNIFJvb3QgQ2VydGlmaWNhdGUgQXV0aG9yaXR5IDIwMTguY3JsMHgGCCsGAQUFBwEBBGwwajBoBggrBgEFBQcwAoZcaHR0cHM6Ly9wa2kuY2VydGluZnJhLmZpZG9hbGxpYW5jZS5vcmcvdHBtL0ZJRE8gRmFrZSBUUE0gUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkgMjAxOC5jcnQwDQYJKoZIhvcNAQELBQADggIBAJ04YUo8twkTYi3SxuPj1A6byIkTKuBZgWaVaxAsD8kIapnLVZt2cRnWGBGvdAZO-mQZYtNY67mrN38in1rFuDEbIogCaMo4-0Xsb2MByG9Rrjl84IGFILwA1BzP0dtN4w9sbZWMinfSP5GLyZUY4lEoTO14LTuPGlQr7kYU4nKMdrktwocWnTHRRJV09KXE5eTbrwZQVhBbXaCauewGGHcFn6y8rnQIMTGGVuUCML7sSmXrfpV8BygXmzZYI1abJK0gj9VHXVZosXa14dBRL0OY-fhkf76-0rpqqqyuCbwBeCKUpbjkcyACtZx_SocxdxLVnBZ4YQ-JruGYG8E2O4YtZgR_6Y4laPLL3CFkiEIyPZpkua968QJ4K4V49Lq7GULet1D8F_exRqlGrIh0iNHfd5XsvTsIVDfXuIhOqn-x4P3OhA0Ly_I-lz0Qrx8e_-XlC5VRc29V6Q3NlPvzg2d0nGgQ8VIudGwqBrAph95tFiPTSuXUSwuMi7EnMc3wzLOsDosRDTO6dNp-BaRLHLAqAkVAQlq1FlV00LDlF6K_yIThWg7b9dxGoH2Ivz4N7SJG4HIDMg-ePP9dLWPRkgoK3pMc3ZZOfa10JF9IwDpipwIdhr_7LuYA6fNTqsvzPgVO63HlqcHfxWroKTLO2fOT_FuxYzmk3tQv9uqpBXc7WQUNMIIFCTCCA_GgAwIBAgIPBMrN6FKYtrJazZ8-wEgcMA0GCSqGSIb3DQEBCwUAMEExPzA9BgNVBAMTNk5DVS1OVEMtS0VZSUQtRkY5OTAzMzhFMTg3MDc5QTZDRDZBMDNBREM1NzIzNzQ0NUY2QTQ5QTAeFw0xODAyMDEwMDAwMDBaFw0yNTAxMzEyMzU5NTlaMAAwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCmkduym3IO9HSS411Li3OhHhvBpBbmpGarXIXV9h7BNVkWH0EcJxgdSDn8iow61nkFk3KHq5CZidRRfSUK0V9a5-sr2tCjF-zEGfPedWmdppf2teL7Bk82QMgQ8tKeEB1nMTdPAYWT0bXgc87ccbPRVk_sYFYBA-xsawS7mDWJQox1yRktPObOksQRGhXBa7TVLCiA1Z96wH-xjIV6tMHDxIpf8eGP2svbl29_IRtndMJ-HSXcRAktuU-W6ueXxh8SvfOhAzy5bXjyTRX4_pj45hypS08YNOqOZ3IcKorzwlJ4M6U2fWuYApbxPlDp6MXsfIkZOz2mXz8e9jStRE8rAgMBAAGjggI9MIICOTAOBgNVHQ8BAf8EBAMCB4AwDAYDVR0TAQH_BAIwADB7BgNVHSABAf8EcTBvMG0GCSsGAQQBgjcVHzBgMF4GCCsGAQUFBwICMFIeUABGAEEASwBFACAARgBJAEQATwAgAFQAQwBQAEEAIABUAHIAdQBzAHQAZQBkACAAUABsAGEAdABmAG8AcgBtACAASQBkAGUAbgB0AGkAdAB5MBAGA1UdJQQJMAcGBWeBBQgDMEoGA1UdEQEB_wRAMD6kPDA6MTgwDgYFZ4EFAgMMBWlkOjEzMBAGBWeBBQICDAdOUENUNnh4MBQGBWeBBQIBDAtpZDpGRkZGRjFEMDAfBgNVHSMEGDAWgBR06HBu42LxTz8qgK9ve4YdO8dyjTAdBgNVHQ4EFgQUq0QvcaAlNRFopksQVRwaEm826VUwgYEGCCsGAQUFBwEBBHUwczBxBggrBgEFBQcwAoZlaHR0cHM6Ly9wa2kuY2VydGluZnJhLmZpZG9hbGxpYW5jZS5vcmcvdHBtL05DVS1OVEMtS0VZSUQtRkY5OTAzMzhFMTg3MDc5QTZDRDZBMDNBREM1NzIzNzQ0NUY2QTQ5QS5jcnQwegYDVR0fBHMwcTBvoG2ga4ZpaHR0cHM6Ly9wa2kuY2VydGluZnJhLmZpZG9hbGxpYW5jZS5vcmcvdHBtL2NybC9OQ1UtTlRDLUtFWUlELUZGOTkwMzM4RTE4NzA3OUE2Q0Q2QTAzQURDNTcyMzc0NDVGNkE0OUEuY3JsMA0GCSqGSIb3DQEBCwUAA4IBAQCqNvac9MGTVDormnknuDqFELn_blDV07oxptTVim6mis5BaYOhxXI2RPFgLaZtIhykBHRodS68Bfg2el2NDcQQkVPz8Bds4f_nyc_GymxjcmyHB1gPIG8SHiHRYjaMX0b4_-eG_t6RZcDjPPUr88qLEqY1Ct-BP1XOTZ5_Q3kfmJDGwzpkBsVnMbWNTeJ4N0_2P2QIGeBcOyEeuQdWPWZ3nwkSSaUfEw8c-LOkOBRDPMrPO0Wlhswt76rG-C1Z_XDmxLPRrCdOplkEFMSLeBeR2LMAMw4YQ9ua7bRg79jVgZ-YMBYhdXEs7ZtzZ1yyk4kZAtcXoNNK34FzrLup-jLZZ3B1YkFyZWFZATYAAQALAAYEcgAgnf_L82w4OuaZ-5ho3G3LidcVOIS-KAOSLBJBWL-tIq4AEAAQCAAAAAAAAQC6OYPZoKr_0XM__qjbyWJt4816eDi9461GkMjijU6BrWpXrpLN7czsT1ZSgjTClIKl6HvRpicUDu0BtxE7g3Oj1nTu55RkXHHp1oFPjtaWtVgCUFrj8Zogjqa8Pza9TdS5Uz43ELXagj9rdmDhrA8EpeCVnxGpVYaUXU4MHm9kUqncdRaetZFqhFdekwagLAHxcfQoF6CcZWyRJTEWrmzqkJuf4U3slekoIwZs32hWnftgpYQpHixuZW7XeDagFT0MUTNUM9IM_tv-xMTh1sDVSaOBhmebFuY27-S36zHCEKI6mGrosrOASd9_2yzKHcHp_OeksUy5NUrNanPx_vCDaGNlcnRJbmZvWK3_VENHgBcAIgALEeaO1E21Ny4UKW4vhKzHg5h1GIGSHjD8IqBvi3PHlFMAIBQBZoz9XyBuULywOJXjLq5atSrmVD5gOGhIKvw1SwsSAAAAAUdwF0hVaXtLxoVgpQFzfvmNNFZV-wAiAAsizv1pb6f5ahbImQQx7r5bJ_OWBgZ5ITFIFPzm5tT3hgAiAAt3xOZnQmHVynj6gCE7jIdBKsrKRY8aWORJijUvcbcOJWhhdXRoRGF0YVkBZ4hHbR1KvnQ1gf1-vaAt5QBKFeyReXOrVDqDLyzYe24ZQQAAAHin1tk6ig0R6JqUps9xBy9zACAlwvwHxBR_-Pof1y4MXcpetNx1WxjvoVh2erdGJ7oubKQBAwM5AQAgWQEAujmD2aCq_9FzP_6o28libePNeng4veOtRpDI4o1Oga1qV66Sze3M7E9WUoI0wpSCpeh70aYnFA7tAbcRO4Nzo9Z07ueUZFxx6daBT47WlrVYAlBa4_GaII6mvD82vU3UuVM-NxC12oI_a3Zg4awPBKXglZ8RqVWGlF1ODB5vZFKp3HUWnrWRaoRXXpMGoCwB8XH0KBegnGVskSUxFq5s6pCbn-FN7JXpKCMGbN9oVp37YKWEKR4sbmVu13g2oBU9DFEzVDPSDP7b_sTE4dbA1UmjgYZnmxbmNu_kt-sxwhCiOphq6LKzgEnff9ssyh3B6fznpLFMuTVKzWpz8f7wgyFDAQAB';
      const clientDataJSON =
        'eyJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY2hhbGxlbmdlIjoiZTZhTnJYdThZUE14Nkl1ME9iSW1uOU50dmhCVkRLbTBhT1ZEVFg3NFh1dEQ0UGptbVd0TFpRczM0QU9Kemp4bHpnTFB3MjNkSHYtME1JMnIydEFDWXciLCJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIn0';

      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const tf = new TpmFormat();
      tf.config(
        {
          ...attStmt,
        },
        {
          ...result,
        } as any,
        {} as any,
        {}
      );

      try {
        const verified = await tf.verify();
        t.fail('not come here');
      } catch (err) {
        t.match(err.message, /aikCert subject is not empty/);
      }

      t.end();
    });

    t.test('### certInfo extraData no equal', async (t) => {
      const attestationObject =
        'o2NmbXRjdHBtZ2F0dFN0bXSmY2FsZzkBAGNzaWdZAQA6PESZ2hvord-cuEf5WvYDaI7h0RftLqU2hcaGKOUqTMMp8x4y2fdPivC8UMB9XX4GiLMd2YpEHpDAZjbyXLIg1zQdluKj4zfU5Ka0sJgIorLjii4VKZIPJIIk58gX6iVJnRVNoIXduYROmXPvMj2SMy2SEtKBgJK8z3_nL7UgHdDtjo6sdnpByLZharB5sqkAJUUI5YshBlPfzH6jQxT5znxbIcNKr6lH9Z6qIjVP6oAardNE5otb4HdrZV-xcEN0sqIz6RHQEf1zEn7cxap2zUfKzYmfzdLoH_2LcBq9efQF3GnJ_pD0i9MjKg7gJztU-2BRACh_ZGWptOJaE495Y3ZlcmMyLjBjeDVjglkFDTCCBQkwggPxoAMCAQICDwSFpqnC2uT0G5QphfE4mTANBgkqhkiG9w0BAQsFADBBMT8wPQYDVQQDEzZOQ1UtTlRDLUtFWUlELUZGOTkwMzM4RTE4NzA3OUE2Q0Q2QTAzQURDNTcyMzc0NDVGNkE0OUEwHhcNMTgwMjAxMDAwMDAwWhcNMjUwMTMxMjM1OTU5WjAAMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxTQxGjLNK2Mi9U1jyeB6VbzeAM4MGK40fwk-p7WkC3JYoUq4fI5rkgKMhfXMYlSG1llYxmEEV557pxpFzu3ufL6OiEpgpFxHMfENmE2QgthVB-vetGLDPwpbAPUcIVHk2N_zKlSwRzCc8F0Yi3r0-a0UN3M9jG-GvJOzoSaPPtS6gg0Im7lbFzwWQnW-90CbjQWcoWIDj8fCo6rLvwxxqo10PiECmvDFcEtm9Y4kiHO4Xv-8FZPyO4bLLNiRVg3HueAKZ3guxOR29NgjRmqkhrxLk5bB4l0heZNJuqHjmnMk6Kb6NKAlk6BJQ8Z2Ye-no9s9J8XHxuWOLSqTbTozqQIDAQABo4ICPTCCAjkwDgYDVR0PAQH_BAQDAgeAMAwGA1UdEwEB_wQCMAAwewYDVR0gAQH_BHEwbzBtBgkrBgEEAYI3FR8wYDBeBggrBgEFBQcCAjBSHlAARgBBAEsARQAgAEYASQBEAE8AIABUAEMAUABBACAAVAByAHUAcwB0AGUAZAAgAFAAbABhAHQAZgBvAHIAbQAgAEkAZABlAG4AdABpAHQAeTAQBgNVHSUECTAHBgVngQUIAzBKBgNVHREBAf8EQDA-pDwwOjE4MA4GBWeBBQIDDAVpZDoxMzAQBgVngQUCAgwHTlBDVDZ4eDAUBgVngQUCAQwLaWQ6RkZGRkYxRDAwHwYDVR0jBBgwFoAUdOhwbuNi8U8_KoCvb3uGHTvHco0wHQYDVR0OBBYEFLdJz_7fxXqsOo5hw5uChhx3YA9AMIGBBggrBgEFBQcBAQR1MHMwcQYIKwYBBQUHMAKGZWh0dHBzOi8vcGtpLmNlcnRpbmZyYS5maWRvYWxsaWFuY2Uub3JnL3RwbS9OQ1UtTlRDLUtFWUlELUZGOTkwMzM4RTE4NzA3OUE2Q0Q2QTAzQURDNTcyMzc0NDVGNkE0OUEuY3J0MHoGA1UdHwRzMHEwb6BtoGuGaWh0dHBzOi8vcGtpLmNlcnRpbmZyYS5maWRvYWxsaWFuY2Uub3JnL3RwbS9jcmwvTkNVLU5UQy1LRVlJRC1GRjk5MDMzOEUxODcwNzlBNkNENkEwM0FEQzU3MjM3NDQ1RjZBNDlBLmNybDANBgkqhkiG9w0BAQsFAAOCAQEAGpWJagFnGfPnbS0UZZfuSbiAwaiRE-qobRE50Qy8r2g_HPF54xuCqqPsu8PyS8l5ZUeMAllT2L1zD5-oW8mDFuO6qv-00zIDiCuUmWkQgTunUTj5Zv3nys9LCoqdJeYmpoJKpi_5FeR85Kof6zVCzzUChqpPzDNmgV_pq9936sl2zlgDkDB7QsgN-KlT8aPbDc7stLhYSegHvqXkKrHXsffcNvgYHR8G1E159O417MV1SZddYY_FTBZZ_FrUP0o5Yn5I0pMvydVJuVLspc0eEQUAMSqban7AVVhdraMHV-sGFdWpph1GehtZc2gLGT7bReaD9T_7MJKAELBiRsmdLFkGFzCCBhMwggP7oAMCAQICDwTDZT9__rrXaEADze-h2jANBgkqhkiG9w0BAQsFADCBvzELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAk1ZMRIwEAYDVQQHDAlXYWtlZmllbGQxFjAUBgNVBAoMDUZJRE8gQWxsaWFuY2UxDDAKBgNVBAsMA0NXRzE2MDQGA1UEAwwtRklETyBGYWtlIFRQTSBSb290IENlcnRpZmljYXRlIEF1dGhvcml0eSAyMDE4MTEwLwYJKoZIhvcNAQkBFiJjb25mb3JtYW5jZS10b29sc0BmaWRvYWxsaWFuY2Uub3JnMB4XDTE3MDIwMTAwMDAwMFoXDTM1MDEzMTIzNTk1OVowQTE_MD0GA1UEAxM2TkNVLU5UQy1LRVlJRC1GRjk5MDMzOEUxODcwNzlBNkNENkEwM0FEQzU3MjM3NDQ1RjZBNDlBMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1z5zfRGlB378sKiIsltfPe3--pyI4ii_CN7Pv38O1WCLwb0-H608v6ULS54UYExI9wp39EN1IV7ZAJhB317QO2IXGtr65YZrSiUjWEcjtsrYbM0BlJMoRvCCql_y9cxD7tI9qODo9_FI4sf82PbJ3q2Q2RRJ2Ua1Z9jxcYHef6r76e3dQd1RBYS2BShN7lpsFewbsxBK5M2hp3e_q-T60t3RbjiK8zqlsWoVQdyHHyYYsCkKmOVVet9E5oKhz0T3WEb0H5Y296QnR0zqQnrnwfLvKxxDol2ogSiViiMK1ZpY2bBx-_744TUDH_hRvbiCXeGkH0Q5wELOlvhQWYthQQIDAQABo4IBhzCCAYMwCwYDVR0PBAQDAgGGMBYGA1UdIAQPMA0wCwYJKwYBBAGCNxUfMBsGA1UdJQQUMBIGCSsGAQQBgjcVJAYFZ4EFCAMwEgYDVR0TAQH_BAgwBgEB_wIBADAdBgNVHQ4EFgQUdOhwbuNi8U8_KoCvb3uGHTvHco0wHwYDVR0jBBgwFoAUQxEWmZrunVA3wk_-4lsVyQkzPzIwcQYDVR0fBGowaDBmoGSgYoZgaHR0cHM6Ly9wa2kuY2VydGluZnJhLmZpZG9hbGxpYW5jZS5vcmcvdHBtL2NybC9GSURPIEZha2UgVFBNIFJvb3QgQ2VydGlmaWNhdGUgQXV0aG9yaXR5IDIwMTguY3JsMHgGCCsGAQUFBwEBBGwwajBoBggrBgEFBQcwAoZcaHR0cHM6Ly9wa2kuY2VydGluZnJhLmZpZG9hbGxpYW5jZS5vcmcvdHBtL0ZJRE8gRmFrZSBUUE0gUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkgMjAxOC5jcnQwDQYJKoZIhvcNAQELBQADggIBAJ04YUo8twkTYi3SxuPj1A6byIkTKuBZgWaVaxAsD8kIapnLVZt2cRnWGBGvdAZO-mQZYtNY67mrN38in1rFuDEbIogCaMo4-0Xsb2MByG9Rrjl84IGFILwA1BzP0dtN4w9sbZWMinfSP5GLyZUY4lEoTO14LTuPGlQr7kYU4nKMdrktwocWnTHRRJV09KXE5eTbrwZQVhBbXaCauewGGHcFn6y8rnQIMTGGVuUCML7sSmXrfpV8BygXmzZYI1abJK0gj9VHXVZosXa14dBRL0OY-fhkf76-0rpqqqyuCbwBeCKUpbjkcyACtZx_SocxdxLVnBZ4YQ-JruGYG8E2O4YtZgR_6Y4laPLL3CFkiEIyPZpkua968QJ4K4V49Lq7GULet1D8F_exRqlGrIh0iNHfd5XsvTsIVDfXuIhOqn-x4P3OhA0Ly_I-lz0Qrx8e_-XlC5VRc29V6Q3NlPvzg2d0nGgQ8VIudGwqBrAph95tFiPTSuXUSwuMi7EnMc3wzLOsDosRDTO6dNp-BaRLHLAqAkVAQlq1FlV00LDlF6K_yIThWg7b9dxGoH2Ivz4N7SJG4HIDMg-ePP9dLWPRkgoK3pMc3ZZOfa10JF9IwDpipwIdhr_7LuYA6fNTqsvzPgVO63HlqcHfxWroKTLO2fOT_FuxYzmk3tQv9uqpBXc7Z3B1YkFyZWFZATYAAQALAAYEcgAgnf_L82w4OuaZ-5ho3G3LidcVOIS-KAOSLBJBWL-tIq4AEAAQCAAAAAAAAQCSAtSlxLo9oQFqhEykGEAt_K_EVo9rZADhFHjqL2efOJVndmJwisUZ3mWzqp1CxieU8nxfI7jF7hGXX7D9_ybL3ak5Oy0E5CbWoYvlpBMm8-l94y4QZRmbHXSjyjs5pBm9aoru5PXmKp1p-97FKlTgUQ5ILOwzLKyfp7dm6CCjWATAQXlJdq9Dm-Lw3pekfQW-XLVJQ6yTMQHXOiZD1foZNxB8MZjxwwr2q38krMdCmQl-iAY4BRW2TBbprAHrE5ot2SnUvM2wtEAud7NSmK5E-XuecmCBOblUOqhg5Oj9g1iP45ifOSN2-WWZpsJrlFkh5fTgEQw16nXAFaDGshW_aGNlcnRJbmZvWK3_VENHgBcAIgALEeaO1E21Ny4UKW4vhKzHg5h1GIGSHjD8IqBvi3PHlFMAIIPOeo7rSKMiAUodzoBAnDvokq3JY-FlDT4iI_5Qj0LgAAAAAUdwF0hVaXtLxoVgpQFzfvmNNFZV-wAiAAuv93SBxO5rjd4xXLeNcIx7Oajxs29W1c3Py7KZe0kx2wAiAAsUZfwaCWYGzKlpdzxY4mE-N2Dr4Emje95_EXv14ZawBGhhdXRoRGF0YVkBZ4hHbR1KvnQ1gf1-vaAt5QBKFeyReXOrVDqDLyzYe24ZQQAAAHmn1tk6ig0R6JqUps9xBy9zACAC1q3VJnj_LGmmGJvBv7lXV1yHgk8EUNpA37iRgbrO3aQBAwM5AQAgWQEAkgLUpcS6PaEBaoRMpBhALfyvxFaPa2QA4RR46i9nnziVZ3ZicIrFGd5ls6qdQsYnlPJ8XyO4xe4Rl1-w_f8my92pOTstBOQm1qGL5aQTJvPpfeMuEGUZmx10o8o7OaQZvWqK7uT15iqdafvexSpU4FEOSCzsMyysn6e3Zuggo1gEwEF5SXavQ5vi8N6XpH0Fvly1SUOskzEB1zomQ9X6GTcQfDGY8cMK9qt_JKzHQpkJfogGOAUVtkwW6awB6xOaLdkp1LzNsLRALnezUpiuRPl7nnJggTm5VDqoYOTo_YNYj-OYnzkjdvllmabCa5RZIeX04BEMNep1wBWgxrIVvyFDAQAB';
      const clientDataJSON =
        'eyJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY2hhbGxlbmdlIjoiLUdHY3d4Y2NOWFNTdkF5WHNfZHdrS2htSEhMRFdJSmRJZDZrUF9ZSGg4UWFmZmlhQXljSjJ0cGJnTnNVaXdYZERLYktmZ3FoeFFMdG5uTWE5WXBreFEiLCJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIn0';

      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const tf = new TpmFormat();
      tf.config(
        {
          ...attStmt,
        },
        {
          ...result,
        } as any,
        {} as any,
        {}
      );

      try {
        const verified = await tf.verify();
        t.fail('not come here');
      } catch (err) {
        t.match(err.message, /certInfo extraData is not equal to hash of attToBeSigned/);
      }

      t.end();
    });

    t.test('### certInfo magic is invalid', async (t) => {
      const attestationObject =
        'o2NmbXRjdHBtZ2F0dFN0bXSmY2FsZzkBAGNzaWdZAQAIqmO2m5JNYUUUMjBMZTmWPd612MiL76wV4kBFnOxPEy1mQtnI1SLb0ACkAYCRdFaQ8PM55o4cdQXqv0cTqaMX6eIWsZ9dMvYvUkhs9Wstij6Ko5o3M7do6ImuZslpVeEo5IFgoatwZrN7dBBhZxEA-9_xxLidzJjvOe3fFNNG-eQKMq3tXXQiurj6s9beGquzYYkO4dQQiqh9AI5mEAzmPJ0_8_Zq42vs3MHfQ81soDumPpKc7Y84YDLnFAOROeBc8u6_0Y2LfmAkU9lAQLDjqo1QScr6uqDVl2qTwzZYhh8YKbYs3ueh1_myqrMaBbov41JlWxctKiMc9voxOluzY3ZlcmMyLjBjeDVjglkFDTCCBQkwggPxoAMCAQICDwSHPEAugmTTZUDRhcsFJDANBgkqhkiG9w0BAQsFADBBMT8wPQYDVQQDEzZOQ1UtTlRDLUtFWUlELUZGOTkwMzM4RTE4NzA3OUE2Q0Q2QTAzQURDNTcyMzc0NDVGNkE0OUEwHhcNMTgwMjAxMDAwMDAwWhcNMjUwMTMxMjM1OTU5WjAAMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtx2kXzJwcEchqjR2Mr1u5L3rlz0GdY5A0tPqdfJ7x5cPRUAs0CVo44_WwiDl-jU2_wrXW8jtt7s6_RVn8qbb6oi5VTCj2YLfGfhB0rWXj7eIe21lR5rVWmVQJfNc9mHhIcNs86VIC55LPQiClmw2ETlOdw0OJwHd5uiJ1eIIhCbR-cLH2FMjLSB3L7dbfzE-Xtm-orP6HZP9nQ4OtKjRj5I27KTgsHvFlnBbvpwD_HhBoTqRRIPWi6dFq2NLd8K3qJNhHWuPvusF67E9sAODJwXJToOg28ocrEECJbx16R1G1TF_zXEtpbIoAkDo_rs8mEgwMx9-wQ4ZogJtS6yGnQIDAQABo4ICPTCCAjkwDgYDVR0PAQH_BAQDAgeAMAwGA1UdEwEB_wQCMAAwewYDVR0gAQH_BHEwbzBtBgkrBgEEAYI3FR8wYDBeBggrBgEFBQcCAjBSHlAARgBBAEsARQAgAEYASQBEAE8AIABUAEMAUABBACAAVAByAHUAcwB0AGUAZAAgAFAAbABhAHQAZgBvAHIAbQAgAEkAZABlAG4AdABpAHQAeTAQBgNVHSUECTAHBgVngQUIAzBKBgNVHREBAf8EQDA-pDwwOjE4MA4GBWeBBQIDDAVpZDoxMzAQBgVngQUCAgwHTlBDVDZ4eDAUBgVngQUCAQwLaWQ6RkZGRkYxRDAwHwYDVR0jBBgwFoAUdOhwbuNi8U8_KoCvb3uGHTvHco0wHQYDVR0OBBYEFHelOyHgv5_gWVvqwCtYu4P11wy4MIGBBggrBgEFBQcBAQR1MHMwcQYIKwYBBQUHMAKGZWh0dHBzOi8vcGtpLmNlcnRpbmZyYS5maWRvYWxsaWFuY2Uub3JnL3RwbS9OQ1UtTlRDLUtFWUlELUZGOTkwMzM4RTE4NzA3OUE2Q0Q2QTAzQURDNTcyMzc0NDVGNkE0OUEuY3J0MHoGA1UdHwRzMHEwb6BtoGuGaWh0dHBzOi8vcGtpLmNlcnRpbmZyYS5maWRvYWxsaWFuY2Uub3JnL3RwbS9jcmwvTkNVLU5UQy1LRVlJRC1GRjk5MDMzOEUxODcwNzlBNkNENkEwM0FEQzU3MjM3NDQ1RjZBNDlBLmNybDANBgkqhkiG9w0BAQsFAAOCAQEAkfWt02ka15GOmOfmvwqgyl_SJ1Z7IZjGh5y_v3N6WMtIt4ZC0Ew4dCT7rRkhIUU9BY7U9kwlqR2xmU69mnAfnq9uezOAGEAXP4UPqOqKqmjw-tlK7QUwuqrocG91neKdomGJx6_fJUrLGX0UisOPHTL_40TqxctIXCJtn1kvyd11Nynh1nQRSBU_AdM1oYCZxVvwsoeg3CO5UTwQ265br1hT1QXnOCe2KG_s8vV6wuTdhcrl8EbMWGuQiOqg9lUOaNKVlmwe0s1lcV-fzFqEeD-0FQZl43jHFJJ8fd7nvrv9Ra_oWoYxOlJ2pifyICoP2CZ13czPMq_FeU52lUFs9FkGFzCCBhMwggP7oAMCAQICDwTDZT9__rrXaEADze-h2jANBgkqhkiG9w0BAQsFADCBvzELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAk1ZMRIwEAYDVQQHDAlXYWtlZmllbGQxFjAUBgNVBAoMDUZJRE8gQWxsaWFuY2UxDDAKBgNVBAsMA0NXRzE2MDQGA1UEAwwtRklETyBGYWtlIFRQTSBSb290IENlcnRpZmljYXRlIEF1dGhvcml0eSAyMDE4MTEwLwYJKoZIhvcNAQkBFiJjb25mb3JtYW5jZS10b29sc0BmaWRvYWxsaWFuY2Uub3JnMB4XDTE3MDIwMTAwMDAwMFoXDTM1MDEzMTIzNTk1OVowQTE_MD0GA1UEAxM2TkNVLU5UQy1LRVlJRC1GRjk5MDMzOEUxODcwNzlBNkNENkEwM0FEQzU3MjM3NDQ1RjZBNDlBMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1z5zfRGlB378sKiIsltfPe3--pyI4ii_CN7Pv38O1WCLwb0-H608v6ULS54UYExI9wp39EN1IV7ZAJhB317QO2IXGtr65YZrSiUjWEcjtsrYbM0BlJMoRvCCql_y9cxD7tI9qODo9_FI4sf82PbJ3q2Q2RRJ2Ua1Z9jxcYHef6r76e3dQd1RBYS2BShN7lpsFewbsxBK5M2hp3e_q-T60t3RbjiK8zqlsWoVQdyHHyYYsCkKmOVVet9E5oKhz0T3WEb0H5Y296QnR0zqQnrnwfLvKxxDol2ogSiViiMK1ZpY2bBx-_744TUDH_hRvbiCXeGkH0Q5wELOlvhQWYthQQIDAQABo4IBhzCCAYMwCwYDVR0PBAQDAgGGMBYGA1UdIAQPMA0wCwYJKwYBBAGCNxUfMBsGA1UdJQQUMBIGCSsGAQQBgjcVJAYFZ4EFCAMwEgYDVR0TAQH_BAgwBgEB_wIBADAdBgNVHQ4EFgQUdOhwbuNi8U8_KoCvb3uGHTvHco0wHwYDVR0jBBgwFoAUQxEWmZrunVA3wk_-4lsVyQkzPzIwcQYDVR0fBGowaDBmoGSgYoZgaHR0cHM6Ly9wa2kuY2VydGluZnJhLmZpZG9hbGxpYW5jZS5vcmcvdHBtL2NybC9GSURPIEZha2UgVFBNIFJvb3QgQ2VydGlmaWNhdGUgQXV0aG9yaXR5IDIwMTguY3JsMHgGCCsGAQUFBwEBBGwwajBoBggrBgEFBQcwAoZcaHR0cHM6Ly9wa2kuY2VydGluZnJhLmZpZG9hbGxpYW5jZS5vcmcvdHBtL0ZJRE8gRmFrZSBUUE0gUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkgMjAxOC5jcnQwDQYJKoZIhvcNAQELBQADggIBAJ04YUo8twkTYi3SxuPj1A6byIkTKuBZgWaVaxAsD8kIapnLVZt2cRnWGBGvdAZO-mQZYtNY67mrN38in1rFuDEbIogCaMo4-0Xsb2MByG9Rrjl84IGFILwA1BzP0dtN4w9sbZWMinfSP5GLyZUY4lEoTO14LTuPGlQr7kYU4nKMdrktwocWnTHRRJV09KXE5eTbrwZQVhBbXaCauewGGHcFn6y8rnQIMTGGVuUCML7sSmXrfpV8BygXmzZYI1abJK0gj9VHXVZosXa14dBRL0OY-fhkf76-0rpqqqyuCbwBeCKUpbjkcyACtZx_SocxdxLVnBZ4YQ-JruGYG8E2O4YtZgR_6Y4laPLL3CFkiEIyPZpkua968QJ4K4V49Lq7GULet1D8F_exRqlGrIh0iNHfd5XsvTsIVDfXuIhOqn-x4P3OhA0Ly_I-lz0Qrx8e_-XlC5VRc29V6Q3NlPvzg2d0nGgQ8VIudGwqBrAph95tFiPTSuXUSwuMi7EnMc3wzLOsDosRDTO6dNp-BaRLHLAqAkVAQlq1FlV00LDlF6K_yIThWg7b9dxGoH2Ivz4N7SJG4HIDMg-ePP9dLWPRkgoK3pMc3ZZOfa10JF9IwDpipwIdhr_7LuYA6fNTqsvzPgVO63HlqcHfxWroKTLO2fOT_FuxYzmk3tQv9uqpBXc7Z3B1YkFyZWFZATYAAQALAAYEcgAgnf_L82w4OuaZ-5ho3G3LidcVOIS-KAOSLBJBWL-tIq4AEAAQCAAAAAAAAQCxCVuBH7GYsEp89deJExAM2iabBEOm-o8kLR5vk49VlO4RaGHg2ybGmPSKMXVRCWuZrmG0r7U27SI5Prk_yO2G731W1fc9vWhF7v2gC3DOuhjsqKhCqnajyODkAuBRIQ38Y7ABaec_7pSBufUZ1WzETrOZdSqqP5W5l5QYO7BTIGyaPMs-lQjymoKRzG--U2CvBYFZ-T4EyQyLtXTnPglRiQHesQmquhg_xghqU0Cz0GoIxFxuLrgeQ_YVeYWFBhOn_kbX3kQjuFhHTpvzO_tb__yQbHxVNTuKoZK9bj4PG7R5Hha8m1GCTVK7CyioecEPvR8ULZSeiLnadoBEcsWdaGNlcnRJbmZvWK1Mi0yfgBcAIgALEeaO1E21Ny4UKW4vhKzHg5h1GIGSHjD8IqBvi3PHlFMAIMSRdT3-PbCkoiUg2E8rblu7wMpg1t-u3ND_YdC1DLdBAAAAAUdwF0hVaXtLxoVgpQFzfvmNNFZV-wAiAAsacszlYlfEn4qDbSz5BtZzOZByzRrNPYaUvVUvyCCLHwAiAAur1j48IXCs3BNysgMuHvenxWsJ4HAJYruOXOvL308iDmhhdXRoRGF0YVkBZ4hHbR1KvnQ1gf1-vaAt5QBKFeyReXOrVDqDLyzYe24ZQQAAAHqn1tk6ig0R6JqUps9xBy9zACA1Fd2YdlT9ruoW87vEqFHh0UOXxOsyv40B0oUGDyBSXqQBAwM5AQAgWQEAsQlbgR-xmLBKfPXXiRMQDNommwRDpvqPJC0eb5OPVZTuEWhh4Nsmxpj0ijF1UQlrma5htK-1Nu0iOT65P8jthu99VtX3Pb1oRe79oAtwzroY7KioQqp2o8jg5ALgUSEN_GOwAWnnP-6Ugbn1GdVsxE6zmXUqqj-VuZeUGDuwUyBsmjzLPpUI8pqCkcxvvlNgrwWBWfk-BMkMi7V05z4JUYkB3rEJqroYP8YIalNAs9BqCMRcbi64HkP2FXmFhQYTp_5G195EI7hYR06b8zv7W__8kGx8VTU7iqGSvW4-Dxu0eR4WvJtRgk1SuwsoqHnBD70fFC2Unoi52naARHLFnSFDAQAB';
      const clientDataJSON =
        'eyJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY2hhbGxlbmdlIjoieTIzel83UzJESGhFVFFKbldwalhBZVEyNGQ0QnZBOW4wS003YW51eW5OaVVjXzBCSk5Gako3WXlNV0tnYmozMmI3RHBCVlVJWmltX1NZRE1oNmJoX2ciLCJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIn0';

      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const tf = new TpmFormat();
      tf.config(
        {
          ...attStmt,
        },
        {
          ...result,
        } as any,
        {} as any,
        {}
      );

      try {
        const verified = await tf.verify();
        t.fail('not come here');
      } catch (err) {
        t.match(err.message, /certInfo\.magic is not set to TPM_GENERATED\(0xFF544347\)/);
      }

      t.end();
    });

    t.test('### publicArea unique is invalid', async (t) => {
      const attestationObject =
        'o2NmbXRjdHBtZ2F0dFN0bXSmY2FsZzkBAGNzaWdZAQBrjsXAzn8YIcf8o947OZFR9e2s5oOrR8NYQMEo5buZAs0wfIF0mwwxjLD_z_GHpvVGqPAxZbl4f4PWNRQkwtvd7KDZtmfvSFBUc1dA9ZyKv8dwoPzPSbad7oVjymEdfF2Spu0DJeDepC11EnVwCCKBuucOMD9G0E544c8QRBeFQD-Hog6ZaQi3s4gqy-AuKhSylBRqgVslfWvCuXbguo-Fk_ST8MXXQE1plQstLNuUxf-Fzcr2pxTyijIMJXTlrKIb7wJ7RLnILP7Ts44zXAbSLH5G-fflyWZ1-9GeAJWi99e-ZWi961wYrFqiib5aXx6xe3S11GB8HkaCrtEokWr_Y3ZlcmMyLjBjeDVjglkFDTCCBQkwggPxoAMCAQICDwRJYo5vB3ue6cB1tKeaUTANBgkqhkiG9w0BAQsFADBBMT8wPQYDVQQDEzZOQ1UtTlRDLUtFWUlELUZGOTkwMzM4RTE4NzA3OUE2Q0Q2QTAzQURDNTcyMzc0NDVGNkE0OUEwHhcNMTgwMjAxMDAwMDAwWhcNMjUwMTMxMjM1OTU5WjAAMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAzvGFYlckNmq09fzAKJ3rk2xtMIHl-GTypgZ8aVCJQ78gmZTZe3D_o6q7LaU2h8cieqHG47zZH4UXtbXGzpVf0gr11SiMnW_40GH7ajh8VYREUL7R6aHAbPAPrUsCm8e5OnLW0ix4a5_oKHkxq-P480cHm0e_2oHxlewBhlMr_abY3ZmYVLUTi1U1T0S31pU9lGiEis4Z9rCp0Iz9DI6V7ZRgRdlNMT9hVTAINUcH1KZNQuQsVEGpfznsw7H9EPUWvu5qm9PMGuDCioqp8Hd83DwlhDwBWY17JKS_9aDSm3jiD_nWqlRxagIBtAN3QLDtwkIBfIVUD-VzHHRQPX0XmQIDAQABo4ICPTCCAjkwDgYDVR0PAQH_BAQDAgeAMAwGA1UdEwEB_wQCMAAwewYDVR0gAQH_BHEwbzBtBgkrBgEEAYI3FR8wYDBeBggrBgEFBQcCAjBSHlAARgBBAEsARQAgAEYASQBEAE8AIABUAEMAUABBACAAVAByAHUAcwB0AGUAZAAgAFAAbABhAHQAZgBvAHIAbQAgAEkAZABlAG4AdABpAHQAeTAQBgNVHSUECTAHBgVngQUIAzBKBgNVHREBAf8EQDA-pDwwOjE4MA4GBWeBBQIDDAVpZDoxMzAQBgVngQUCAgwHTlBDVDZ4eDAUBgVngQUCAQwLaWQ6RkZGRkYxRDAwHwYDVR0jBBgwFoAUdOhwbuNi8U8_KoCvb3uGHTvHco0wHQYDVR0OBBYEFH1morTx4QeCcy4dqcwBVTxcjv16MIGBBggrBgEFBQcBAQR1MHMwcQYIKwYBBQUHMAKGZWh0dHBzOi8vcGtpLmNlcnRpbmZyYS5maWRvYWxsaWFuY2Uub3JnL3RwbS9OQ1UtTlRDLUtFWUlELUZGOTkwMzM4RTE4NzA3OUE2Q0Q2QTAzQURDNTcyMzc0NDVGNkE0OUEuY3J0MHoGA1UdHwRzMHEwb6BtoGuGaWh0dHBzOi8vcGtpLmNlcnRpbmZyYS5maWRvYWxsaWFuY2Uub3JnL3RwbS9jcmwvTkNVLU5UQy1LRVlJRC1GRjk5MDMzOEUxODcwNzlBNkNENkEwM0FEQzU3MjM3NDQ1RjZBNDlBLmNybDANBgkqhkiG9w0BAQsFAAOCAQEAzXhkzPTYCJY6l7Sp4Rclx7SUWy_GhAJV31p4cfjLBPgak9boiUr5sM3DHiXNd2aCGRNxCLaNe6-Osng64iHJ583nrcIAbOj4JR-RwLycMBzdxEDTfoQGyVcZwjV0qA5HJ_0B9WxM9eK-Vohb9G4n0RmABvwharNx54iJUZXXFCcRcbk0Qm_Uyxq95WI9UI9lO6whD5FBJHrc6TRCZTm475oYEEXo36O2zdDCk9YHQPDSEjXu5uldvBGoOdR0XOPPmICT0MvPz30Fqe7XsArNIdHDH_Q7uCAxU99FEm3oWBR4iwv8-xMbLX9PEbMNbsTa9n9IdXPmZV329U4ZLU4TulkGFzCCBhMwggP7oAMCAQICDwTDZT9__rrXaEADze-h2jANBgkqhkiG9w0BAQsFADCBvzELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAk1ZMRIwEAYDVQQHDAlXYWtlZmllbGQxFjAUBgNVBAoMDUZJRE8gQWxsaWFuY2UxDDAKBgNVBAsMA0NXRzE2MDQGA1UEAwwtRklETyBGYWtlIFRQTSBSb290IENlcnRpZmljYXRlIEF1dGhvcml0eSAyMDE4MTEwLwYJKoZIhvcNAQkBFiJjb25mb3JtYW5jZS10b29sc0BmaWRvYWxsaWFuY2Uub3JnMB4XDTE3MDIwMTAwMDAwMFoXDTM1MDEzMTIzNTk1OVowQTE_MD0GA1UEAxM2TkNVLU5UQy1LRVlJRC1GRjk5MDMzOEUxODcwNzlBNkNENkEwM0FEQzU3MjM3NDQ1RjZBNDlBMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1z5zfRGlB378sKiIsltfPe3--pyI4ii_CN7Pv38O1WCLwb0-H608v6ULS54UYExI9wp39EN1IV7ZAJhB317QO2IXGtr65YZrSiUjWEcjtsrYbM0BlJMoRvCCql_y9cxD7tI9qODo9_FI4sf82PbJ3q2Q2RRJ2Ua1Z9jxcYHef6r76e3dQd1RBYS2BShN7lpsFewbsxBK5M2hp3e_q-T60t3RbjiK8zqlsWoVQdyHHyYYsCkKmOVVet9E5oKhz0T3WEb0H5Y296QnR0zqQnrnwfLvKxxDol2ogSiViiMK1ZpY2bBx-_744TUDH_hRvbiCXeGkH0Q5wELOlvhQWYthQQIDAQABo4IBhzCCAYMwCwYDVR0PBAQDAgGGMBYGA1UdIAQPMA0wCwYJKwYBBAGCNxUfMBsGA1UdJQQUMBIGCSsGAQQBgjcVJAYFZ4EFCAMwEgYDVR0TAQH_BAgwBgEB_wIBADAdBgNVHQ4EFgQUdOhwbuNi8U8_KoCvb3uGHTvHco0wHwYDVR0jBBgwFoAUQxEWmZrunVA3wk_-4lsVyQkzPzIwcQYDVR0fBGowaDBmoGSgYoZgaHR0cHM6Ly9wa2kuY2VydGluZnJhLmZpZG9hbGxpYW5jZS5vcmcvdHBtL2NybC9GSURPIEZha2UgVFBNIFJvb3QgQ2VydGlmaWNhdGUgQXV0aG9yaXR5IDIwMTguY3JsMHgGCCsGAQUFBwEBBGwwajBoBggrBgEFBQcwAoZcaHR0cHM6Ly9wa2kuY2VydGluZnJhLmZpZG9hbGxpYW5jZS5vcmcvdHBtL0ZJRE8gRmFrZSBUUE0gUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkgMjAxOC5jcnQwDQYJKoZIhvcNAQELBQADggIBAJ04YUo8twkTYi3SxuPj1A6byIkTKuBZgWaVaxAsD8kIapnLVZt2cRnWGBGvdAZO-mQZYtNY67mrN38in1rFuDEbIogCaMo4-0Xsb2MByG9Rrjl84IGFILwA1BzP0dtN4w9sbZWMinfSP5GLyZUY4lEoTO14LTuPGlQr7kYU4nKMdrktwocWnTHRRJV09KXE5eTbrwZQVhBbXaCauewGGHcFn6y8rnQIMTGGVuUCML7sSmXrfpV8BygXmzZYI1abJK0gj9VHXVZosXa14dBRL0OY-fhkf76-0rpqqqyuCbwBeCKUpbjkcyACtZx_SocxdxLVnBZ4YQ-JruGYG8E2O4YtZgR_6Y4laPLL3CFkiEIyPZpkua968QJ4K4V49Lq7GULet1D8F_exRqlGrIh0iNHfd5XsvTsIVDfXuIhOqn-x4P3OhA0Ly_I-lz0Qrx8e_-XlC5VRc29V6Q3NlPvzg2d0nGgQ8VIudGwqBrAph95tFiPTSuXUSwuMi7EnMc3wzLOsDosRDTO6dNp-BaRLHLAqAkVAQlq1FlV00LDlF6K_yIThWg7b9dxGoH2Ivz4N7SJG4HIDMg-ePP9dLWPRkgoK3pMc3ZZOfa10JF9IwDpipwIdhr_7LuYA6fNTqsvzPgVO63HlqcHfxWroKTLO2fOT_FuxYzmk3tQv9uqpBXc7Z3B1YkFyZWFZATYAAQALAAYEcgAgnf_L82w4OuaZ-5ho3G3LidcVOIS-KAOSLBJBWL-tIq4AEAAQCAAAAAAAAQBnzFT0pnAr7ZCRRkUO1DTUmMeoZR1l646V-V8PqcD6SJMn4p95C0eNZ6EfJPnScFfODXmkFM8pGPhdeiFZ4k_crpj8h_qR5aU5VNqbbH6cR_GPexWe9vMpDojKo2jvLZd4K-Zane6cHGYj4rHSl3Pqj_2iX8ftaiBuPHB0ymlpivpyk1RYSTQ5eStDbvbdAloNG1qjxRXbbwUTRiFHB5g1K7hqn5mwSHoctVT-reHSrUGs6BpOz1hmbUug0TR05kVqkqV0Sfq4uLujRlfSoiHMUzqahi59nIxeXjcmhaDEHKR37ZpU3lkCwVdC5yKwQDnBqWU4G-8hz6QhR8j3NcEeaGNlcnRJbmZvWK3_VENHgBcAIgALEeaO1E21Ny4UKW4vhKzHg5h1GIGSHjD8IqBvi3PHlFMAIPxCcusT8Kt_FXxH8Yy2Ac4NhcmVN_VTKixzA3B4nAhMAAAAAUdwF0hVaXtLxoVgpQFzfvmNNFZV-wAiAAs9s2qqopVuLlhsBWSsF7X1Yxv8EjSx28kCSASBceu3DgAiAAvhogyF13jYhgozA3jdbuQwexNppSuwyTp6s_58X6b33GhhdXRoRGF0YVkBZ4hHbR1KvnQ1gf1-vaAt5QBKFeyReXOrVDqDLyzYe24ZQQAAAHun1tk6ig0R6JqUps9xBy9zACCX8mSWR3vYe3uDIXkFYMueMDsjhWmLBLpwhAmI4pHzaKQBAwM5AQAgWQEAxAvOK9TAJMswgXJrydVEWKJDhZeIrhvxkiZWlhOi2oq8mLW4C1PX7RyhaNe66R4nEM9MuvSkyNft98QQHFyeipgHh3vfnF8Z7fdWKpwW3SgnmKQEiC8TC_IoAHysaWZy1f1kMp54HFSy8mT5ICsSL3wi2kJAqYm67vIdOySTdlH3Q-xAXPO4bXHwARAYDYX72Aizm08AupBOZaJTspBX3qvIlUAbYw0uUCDEZlAbnJxG2q45blbRvNyoYzwR3hbElV_KNgMnRdzBK3PCHsxUowSfjNNoWlFYgzT7sAn6vtmD-6L2ijC-K-SFxqbxYLCh9UyGIiiYZp3rpTWWw50TOSFDAQAB';
      const clientDataJSON =
        'eyJvcmlnaW4iOiJodHRwczovL2xvY2FsaG9zdC5zMXItai50azozMDAwIiwiY2hhbGxlbmdlIjoibVlCanZJZ3lidjBkbHNRLTNUSDBYY21kMmxCQWtDMGtPZUt0cjFWVnN6bW54RmJmUUFsbElub1dqRG5Uc2FBVGFqV1RkNVByUmVPOGxCS1lGZkZPWWciLCJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIn0';

      const { attStmt, result } = await parse(attestationObject, clientDataJSON);

      const tf = new TpmFormat();
      tf.config(
        {
          ...attStmt,
        },
        {
          ...result,
        } as any,
        {} as any,
        {}
      );

      try {
        const verified = await tf.verify();
        t.fail('not come here');
      } catch (err) {
        t.match(err.message, /pubArea\.unique is not equal to public key in authData/);
      }

      t.end();
    });

    t.end();
  });

  t.end();
});
